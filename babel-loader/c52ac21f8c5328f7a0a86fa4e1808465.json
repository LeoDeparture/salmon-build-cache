{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport Router from 'next/router';\nimport React from 'react';\nimport styled from 'styled-components';\nimport FilePicker from '../../../components/FilePicker';\nimport RichTextEditor from '../../../components/RichTextEditor';\nimport SelectCourseCategories from '../../../components/SelectComponents/SelectCourseCategories';\nimport ZhiWenSelect from '../../../components/SelectComponents/ZhiWenSelect';\nimport { DetailCommonP, FlexDisplay } from '../../../lib/commonCss';\nimport { checkPositive, parseErrorCode } from '../../../lib/commonJs';\nimport { Image, RenderImgDiv } from './CourseInfo';\nvar FormItem = _Form.Item;\nvar TextArea = _Input.TextArea;\nvar TitleDiv = styled.div.withConfig({\n  displayName: \"CreateCourseComponents__TitleDiv\",\n  componentId: \"sc-87xkdq-0\"\n})([\"padding:16px 32px;font-size:20px;font-weight:500;color:#000;background-color:#fff;\"]);\nexport var BigContentDiv = styled.div.withConfig({\n  displayName: \"CreateCourseComponents__BigContentDiv\",\n  componentId: \"sc-87xkdq-1\"\n})([\"display:flex;margin:20px;\"]);\nexport var PrimaryA = styled.a.withConfig({\n  displayName: \"CreateCourseComponents__PrimaryA\",\n  componentId: \"sc-87xkdq-2\"\n})([\"z-index:1;margin-top:1px;margin-left:12px;font-size:14px;color:#5c86fb;\"]);\nexport var ContentDiv = styled.div.withConfig({\n  displayName: \"CreateCourseComponents__ContentDiv\",\n  componentId: \"sc-87xkdq-3\"\n})([\"width:100%;padding:40px 32px;background-color:#fff;\"]);\n\nvar CreateCourseForm =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(CreateCourseForm, _React$Component);\n\n  function CreateCourseForm() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CreateCourseForm);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CreateCourseForm)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"setFieldsValue\", _this.props.form.setFieldsValue);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      banner: '',\n      errMsgVisible: false,\n      categoryIds: [],\n      loading: false,\n      introductionEditorState: null,\n      tutorIntroductionEditorState: null,\n      suitedPeopleEditorState: null,\n      zhiwenProfessionId: '',\n      errorCode: ''\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"clearError\", function () {\n      _this.setState({\n        errorCode: ''\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSubmit\", function (e) {\n      e.preventDefault();\n\n      _this.props.form.validateFieldsAndScroll(function (err, values) {\n        if (!values.autoForm || !values.autoForm.length) {\n          delete values.autoForm;\n        }\n\n        if (_this.state.categoryIds && _this.state.categoryIds.length) {\n          values.courseCategoryId = _this.state.categoryIds.slice(-1).pop();\n          delete values.categoryIds;\n        }\n\n        if (_this.state.zhiwenProfessionId) {\n          values.zhiwenProfessionId = _this.state.zhiwenProfessionId;\n        }\n\n        if (_this.state.tutorIntroductionEditorState) {\n          values.introduction = _this.state.introductionEditorState.toHTML();\n        }\n\n        if (_this.state.introductionEditorState) {\n          values.tutorIntroduction = _this.state.tutorIntroductionEditorState.toHTML();\n        }\n\n        if (_this.state.suitedPeopleEditorState) {\n          values.suitedPeople = _this.state.suitedPeopleEditorState.toHTML();\n        }\n\n        if (values.duration) {\n          values.duration = Number(values.duration);\n        }\n\n        if (!err && !_this.state.errMsgVisible) {\n          _this.setState({\n            loading: true\n          });\n\n          var courseType = _this.props.courseType;\n          return _this.props.createHandler(values).then(function (result) {\n            if (result && result.data) {\n              var courseTypeName = courseType === 'PRIVATE_COURSE' ? '1对1辅导' : '小班课';\n              var url = courseTypeName === '1对1辅导' ? '/private-course-management' : '/group-course-management';\n\n              _message.success(\"\\u5DF2\\u6210\\u529F\\u521B\\u5EFA\".concat(courseTypeName), 1.5, function () {\n                Router.push(url);\n              });\n            }\n          }).catch(function (error) {\n            if (parseErrorCode(error) === 'DuplicationError') {\n              var warnObj = {\n                okText: '我知道了',\n                content: '你输入的小班课辅导名称在你选择的所属分类中已被占用，请重新设置输入名称或分类。',\n                title: '无法创建小班课辅导'\n              };\n\n              if (courseType === 'PRIVATE_COURSE') {\n                warnObj.content = \"\\u4F60\\u8F93\\u5165\\u76841\\u5BF91\\u8F85\\u5BFC\\u540D\\u79F0\\u5728\\u4F60\\u9009\\u62E9\\u7684\\u6240\\u5C5E\\u5206\\u7C7B\\u4E2D\\u5DF2\\u88AB\\u5360\\u7528\\uFF0C\\u8BF7\\u91CD\\u65B0\\u8BBE\\u7F6E\\u8F93\\u5165\\u540D\\u79F0\\u6216\\u5206\\u7C7B\\u3002\";\n                warnObj.title = '无法创建1对1辅导';\n              }\n\n              _Modal.warning(warnObj);\n            } else if (parseErrorCode(error) === 'CategoryError') {\n              _this.setState({\n                errorCode: 'CategoryError'\n              });\n\n              window.location.href = '#category';\n            }\n\n            _this.setState({\n              loading: false\n            });\n\n            return;\n          });\n        } else {\n          return null;\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCancel\", function () {\n      Router.back();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleFieldChange\", function (stateName, stateValue, selected) {\n      _this.setState(_defineProperty({}, stateName, stateValue));\n\n      if (['banner', 'zhiwenProfessionId'].includes(stateName)) {\n        _this.setFieldsValue(_defineProperty({}, stateName, stateValue));\n      }\n\n      if (stateName === 'categoryIds') {\n        _this.setState({\n          errMsgVisible: selected && !selected.isLeaf\n        });\n\n        _this.setFieldsValue(_defineProperty({}, stateName, stateValue));\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleGetFile\", function (fileLinks) {\n      var url = fileLinks.length ? fileLinks[0].file.transformedFile.url : '';\n\n      _this.setState({\n        banner: url\n      });\n\n      _this.setFieldsValue({\n        banner: url\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSelectBanner\", function () {\n      _this.fileModal.showPop();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onRef\", function (child) {\n      _this.fileModal = child;\n    });\n\n    return _this;\n  }\n\n  _createClass(CreateCourseForm, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props$form = this.props.form,\n          getFieldDecorator = _this$props$form.getFieldDecorator,\n          getFieldValue = _this$props$form.getFieldValue;\n      var courseTypeName = this.props.courseType === 'PRIVATE_COURSE' ? '1对1辅导' : '小班课';\n      return React.createElement(\"div\", {\n        style: {\n          width: '100%'\n        }\n      }, React.createElement(TitleDiv, null, \"\\u521B\\u5EFA\", courseTypeName), React.createElement(BigContentDiv, null, React.createElement(ContentDiv, null, React.createElement(_Form, {\n        onSubmit: this.handleSubmit\n      }, React.createElement(_Row, null, React.createElement(_Col, {\n        span: 9\n      }, React.createElement(FormItem, {\n        label: courseTypeName + '名称',\n        colon: false\n      }, getFieldDecorator('name', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(_Input, {\n        placeholder: \"\\u8BF7\\u8F93\\u5165\",\n        maxLength: 64\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 9\n      }, React.createElement(\"a\", {\n        id: \"category\"\n      }), React.createElement(FormItem, {\n        label: \"\\u6240\\u5C5E\\u884C\\u4E1A\",\n        colon: false\n      }, getFieldDecorator('zhiwenProfessionId', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(ZhiWenSelect, {\n        type: \"zhiwen-profession\",\n        value: getFieldValue('zhiwenProfessionId'),\n        getValue: this.handleFieldChange.bind(this, 'zhiwenProfessionId')\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 9\n      }, React.createElement(FormItem, {\n        label: \"\\u6240\\u5C5E\\u5206\\u7C7B\",\n        colon: false,\n        validateStatus: this.state.errorCode === 'CategoryError' ? 'error' : undefined,\n        help: this.state.errorCode === 'CategoryError' ? '无法找到该分类' : undefined\n      }, getFieldDecorator('categoryIds', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(\"div\", {\n        onFocus: this.clearError\n      }, React.createElement(SelectCourseCategories, {\n        serviceTypeKey: this.props.courseType,\n        setValue: getFieldValue('categoryIds'),\n        getValue: this.handleFieldChange.bind(this, 'categoryIds')\n      })))), React.createElement(\"div\", {\n        style: {\n          color: '#f5222d',\n          marginTop: '-24px'\n        },\n        hidden: !this.state.errMsgVisible\n      }, \"\\u65E0\\u6CD5\\u9009\\u62E9\\u672A\\u8BBE\\u7F6E\\u53EF\\u5173\\u8054\\u8BFE\\u7A0B\\u7684\\u5206\\u7C7B\"))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 3\n      }, React.createElement(FormItem, {\n        label: React.createElement(\"div\", {\n          style: {\n            display: 'inline-block'\n          }\n        }, React.createElement(\"label\", null, courseTypeName, \"\\u5C01\\u9762\\u56FE\"), React.createElement(DetailCommonP, {\n          style: {\n            margin: '0 12px'\n          }\n        }, \"\\u5EFA\\u8BAE\\u5C3A\\u5BF8\\uFF1A654*340px\")),\n        colon: false\n      }, React.createElement(RenderImgDiv, {\n        hidden: !this.state.banner\n      }, React.createElement(Image, {\n        src: this.state.banner\n      })), React.createElement(FilePicker, {\n        onRef: this.onRef,\n        fileType: \"image-only\",\n        selectType: \"single\",\n        getSelected: this.handleGetFile\n      }), getFieldDecorator('banner', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(_Button, {\n        style: {\n          width: '200px'\n        },\n        onClick: this.handleSelectBanner\n      }, \"\\u9009\\u62E9\\u56FE\\u7247\"))))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 9\n      }, React.createElement(_Form.Item, {\n        label: \"\\u9884\\u8BA1\\u6388\\u8BFE\\u65F6\\u957F\",\n        colon: false\n      }, getFieldDecorator('duration', {\n        rules: [{\n          message: '此字段无法为空',\n          required: true\n        }, {\n          validator: checkPositive\n        }],\n        validateFirst: true\n      })(React.createElement(_Input, {\n        style: {\n          width: '100%'\n        },\n        placeholder: '限10000分钟以内，正整数',\n        maxLength: 4\n      })))), React.createElement(_Col, {\n        span: 1,\n        style: {\n          marginTop: '45px',\n          marginLeft: '12px'\n        }\n      }, \"\\u5206\\u949F\")), React.createElement(_Row, null, React.createElement(_Col, null, React.createElement(FormItem, {\n        labelCol: {\n          span: 24\n        },\n        label: React.createElement(\"div\", {\n          style: {\n            display: 'flex',\n            flex: 1,\n            justifyContent: 'space-between'\n          }\n        }, React.createElement(FlexDisplay, null, React.createElement(\"label\", null, \"\\u9884\\u7EA6\\u8868\\u5355\"), React.createElement(PrimaryA, {\n          href: '/auto-form-info',\n          target: \"_blank\"\n        }, \"\\u683C\\u5F0F\\u8BF4\\u660E\"))),\n        colon: false\n      }, getFieldDecorator('autoForm')(React.createElement(TextArea, {\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u9884\\u7EA6\\u8868\\u5355\",\n        autoSize: {\n          minRows: 12\n        }\n      }))))), React.createElement(_Row, null, React.createElement(_Col, null, React.createElement(FormItem, {\n        label: \"\\u8BE6\\u60C5\\u4ECB\\u7ECD\",\n        colon: false\n      }, getFieldDecorator('introduction')(React.createElement(RichTextEditor, {\n        apikey: 'ADQyLt4yBR7GH9oPjPODCz',\n        setValue: '',\n        getValue: this.handleFieldChange.bind(this, 'introductionEditorState')\n      }))))), this.props.courseType === 'GROUP_COURSE' && React.createElement(_Row, null, React.createElement(_Col, {\n        style: {\n          width: '100%'\n        }\n      }, React.createElement(FormItem, {\n        label: \"\\u9002\\u5408\\u4EBA\\u7FA4\",\n        colon: false\n      }, getFieldDecorator('suitedPeople')(React.createElement(RichTextEditor, {\n        apikey: 'ADQyLt4yBR7GH9oPjPODCz',\n        setValue: '',\n        getValue: this.handleFieldChange.bind(this, 'suitedPeopleEditorState')\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        style: {\n          width: '100%'\n        }\n      }, React.createElement(FormItem, {\n        label: \"\\u5BFC\\u5E08\\u56E2\\u961F\\u4ECB\\u7ECD\",\n        colon: false\n      }, getFieldDecorator('tutorIntroduction')(React.createElement(RichTextEditor, {\n        apikey: 'ADQyLt4yBR7GH9oPjPODCz',\n        setValue: '',\n        getValue: this.handleFieldChange.bind(this, 'tutorIntroductionEditorState')\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        style: {\n          width: '100%'\n        }\n      }, React.createElement(FormItem, {\n        label: React.createElement(\"div\", {\n          style: {\n            display: 'inline-block'\n          }\n        }, React.createElement(\"label\", null, \"\\u5BF9\\u5185\\u5907\\u6CE8\"), React.createElement(DetailCommonP, {\n          style: {\n            margin: '0 12px'\n          }\n        }, \"\\u4EC5\\u5BF9\\u5185\\u53EF\\u89C1\")),\n        colon: false\n      }, getFieldDecorator('remarks')(React.createElement(TextArea, {\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BF9\\u5185\\u5907\\u6CE8\",\n        autoSize: {\n          minRows: 2,\n          maxRows: 6\n        }\n      }))))), React.createElement(FormItem, {\n        labelCol: {\n          span: 12\n        }\n      }, React.createElement(_Button, {\n        onClick: this.handleCancel\n      }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n        style: {\n          marginLeft: 20\n        },\n        type: \"primary\",\n        htmlType: \"submit\",\n        loading: this.state.loading\n      }, \"\\u521B\\u5EFA\\u6B64\", courseTypeName))))));\n    }\n  }]);\n\n  return CreateCourseForm;\n}(React.Component);\n\nexport default _Form.create()(CreateCourseForm);","map":null,"metadata":{},"sourceType":"module"}
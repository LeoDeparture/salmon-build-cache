{"ast":null,"code":"import \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/badge/style\";\nimport _Badge from \"antd/lib/badge\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport { addMinutes, format } from 'date-fns';\nimport Link from 'next/link';\nimport React from 'react';\nimport styled from 'styled-components';\nimport Loading from '../../../components/Loading';\nimport TableFooter from '../../../components/Table/TableFooter';\nimport { FlexDisplay } from '../../../lib/commonCss';\nimport { ScheduleType } from '../../groupCourseScheduleDetails/components/TitleComponent';\nimport ListGroupCourseSlotsWithPagination, { listGroupCourseSlotsWithPagination } from './ListGroupCourseSlotsWithPagination';\nimport TitleSelect from './TitleSelect';\nvar getDataNumber = 20;\nvar TableTitle = styled.span.withConfig({\n  displayName: \"MyScheduleManagement__TableTitle\",\n  componentId: \"yeh4hu-0\"\n})([\"font-size:14px;\"]);\nvar CategoryName = styled.span.withConfig({\n  displayName: \"MyScheduleManagement__CategoryName\",\n  componentId: \"yeh4hu-1\"\n})([\"display:block;max-width:\", \"px;overflow:hidden;font-size:14px;text-overflow:ellipsis;white-space:nowrap;\"], function (props) {\n  return props.width;\n});\n\nvar MyScheduleManagement =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(MyScheduleManagement, _React$Component);\n\n  function MyScheduleManagement() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, MyScheduleManagement);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(MyScheduleManagement)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"variables\", {\n      input: {\n        first: getDataNumber,\n        where: {\n          claimant: {\n            id: null\n          },\n          status: {\n            key_not: 'CANCELED'\n          },\n          groupCourse: {\n            industry: undefined\n          }\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      defaultListValue: [],\n      id: '',\n      userId: null,\n      loading: false,\n      modalLoading: false,\n      pageInfo: {\n        endCursor: '',\n        hasNextPage: ''\n      },\n      visible: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"componentDidMount\", function () {\n      var id = JSON.parse(localStorage.getItem('misViewer')).operatorAccount.id;\n      _this.variables.input.where.claimant.id = id;\n\n      _this.setState({\n        userId: id\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"refetchList\", function (id) {\n      // tslint:disable-next-line:prefer-conditional-expression\n      if (id === 'all') {\n        _this.variables.input.where.groupCourse.industry = undefined;\n      } else if (id !== 'refetchAccept') {\n        _this.variables.input.where.groupCourse.industry = {\n          id: id\n        };\n      }\n\n      _this.refetch({\n        variables: _this.variables\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showCancelData\", function (status) {\n      if (status) {\n        _this.variables.input.where.status.key_not = '';\n\n        _this.refetch(_this.variables);\n\n        return;\n      }\n\n      _this.variables.input.where.status.key_not = 'CANCELED';\n\n      _this.refetch(_this.variables);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCheckboxData\", function (v) {\n      _this.setState({\n        defaultListValue: v\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"queryMore\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var _this$state, loading, pageInfo;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$state = _this.state, loading = _this$state.loading, pageInfo = _this$state.pageInfo;\n\n              if (loading) {\n                _context.next = 7;\n                break;\n              }\n\n              _this.setState({\n                loading: true\n              });\n\n              if (!pageInfo.hasNextPage) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 6;\n              return _this.fetchMore({\n                updateQuery: function updateQuery(prev, _ref2) {\n                  var fetchMoreResult = _ref2.fetchMoreResult;\n\n                  if (!fetchMoreResult) {\n                    return prev;\n                  }\n\n                  var prevData = prev.listGroupCourseSlotsWithPagination.edges;\n                  var fetchResult = fetchMoreResult.listGroupCourseSlotsWithPagination.edges;\n                  fetchMoreResult.listGroupCourseSlotsWithPagination.edges = [].concat(_toConsumableArray(prevData), _toConsumableArray(fetchResult));\n                  return fetchMoreResult;\n                },\n                variables: {\n                  input: _objectSpread({}, _this.variables.input, {\n                    after: pageInfo.endCursor,\n                    first: getDataNumber\n                  })\n                }\n              }).then(function (result) {\n                if (result.data) {\n                  _this.setState({\n                    loading: false\n                  });\n                }\n              });\n\n            case 6:\n              return _context.abrupt(\"return\");\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"footer\", function () {\n      return _this.state.pageInfo.hasNextPage && React.createElement(TableFooter, {\n        isLoading: _this.state.loading,\n        onClickLink: _this.queryMore\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderStatus\", function (v, l) {\n      var badgeText = l.cancelReason ? {\n        badge: 'default',\n        text: \"\\u5DF2\\u53D6\\u6D88\\uFF08\".concat(l.cancelReason, \"\\uFF09\")\n      } : ScheduleType[v];\n      return React.createElement(WrapBadge, null, React.createElement(_Badge, {\n        style: {\n          display: 'flex'\n        },\n        status: badgeText.badge\n      }), React.createElement(StatusContent, null, badgeText.text));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"storePageInfo\", function (data) {\n      var pageInfo = data.listGroupCourseSlotsWithPagination.pageInfo;\n\n      _this.setState({\n        pageInfo: {\n          endCursor: pageInfo.endCursor,\n          hasNextPage: pageInfo.hasNextPage\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"filterData\", function (data) {\n      var operatorAccounts = [];\n      var dataArr = data.listGroupCourseSlotsWithPagination.edges;\n\n      if (dataArr.length) {\n        dataArr.forEach(function (i) {\n          var appointDeadLine = format(addMinutes(i.node.time, -i.node.appointDeadline), 'YYYY/MM/DD HH:mm');\n          operatorAccounts.push(_objectSpread({}, i.node, {\n            industry: i.node.groupCourse.industry.name,\n            key: i.node.id,\n            name: i.node.groupCourse.name,\n            range: \"\".concat(i.node.min, \" ~ \").concat(i.node.max),\n            studentAccountsLength: i.node.studentAccounts.length,\n            time: format(i.node.time, 'YYYY/MM/DD HH:mm'),\n            status: i.node.status.key,\n            appointDeadLine: appointDeadLine\n          }));\n        });\n      }\n\n      return operatorAccounts;\n    });\n\n    return _this;\n  }\n\n  _createClass(MyScheduleManagement, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      // if (nextProps.refetchListFun === 'refetchAccept') {\n      //   this.refetch();\n      // }\n      if (this.props.tabs !== nextProps.tabs) {\n        this.refetch();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var columns = [{\n        dataIndex: 'name',\n        key: 'name',\n        width: 280,\n        title: React.createElement(TableTitle, null, \"\\u5C0F\\u73ED\\u8BFE\\u540D\\u79F0\"),\n        render: function render(v) {\n          return React.createElement(CategoryName, {\n            width: '280'\n          }, v);\n        }\n      }, {\n        dataIndex: 'industry',\n        key: 'industry',\n        width: 90,\n        title: React.createElement(TableTitle, null, \"\\u6240\\u5C5E\\u884C\\u4E1A\"),\n        render: function render(v) {\n          return React.createElement(CategoryName, null, v);\n        }\n      }, {\n        dataIndex: 'time',\n        key: 'time',\n        render: function render(v) {\n          return React.createElement(CategoryName, null, v);\n        },\n        title: React.createElement(TableTitle, null, \"\\u4E0A\\u8BFE\\u65F6\\u95F4\")\n      }, {\n        dataIndex: 'studentAccountsLength',\n        key: 'studentAccountsLength',\n        width: 105,\n        render: function render(v) {\n          return React.createElement(CategoryName, null, v);\n        },\n        title: React.createElement(TableTitle, null, \"\\u5DF2\\u62A5\\u540D\\u4EBA\\u6570\")\n      }, {\n        dataIndex: 'range',\n        key: 'range',\n        width: 105,\n        render: function render(v) {\n          return React.createElement(CategoryName, null, v);\n        },\n        title: React.createElement(TableTitle, null, \"\\u5F00\\u8BFE\\u4EBA\\u8303\\u56F4\")\n      }, {\n        dataIndex: 'status',\n        key: 'status',\n        render: function render(v, l) {\n          return _this2.renderStatus(v, l);\n        },\n        title: React.createElement(TableTitle, null, \"\\u6392\\u671F\\u72B6\\u6001\")\n      }, {\n        dataIndex: 'operating',\n        key: 'operating',\n        width: 100,\n        render: function render(_, b) {\n          return React.createElement(Link, {\n            href: \"/group-course-schedule-details?id=\".concat(b.id)\n          }, React.createElement(\"a\", {\n            href: \"javascript:;\",\n            style: {\n              textDecorationLine: 'none',\n              fontSize: 14\n            }\n          }, \"\\u67E5\\u770B\\u8BE6\\u60C5\"));\n        },\n        title: React.createElement(TableTitle, null, \"\\u64CD\\u4F5C\")\n      }];\n      return React.createElement(TitleSelect, {\n        part: \"part2\",\n        refetchList: this.refetchList,\n        showCancelData: this.showCancelData\n      }, React.createElement(ListGroupCourseSlotsWithPagination, {\n        variables: this.variables,\n        notifyOnNetworkStatusChange: true,\n        onCompleted: this.storePageInfo,\n        query: listGroupCourseSlotsWithPagination\n      }, function (_ref3) {\n        var loading = _ref3.loading,\n            error = _ref3.error,\n            data = _ref3.data,\n            fetchMore = _ref3.fetchMore,\n            client = _ref3.client,\n            refetch = _ref3.refetch;\n        _this2.fetchMore = fetchMore;\n        _this2.client = client;\n        _this2.refetch = refetch;\n\n        if (loading) {\n          return React.createElement(Loading, null);\n        }\n\n        if (error) {\n          return null;\n        }\n\n        return React.createElement(_Table, {\n          style: {\n            flex: 1\n          },\n          columns: columns,\n          dataSource: _this2.filterData(data),\n          footer: _this2.footer,\n          pagination: false,\n          locale: {\n            emptyText: '暂无小班课排期任务'\n          }\n        });\n      }));\n    }\n  }]);\n\n  return MyScheduleManagement;\n}(React.Component);\n\nexport default MyScheduleManagement;\nvar WrapBadge = styled(FlexDisplay).withConfig({\n  displayName: \"MyScheduleManagement__WrapBadge\",\n  componentId: \"yeh4hu-2\"\n})([\"align-items:center;\"]);\nvar StatusContent = styled.span.withConfig({\n  displayName: \"MyScheduleManagement__StatusContent\",\n  componentId: \"yeh4hu-3\"\n})([\"display:inline-block;width:280px;overflow:hidden;font-size:14px;text-overflow:ellipsis;white-space:nowrap;\"]);","map":null,"metadata":{},"sourceType":"module"}
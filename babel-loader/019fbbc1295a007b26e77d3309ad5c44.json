{"ast":null,"code":"import \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/checkbox/style\";\nimport _Checkbox from \"antd/lib/checkbox\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport { flatten, groupBy, uniq } from 'lodash';\nimport React from 'react';\nimport styled from 'styled-components';\n\nvar RootComponent =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(RootComponent, _React$Component);\n\n  function RootComponent(props) {\n    var _this;\n\n    _classCallCheck(this, RootComponent);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(RootComponent).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"setNewStatus\", function (newStatus) {\n      _this.setState({\n        status: newStatus\n      }, _this.getAllChecked);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getAllChecked\", function () {\n      if (_this.props.getAllChecked) {\n        var status = _this.state.status; // 如果选择全部子权限, 增加父权限id, 如果没有选择全部子权限, 不传父权限 id\n\n        var _ids = flatten(status.map(function (v) {\n          var checkedList = v.checkedList,\n              subPermissions = v.subPermissions;\n\n          if (checkedList.length >= subPermissions.length && subPermissions.length !== 0) {\n            return [].concat(_toConsumableArray(checkedList), [v.id]);\n          }\n\n          return checkedList;\n        })); // 获取文件中心权限 id\n\n\n        var filteredList = _this.props.permissions.filter(function (v) {\n          return v.name === '文件中心';\n        });\n\n        if (filteredList.length) {\n          _ids = uniq(_ids.concat([filteredList[0].id]));\n        }\n\n        _this.props.getAllChecked(_ids);\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleProps\", function (permissions) {\n      return permissions.map(function (permission) {\n        return _objectSpread({}, permission, {\n          checkedList: [],\n          indeterminate: false,\n          checkAll: false\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (id, subPermissions, checkedList) {\n      var status = _this.state.status;\n      var newStatus = status.map(function (v) {\n        if (v.id === id) {\n          return _objectSpread({}, v, {\n            checkedList: checkedList,\n            indeterminate: !!checkedList.length && checkedList.length < subPermissions.length,\n            checkAll: checkedList.length === subPermissions.length\n          });\n        }\n\n        return v;\n      });\n\n      _this.setNewStatus(newStatus);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onCheckAll\", function (id, subPermissions, _ref) {\n      var checked = _ref.target.checked;\n      var status = _this.state.status; // 判断是否仅有一个一级权限\n\n      var list = subPermissions.length ? subPermissions.map(function (value) {\n        return value.id;\n      }) : [id];\n      var newStatus = status.map(function (v) {\n        if (v.id === id) {\n          return _objectSpread({}, v, {\n            checkedList: checked ? list : [],\n            indeterminate: false,\n            checkAll: checked\n          });\n        }\n\n        return v;\n      });\n\n      _this.setNewStatus(newStatus);\n    });\n\n    _this.state = {\n      status: _this.handleProps(_this.props.permissions)\n    };\n    return _this;\n  }\n\n  _createClass(RootComponent, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // 回填数据\n      if (this.props.permissionsData) {\n        // 筛选出一级分类 id\n        var upperIds = this.props.permissionsData.filter(function (v) {\n          return !v.upperPermission;\n        }).map(function (v) {\n          return v.id;\n        }); // 筛选出二级分类, 并分组\n\n        var groupedData = groupBy(this.props.permissionsData.filter(function (v) {\n          return v.upperPermission;\n        }), 'upperPermission.id');\n        var status = this.state.status;\n\n        var keys = _Object$keys(groupedData);\n\n        var newStatus = status.map(function (v) {\n          if (keys.includes(v.id)) {\n            var checked = groupedData[v.id];\n            return _objectSpread({}, v, {\n              checkedList: checked.map(function (p) {\n                return p.id;\n              }),\n              indeterminate: !!checked.length && checked.length < v.subPermissions.length,\n              checkAll: checked.length === v.subPermissions.length\n            });\n          } else if (upperIds.includes(v.id)) {\n            return _objectSpread({}, v, {\n              checkedList: [v.id],\n              checkAll: true\n            });\n          }\n\n          return v;\n        });\n        this.setNewStatus(newStatus);\n      } else {\n        this.getAllChecked();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var status = this.state.status;\n      return React.createElement(MainWrapper, null, React.createElement(_Form.Item, {\n        label: React.createElement(\"span\", null, \"\\u53EF\\u914D\\u7F6E\\u6743\\u9650\", React.createElement(Tip, null, \"\\u53EF\\u591A\\u9009\")),\n        colon: false\n      }, status.filter(function (permission) {\n        return permission.name !== '文件中心';\n      }).map(function (permission, index) {\n        var id = permission.id,\n            name = permission.name,\n            subPermissions = permission.subPermissions,\n            indeterminate = permission.indeterminate,\n            checkAll = permission.checkAll,\n            checkedList = permission.checkedList;\n        return React.createElement(GroupWrapper, {\n          key: index\n        }, React.createElement(Block, null), React.createElement(_Checkbox, {\n          indeterminate: indeterminate,\n          onChange: _this2.onCheckAll.bind(_this2, id, subPermissions),\n          checked: checkAll\n        }, name, subPermissions.length ? '：' : ''), React.createElement(_Checkbox.Group, {\n          value: checkedList,\n          onChange: _this2.onChange.bind(_this2, id, subPermissions)\n        }, subPermissions.map(function (subPermission, subIndex) {\n          return React.createElement(_Checkbox, {\n            value: subPermission.id,\n            key: subIndex\n          }, subPermission.name);\n        })));\n      })), React.createElement(_Form.Item, {\n        label: \"\\u7CFB\\u7EDF\\u9ED8\\u8BA4\\u6743\\u9650\",\n        colon: false\n      }, React.createElement(GroupWrapper, null, React.createElement(Block, null), React.createElement(_Checkbox, {\n        checked: true,\n        disabled: true\n      }, \"\\u6587\\u4EF6\\u4E2D\\u5FC3\"))));\n    }\n  }]);\n\n  return RootComponent;\n}(React.Component);\n\nexport default RootComponent;\nvar MainWrapper = styled.div.withConfig({\n  displayName: \"RootComponent__MainWrapper\",\n  componentId: \"sc-1mbni4m-0\"\n})([\"flex:1;\"]);\nvar Block = styled.div.withConfig({\n  displayName: \"RootComponent__Block\",\n  componentId: \"sc-1mbni4m-1\"\n})([\"display:inline-block;width:4px;height:12px;margin-right:8px;background-color:#5c86fb;\"]);\nvar GroupWrapper = styled.div.withConfig({\n  displayName: \"RootComponent__GroupWrapper\",\n  componentId: \"sc-1mbni4m-2\"\n})([\"position:relative;line-height:38px;\"]);\nvar Tip = styled.span.withConfig({\n  displayName: \"RootComponent__Tip\",\n  componentId: \"sc-1mbni4m-3\"\n})([\"margin-top:3px;margin-left:10px;font-size:12px;color:#aaa;\"]);","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"antd/lib/menu/style\";\nimport _Menu from \"antd/lib/menu\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport { compareAsc, format } from 'date-fns';\nimport Link from 'next/link';\nimport React from 'react';\nimport Router from 'next/router';\nimport OperationLink from '../../../components/OperationLink';\nimport { overflowRender } from '../../../lib/commonJs';\nimport { recordToTemplateFields } from '../commonJs';\nimport DeleteComponent from './DeleteComponent';\n\nvar TemplateList =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(TemplateList, _React$Component);\n\n  function TemplateList(props) {\n    var _this;\n\n    _classCallCheck(this, TemplateList);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(TemplateList).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"createByThis\", function (record) {\n      var fields = recordToTemplateFields(record);\n\n      _this.props.changeFields(fields);\n\n      _this.props.changeStatus(2);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderOperating\", function (_text, record) {\n      var id = record.id,\n          sessionTemplates = record.sessionTemplates;\n\n      if (_this.state.isCreatePathwayPage) {\n        return React.createElement(Link, {\n          href: '/pathway-template-detail/' + id\n        }, React.createElement(\"a\", null, \"\\u67E5\\u770B\\u8BE6\\u60C5\"));\n      }\n\n      var menu = React.createElement(_Menu, null, React.createElement(_Menu.Item, null, React.createElement(Link, {\n        href: '/pathway-template-detail/' + id\n      }, React.createElement(\"a\", null, \"\\u67E5\\u770B\\u8BE6\\u60C5\"))), React.createElement(_Menu.Item, {\n        onClick: _this.createByThis.bind(_assertThisInitialized(_this), record)\n      }, \"\\u4EE5\\u6B64\\u521B\\u5EFA\\u65B0\\u6A21\\u677F\"), React.createElement(_Menu.Item, null, React.createElement(DeleteComponent, {\n        count: sessionTemplates.length,\n        deleteSuccess: _this.props.refetch,\n        id: id,\n        type: \"template\"\n      })));\n      return React.createElement(OperationLink, {\n        overlay: menu\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderCreatorName\", function (creator) {\n      var text = '';\n\n      if (creator && creator.account && creator.account.person) {\n        var _creator$account$pers = creator.account.person,\n            name = _creator$account$pers.name,\n            nickname = _creator$account$pers.nickname;\n\n        if (name) {\n          text += name;\n        }\n\n        if (nickname) {\n          text += '(' + nickname + ')';\n        }\n      }\n\n      return text;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderIndustries\", function (value) {\n      return value.map(function (industry) {\n        return industry.name;\n      }).join('、');\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderCreatedAt\", function (value) {\n      return format(value, 'YYYY/MM/DD HH:mm');\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"chooseData\", function (record) {\n      _this.props.onSelectTemplate(record);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"sortTime\", function (left, right) {\n      return compareAsc(left.createdAt, right.createdAt);\n    });\n\n    _this.state = {\n      isCreatePathwayPage: false\n    };\n    return _this;\n  } // 点击以此创建新模板\n\n\n  _createClass(TemplateList, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (Router.pathname === '/create-pathway') {\n        this.setState({\n          isCreatePathwayPage: true\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          templates = _this$props.templates,\n          filterIndustryId = _this$props.filterIndustryId;\n      var isCreatePathwayPage = this.state.isCreatePathwayPage; // 处理数据源\n\n      var dataSource = templates.filter(function (template) {\n        if (!filterIndustryId) {\n          return true;\n        }\n\n        var ids = template.industries.map(function (v) {\n          return v.id;\n        });\n        return ids.includes(filterIndustryId);\n      }).map(function (template) {\n        return _objectSpread({\n          key: template.id\n        }, template);\n      }); // 生成表格 column\n\n      var columnsData = [{\n        title: '模板ID',\n        key: 'no',\n        width: '14%'\n      }, {\n        title: '对内模板名称',\n        key: 'name',\n        width: '30%',\n        render: overflowRender\n      }, {\n        title: '行业',\n        key: 'industries',\n        width: '10%',\n        render: this.renderIndustries\n      }, {\n        title: '建议天数',\n        key: 'suggestionDays',\n        width: '11%',\n        render: overflowRender\n      }, {\n        title: '创建者',\n        key: 'creator',\n        width: '11%',\n        render: this.renderCreatorName\n      }, {\n        title: '创建时间',\n        key: 'createdAt',\n        width: '14%',\n        render: this.renderCreatedAt,\n        sorter: this.sortTime\n      }, {\n        title: '操作',\n        key: 'operating',\n        width: '11%',\n        render: this.renderOperating\n      }];\n      var columns = columnsData.map(function (column, index) {\n        var onCell;\n\n        if (index === 1 || index === 3) {\n          var columnsWidth = [158, 294, 120, 90, 122, 150, 80, 80];\n\n          onCell = function onCell() {\n            return {\n              style: {\n                whiteSpace: 'nowrap',\n                maxWidth: columnsWidth[index],\n                overflow: 'hidden',\n                wordBreak: 'break-all'\n              }\n            };\n          };\n        }\n\n        return _objectSpread({}, column, {\n          onCell: onCell,\n          dataIndex: column.key\n        });\n      });\n      return React.createElement(_Table, {\n        style: {\n          flex: 1\n        },\n        locale: {\n          emptyText: isCreatePathwayPage ? '暂无学习计划模版，无法创建学习计划' : '暂无学习计划模版，点击右上角按钮开始创建学习计划模板'\n        },\n        pagination: false,\n        dataSource: dataSource,\n        columns: columns,\n        footer: this.props.footer,\n        rowSelection: isCreatePathwayPage ? {\n          hideDefaultSelections: true,\n          type: 'radio',\n          fixed: false,\n          onSelect: this.chooseData\n        } : null\n      });\n    }\n  }]);\n\n  return TemplateList;\n}(React.Component);\n\nexport default TemplateList;","map":null,"metadata":{},"sourceType":"module"}
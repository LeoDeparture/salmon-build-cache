{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport { addHours } from 'date-fns';\nimport React from 'react';\nimport styled from 'styled-components';\nimport { FlexDisplay, TextContent } from '../../../lib/commonCss';\nimport { dataForModal } from './DataForModal';\n\nvar TemplateFooter =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(TemplateFooter, _React$Component);\n\n  function TemplateFooter(props) {\n    var _this;\n\n    _classCallCheck(this, TemplateFooter);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(TemplateFooter).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"onBack\", function () {\n      _this.props.toSetState({\n        step: 0\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"cancel\", function () {\n      var _this$props = _this.props,\n          getSlotsDetails = _this$props.getSlotsDetails,\n          UpdateAfterCloseModal = _this$props.UpdateAfterCloseModal,\n          toSetState = _this$props.toSetState; // setTimeout(() => {\n\n      UpdateAfterCloseModal();\n      toSetState({\n        step: 0,\n        appointmentTime: null\n      });\n      getSlotsDetails(null, null, false); // }, 500);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"actionFun\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(item, type, action) {\n        var getSlotsDetails;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                getSlotsDetails = _this.props.getSlotsDetails;\n                _context2.next = 3;\n                return _this.props.modalMutation(item.mutation, type).then(\n                /*#__PURE__*/\n                function () {\n                  var _ref2 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee(result) {\n                    var createUnplannedPathway;\n                    return _regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            _this.cancel();\n\n                            if (!result.data) {\n                              _context.next = 8;\n                              break;\n                            }\n\n                            if (!(result.data && result.data.createUnplannedPathway && item.mutation === 'CreateUnplannedPathway')) {\n                              _context.next = 6;\n                              break;\n                            }\n\n                            createUnplannedPathway = result.data.createUnplannedPathway;\n                            window.open(\"/create-pathway/\".concat(createUnplannedPathway.id), '_blank');\n                            return _context.abrupt(\"return\");\n\n                          case 6:\n                            if (action) {\n                              getSlotsDetails(type.id, action, false);\n                            }\n\n                            _message.success(item.message);\n\n                          case 8:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee);\n                  }));\n\n                  return function (_x4) {\n                    return _ref2.apply(this, arguments);\n                  };\n                }()).catch(function () {\n                  _this.setState({\n                    loading: false\n                  });\n                });\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x, _x2, _x3) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"footerActionBut\", function (itemData, item) {\n      var _this$props2 = _this.props,\n          appointmentTime = _this$props2.appointmentTime,\n          cancellationMessage = _this$props2.cancellationMessage,\n          delegationMessage = _this$props2.delegationMessage,\n          targetOperatorId = _this$props2.targetOperatorId;\n      var id = itemData.id,\n          reservation = itemData.reservation;\n\n      _this.setState({\n        loading: true\n      }); // 接受并变更预约时间\n\n\n      if (item.mutation === 'ChangeStudentOperatorReservationTime') {\n        // 当 要更改时间 大于当前时间时 才可以\n        var now = addHours(new Date(), 1).valueOf();\n        var apTime = new Date(appointmentTime).valueOf();\n\n        if (apTime > now) {\n          var typeObject = {\n            appointmentTime: appointmentTime,\n            id: id\n          };\n\n          _this.actionFun(item, typeObject, 'acceptedUnPerformance');\n        } else {\n          _message.error('操作失败，请稍后重试');\n\n          _this.cancel();\n        }\n\n        return;\n      } //  确认取消此预约日程？\n\n\n      if (item.mutation === 'CancelStudentOperatorReservation') {\n        var _typeObject = {\n          cancellationMessage: cancellationMessage,\n          id: id\n        };\n\n        _this.actionFun(item, _typeObject, 'cancel');\n\n        return;\n      } // 改派至其他工作伙伴\n\n\n      if (item.mutation === 'ChangeStudentOperatorReservationOperator') {\n        var _typeObject2 = {\n          delegationMessage: delegationMessage,\n          id: id,\n          targetOperatorId: targetOperatorId\n        };\n\n        _this.actionFun(item, _typeObject2, 'reassign');\n\n        return;\n      } // 立即规划 学习计划\n\n\n      if (item.mutation === 'CreateUnplannedPathway') {\n        var studentAccount = reservation.studentAccount; // 如果没有 ID 创建新的 pathway\n\n        if (!reservation.pathway) {\n          var _typeObject3 = {\n            studentAccountId: studentAccount.id,\n            reservationId: reservation.id\n          };\n\n          _this.actionFun(item, _typeObject3, null);\n        } // 有ID 直接跳转\n\n\n        if (reservation.pathway) {\n          _this.cancel();\n\n          var pathwayId = reservation.pathway.id;\n          window.open(\"/create-pathway/\".concat(pathwayId), '_blank');\n        }\n\n        return;\n      }\n\n      _this.actionFun(item, {\n        id: id\n      }, null);\n    });\n\n    _this.state = {\n      loading: false\n    };\n    return _this;\n  }\n\n  _createClass(TemplateFooter, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var loading = this.state.loading;\n      var _this$props3 = this.props,\n          step = _this$props3.step,\n          action = _this$props3.action,\n          itemData = _this$props3.itemData,\n          disableBut = _this$props3.disableBut;\n      var footerDetail = dataForModal[action][step].footer;\n      return React.createElement(FlexDisplay, null, footerDetail.find(function (v) {\n        return v.name === '确认改派';\n      }) && React.createElement(TextContent, {\n        fontSize: \"12px\",\n        color: \"#9b9b9b\",\n        style: {\n          alignSelf: 'center'\n        }\n      }, \"\\u786E\\u8BA4\\u6539\\u6D3E\\u540E\\uFF0C\\u6B64\\u9884\\u7EA6\\u65E5\\u7A0B\\u5C06\\u5728\\u4F60\\u7684\\u5217\\u8868\\u4E2D\\u9690\\u85CF\\u3002\"), React.createElement(ButtonWrap, null, footerDetail.map(function (item, index) {\n        var typeBoolean = item.name !== '关闭';\n        return React.createElement(_Button, {\n          type: item.style,\n          key: index,\n          loading: typeBoolean ? loading : false,\n          disabled: typeBoolean ? disableBut : false,\n          onClick: _this2[item.fun].bind(_this2, itemData, item)\n        }, item.name);\n      })));\n    }\n  }]);\n\n  return TemplateFooter;\n}(React.Component);\n\nexport default TemplateFooter;\nvar ButtonWrap = styled.div.withConfig({\n  displayName: \"TemplateFooter__ButtonWrap\",\n  componentId: \"sc-1kp81d2-0\"\n})([\"display:flex;flex:1;justify-content:flex-end;\"]); // item.name === '确认变更' ||\n// item.name === '确认改派' ||\n// item.name === '确认取消' ||\n// item.name === '确认删除' ||\n// item.name === '确认已联系学员' ||\n// item.name === '立即规划'","map":null,"metadata":{},"sourceType":"module"}
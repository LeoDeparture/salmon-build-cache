{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport Router from 'next/router';\nimport React, { Component } from 'react';\nimport styled from 'styled-components';\nimport { ApolloConsumer } from 'react-apollo';\nimport LimitedInput from '../../../../../components/Input/LimitedInput';\nimport { MutationCreateChapter, MutationUpdateChapter } from './Mutation';\nimport { QueryGetChapterById } from './QueryGetChapterById';\n\nvar CreateOrEditContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CreateOrEditContainer, _Component);\n\n  function CreateOrEditContainer(props) {\n    var _this;\n\n    _classCallCheck(this, CreateOrEditContainer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CreateOrEditContainer).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"goBack\", function () {\n      Router.back();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onClickCreateBtn\", function () {\n      _this.props.form.validateFields(function (err, values) {\n        if (!err) {\n          _this.setState({\n            loading: true\n          });\n\n          var name = values.name,\n              description = values.description;\n          var mutation;\n          var variables;\n          var mesText; // 编辑状态\n\n          if (_this.isEdit) {\n            var id = Router.query.chapterId;\n            mutation = MutationUpdateChapter;\n            variables = {\n              id: id,\n              name: name,\n              description: description\n            };\n            mesText = '已保存成功';\n          } // create 状态\n\n\n          if (!_this.isEdit) {\n            var seriesId = Router.query.id;\n            variables = {\n              seriesId: seriesId,\n              name: name,\n              description: description\n            };\n            mutation = MutationCreateChapter;\n            mesText = '已成功创建章节';\n          }\n\n          _this.client.mutate({\n            mutation: mutation,\n            variables: {\n              input: variables\n            }\n          }).then(function (_) {\n            _message.destroy();\n\n            _message.success(mesText, 1.5, function () {\n              return Router.back();\n            });\n          }).catch(function (_) {\n            _this.setState({\n              loading: false\n            });\n          });\n        }\n      });\n    });\n\n    _this.state = {\n      loading: false\n    };\n    return _this;\n  }\n\n  _createClass(CreateOrEditContainer, [{\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.setState({\n        loading: false\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var _Router$query = Router.query,\n          type = _Router$query.type,\n          chapterId = _Router$query.chapterId;\n      this.isEdit = type === 'edit';\n\n      if (this.isEdit) {\n        this.client.query({\n          query: QueryGetChapterById,\n          variables: {\n            input: {\n              id: chapterId\n            }\n          }\n        }).then(function (res) {\n          if (res.data.getSkillChapterById) {\n            var setFieldsValue = _this2.props.form.setFieldsValue;\n            var _res$data$getSkillCha = res.data.getSkillChapterById,\n                name = _res$data$getSkillCha.name,\n                description = _res$data$getSkillCha.description;\n            setFieldsValue({\n              name: name,\n              description: description\n            });\n          }\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var getFieldDecorator = this.props.form.getFieldDecorator;\n      var loading = this.state.loading;\n      return React.createElement(ApolloConsumer, null, function (client) {\n        _this3.client = client;\n        return React.createElement(_Form, {\n          colon: false,\n          style: {\n            width: 320\n          }\n        }, React.createElement(_Form.Item, {\n          label: \"\\u7AE0\\u8282\\u540D\\u79F0\"\n        }, getFieldDecorator('name', {\n          rules: [{\n            required: true,\n            message: '当前字段不可为空'\n          }]\n        })(React.createElement(LimitedInput, {\n          placeholder: \"\\u8BF7\\u8F93\\u5165\",\n          limit: 64\n        }))), React.createElement(_Form.Item, {\n          label: \"\\u7AE0\\u8282\\u7B80\\u4ECB\"\n        }, getFieldDecorator('description', {})(React.createElement(_Input.TextArea, {\n          placeholder: \"\\u8BF7\\u8F93\\u5165\"\n        }))), React.createElement(FooterWrapper, null, React.createElement(_Button, {\n          style: {\n            marginRight: 12\n          },\n          onClick: _this3.goBack\n        }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n          type: \"primary\",\n          onClick: _this3.onClickCreateBtn,\n          loading: loading\n        }, _this3.isEdit ? '保存' : '创建章节')));\n      });\n    }\n  }]);\n\n  return CreateOrEditContainer;\n}(Component);\n\nvar CreateOrEditSeries = _Form.create()(CreateOrEditContainer);\n\nexport default CreateOrEditSeries;\nvar FooterWrapper = styled.div.withConfig({\n  displayName: \"CreateOrEditContainer__FooterWrapper\",\n  componentId: \"sc-1jpuvlr-0\"\n})([\"margin:77px 0 59px;\"]);","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from 'react';\nimport Loading from '../../../components/Loading';\nimport TableFooter from '../../../components/Table/TableFooter';\nimport { errMessage } from '../../../lib/commonJs';\nimport TemplateList from '../components/TemplateList';\nimport ListPathwayTemplates, { QueryListPathwayTemplates } from './QueryListPathwayTemplate';\n// interface State {\n//   defaultSortOrder: 'ascend' | 'descend';\n// }\nvar getDataNumber = 10;\n\nvar TemplateListContainer =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(TemplateListContainer, _React$Component);\n\n  function TemplateListContainer(props) {\n    var _this;\n\n    _classCallCheck(this, TemplateListContainer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(TemplateListContainer).call(this, props)); // this.state = {\n    //   loading: false,\n    //   defaultSortOrder: undefined,\n    // };\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      loading: false,\n      pageInfo: {\n        endCursor: '',\n        hasNextPage: true,\n        hasPreviousPage: false,\n        startCursor: ''\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleQueryMore\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.props.onChangeFilter(undefined);\n\n              if (!_this.state.loading) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 3:\n              _this.setState({\n                loading: true\n              });\n\n              if (!_this.state.pageInfo.hasNextPage) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 7;\n              return _this.fetchMore({\n                updateQuery: function updateQuery(prev, _ref2) {\n                  var fetchMoreResult = _ref2.fetchMoreResult;\n\n                  if (!fetchMoreResult) {\n                    return prev;\n                  }\n\n                  var prevData = prev.pathwayTemplates.edges;\n                  var fetchResult = fetchMoreResult.pathwayTemplates.edges;\n                  fetchMoreResult.pathwayTemplates.edges = [].concat(_toConsumableArray(prevData), _toConsumableArray(fetchResult));\n                  return fetchMoreResult;\n                },\n                variables: {\n                  input: {\n                    after: _this.state.pageInfo.endCursor,\n                    first: getDataNumber,\n                    orderBy: 'createdAt_ASC'\n                  }\n                }\n              }).then(function (result) {\n                if (result.data && result.data.pathwayTemplates) {\n                  var pageInfo = result.data.pathwayTemplates.pageInfo;\n\n                  _this.setState({\n                    pageInfo: {\n                      endCursor: pageInfo.endCursor,\n                      hasNextPage: pageInfo.hasNextPage,\n                      startCursor: pageInfo.hasNextPage\n                    },\n                    loading: false\n                  });\n                }\n              }).catch(function () {\n                _message.error('加载失败');\n\n                _this.setState({\n                  loading: false\n                });\n              });\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"requestCompleted\", function (data) {\n      var pageInfo = data.pathwayTemplates.pageInfo;\n\n      _this.setState({\n        pageInfo: pageInfo\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderFooter\", function () {\n      return _this.state.pageInfo.hasNextPage && React.createElement(TableFooter, {\n        isLoading: _this.state.loading,\n        onClickLink: _this.handleQueryMore\n      });\n    });\n\n    return _this;\n  } // public setSortOrder = order => {\n  //   let orderBy;\n  //   if (order === 'ascend') {\n  //     orderBy = 'createdAt_ASC';\n  //   }\n  //   if (order === 'descend') {\n  //     orderBy = 'createdAt_DESC';\n  //   }\n  //   const variables = {\n  //     input: {\n  //       first: 20,\n  //       orderBy,\n  //     },\n  //   };\n  //   this.setState(\n  //     {\n  //       defaultSortOrder: order,\n  //     },\n  //     this.refetch.bind(this, variables),\n  //   );\n  // };\n\n\n  _createClass(TemplateListContainer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.onRef(this);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          changeFields = _this$props.changeFields,\n          changeStatus = _this$props.changeStatus,\n          onSelectTemplate = _this$props.onSelectTemplate,\n          filterIndustryId = _this$props.filterIndustryId;\n      var variable = {\n        input: {\n          first: getDataNumber,\n          orderBy: 'createdAt_ASC'\n        }\n      };\n      return React.createElement(ListPathwayTemplates, {\n        query: QueryListPathwayTemplates,\n        variables: variable,\n        onCompleted: this.requestCompleted,\n        fetchPolicy: \"network-only\",\n        notifyOnNetworkStatusChange: true\n      }, function (_ref3) {\n        var data = _ref3.data,\n            loading = _ref3.loading,\n            error = _ref3.error,\n            refetch = _ref3.refetch,\n            client = _ref3.client,\n            networkStatus = _ref3.networkStatus,\n            fetchMore = _ref3.fetchMore;\n        _this2.client = client;\n        _this2.refetch = refetch;\n\n        if (loading && networkStatus !== 3\n        /*|| networkStatus === 4*/\n        ) {\n            return React.createElement(Loading, null);\n          }\n\n        if (error) {\n          errMessage(error);\n          return null;\n        }\n\n        _this2.fetchMore = fetchMore;\n        var templates = data.pathwayTemplates.edges.map(function (v) {\n          return v.node;\n        }).filter(function (v) {\n          return !v.isDeleted;\n        });\n        return React.createElement(TemplateList, {\n          templates: templates,\n          refetch: refetch,\n          changeFields: changeFields,\n          changeStatus: changeStatus // defaultSortOrder={defaultSortOrder}\n          // setSortOrder={this.setSortOrder}\n          ,\n          onSelectTemplate: onSelectTemplate,\n          filterIndustryId: filterIndustryId,\n          footer: _this2.renderFooter\n        });\n      });\n    }\n  }]);\n\n  return TemplateListContainer;\n}(React.Component);\n\nexport default TemplateListContainer;","map":null,"metadata":{},"sourceType":"module"}
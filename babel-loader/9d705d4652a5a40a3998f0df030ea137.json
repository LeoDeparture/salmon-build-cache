{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from 'react';\nimport { QueryListLineOfBusinesses } from '../../../common/queries/QueryListLineOfBusinesses';\nimport Loading from '../../../components/Loading';\nimport TableFooter from '../../../components/Table/TableFooter';\nimport TutorManagementComponent from '../components/TutorManagementComponent';\nimport FilterTutors, { filterTutorsWithPagination } from './QueryFilterTutors';\n\nvar TutorManagementContainer =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(TutorManagementContainer, _React$Component);\n\n  function TutorManagementContainer() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, TutorManagementContainer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(TutorManagementContainer)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      loading: false,\n      variables: {\n        tutorNo: undefined,\n        nickname: undefined,\n        avatar: undefined,\n        lobIds: undefined,\n        jobTitle: undefined,\n        location: undefined,\n        skip: undefined,\n        after: undefined,\n        before: undefined,\n        first: 20,\n        company: undefined,\n        last: undefined\n      },\n      pageInfo: {\n        hasNextPage: false,\n        hasPreviousPage: false,\n        startCursor: '',\n        endCursor: ''\n      },\n      isShowAllInfo: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"variables\", {\n      input: {\n        first: 20,\n        company: _this.props.company,\n        zhiwenProfessionId: _this.props.zhiwenProfessionId\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"fetchLOBData\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              return _context.abrupt(\"return\", _this.client.query({\n                query: QueryListLineOfBusinesses\n              }));\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"onFilter\", function (condition, value, confirm) {\n      var input = _this.state.variables;\n\n      if (condition === 'lobIds' && value) {\n        _this.variables.input = _objectSpread({}, _this.variables.input, input, _defineProperty({}, condition, value.length ? value : undefined));\n\n        _this.setState({\n          variables: _objectSpread({}, input, _defineProperty({}, condition, value.length ? value : undefined))\n        });\n\n        _this.refetch();\n\n        _this.isShowAllInfo();\n\n        confirm();\n        return;\n      } // 搜索头像时\n\n\n      _this.variables.input = _objectSpread({}, _this.variables.input, input, _defineProperty({}, condition, typeof value === 'number' ? Boolean(value) : undefined));\n\n      _this.refetch();\n\n      _this.setState({\n        variables: _objectSpread({}, input, _defineProperty({}, condition, typeof value === 'number' ? Boolean(value) : undefined))\n      });\n\n      confirm();\n\n      _this.isShowAllInfo();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"isShowAllInfo\", function () {\n      setTimeout(function () {\n        var _this$state$variables = _this.state.variables,\n            company = _this$state$variables.company,\n            lobIds = _this$state$variables.lobIds,\n            location = _this$state$variables.location,\n            jobTitle = _this$state$variables.jobTitle;\n\n        if (!company && (!lobIds || lobIds.length === 0) && !location && !jobTitle) {\n          _this.setState({\n            isShowAllInfo: false\n          });\n        } else {\n          _this.setState({\n            isShowAllInfo: true\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSearch\", function (_condition, _, confirm) {\n      return function () {\n        var input = _this.state.variables;\n        _this.variables.input = _objectSpread({}, _this.variables.input, input);\n\n        _this.refetch();\n\n        confirm();\n\n        _this.isShowAllInfo();\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleReset\", function (condition, clearFilters) {\n      return function () {\n        var input = _this.state.variables;\n\n        var keywords = _objectSpread({}, input);\n\n        keywords[condition] = undefined;\n\n        _this.setState({\n          variables: _objectSpread({}, keywords)\n        });\n\n        _this.variables.input = _objectSpread({}, _this.variables.input, keywords);\n\n        _this.refetch();\n\n        clearFilters();\n\n        _this.isShowAllInfo();\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleChange\", function (condition, setSelectedKeys, e) {\n      var input = _this.state.variables;\n\n      var keywords = _objectSpread({}, input);\n\n      keywords[condition] = e.target.value;\n\n      _this.setState({\n        variables: _objectSpread({}, keywords)\n      });\n\n      setSelectedKeys(e.target.value ? [e.target.value] : []);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"queryMore\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var _this$state, loading, pageInfo, result;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this$state = _this.state, loading = _this$state.loading, pageInfo = _this$state.pageInfo;\n\n              if (loading) {\n                _context2.next = 8;\n                break;\n              }\n\n              _this.setState({\n                loading: true\n              });\n\n              if (!pageInfo.hasNextPage) {\n                _context2.next = 8;\n                break;\n              }\n\n              _context2.next = 6;\n              return _this.fetchMore({\n                updateQuery: function updateQuery(prev, _ref3) {\n                  var fetchMoreResult = _ref3.fetchMoreResult;\n\n                  if (!fetchMoreResult) {\n                    return prev;\n                  }\n\n                  var prevData = prev.tutors.edges;\n                  var fetchResult = fetchMoreResult.tutors.edges;\n                  fetchMoreResult.tutors.edges = [].concat(_toConsumableArray(prevData), _toConsumableArray(fetchResult));\n                  return fetchMoreResult;\n                },\n                variables: {\n                  input: _objectSpread({}, _this.state.variables, {\n                    after: pageInfo.endCursor\n                  })\n                }\n              });\n\n            case 6:\n              result = _context2.sent;\n\n              if (result.loading) {\n                _this.setState({\n                  loading: true\n                });\n              } else {\n                _this.setState({\n                  loading: false\n                });\n              }\n\n            case 8:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"footer\", function () {\n      return _this.state.pageInfo.hasNextPage && React.createElement(TableFooter, {\n        isLoading: _this.state.loading,\n        onClickLink: _this.queryMore\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"listTutorData\", function (data) {\n      return data.map(function (i) {\n        var workEx = i.workExperiences.length ? i.workExperiences[0] : null;\n        var company = workEx !== null ? workEx.company !== null ? workEx.company.companyName : workEx.foreignCompany : '';\n        return _objectSpread({}, i, {\n          company: company,\n          caseAnalysisSkill: i.caseAnalysisSkill ? i.caseAnalysisSkill : 0,\n          cooperativeSkill: i.cooperativeSkill ? i.cooperativeSkill : 0,\n          jobTitle: workEx !== null && workEx.jobTitle,\n          key: i.id,\n          lineOfBusiness: workEx !== null && workEx.lineOfBusiness.parent.name + '/' + workEx.lineOfBusiness.name,\n          location: workEx !== null ? workEx.locationCity !== null ? workEx.locationCity.name : workEx.locationCountry !== null ? workEx.locationCountry.name : null : null,\n          performanceSkill: i.performanceSkill ? i.performanceSkill : 0,\n          majorProfession: i.majorProfession ? i.majorProfession.name : '',\n          professionalSkill: i.professionalSkill ? i.professionalSkill : 0,\n          resumeReviewSkill: i.resumeReviewSkill ? i.resumeReviewSkill : 0,\n          reviewContent: i.reviewContent ? i.reviewContent : '',\n          zhiwenLevel: i.zhiwenLevel ? i.zhiwenLevel.name : ''\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"storePageInfo\", function (data) {\n      var pageInfo = data.tutors.pageInfo;\n\n      _this.setState({\n        pageInfo: pageInfo\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(TutorManagementContainer, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var isShowAllInfo = this.state.isShowAllInfo;\n      return React.createElement(FilterTutors, {\n        query: filterTutorsWithPagination,\n        variables: this.variables,\n        onCompleted: this.storePageInfo,\n        fetchPolicy: \"network-only\",\n        notifyOnNetworkStatusChange: true\n      }, function (_ref4) {\n        var data = _ref4.data,\n            loading = _ref4.loading,\n            error = _ref4.error,\n            fetchMore = _ref4.fetchMore,\n            refetch = _ref4.refetch,\n            client = _ref4.client,\n            networkStatus = _ref4.networkStatus;\n        _this2.fetchMore = fetchMore;\n        _this2.refetch = refetch;\n        _this2.client = client;\n\n        if (loading || networkStatus === 4 || networkStatus === 2) {\n          return React.createElement(Loading, null);\n        }\n\n        if (error) {\n          return null;\n        }\n\n        var nodeData = data.tutors.edges.map(function (i) {\n          return i.node;\n        });\n        return React.createElement(TutorManagementComponent, {\n          listTutor: _this2.listTutorData(nodeData),\n          handleSearch: _this2.handleSearch,\n          variables: _this2.state.variables,\n          handleChange: _this2.handleChange,\n          handleReset: _this2.handleReset,\n          onFilter: _this2.onFilter,\n          footer: _this2.footer,\n          fetchLOBData: _this2.fetchLOBData,\n          isShowAllInfo: isShowAllInfo\n        });\n      });\n    }\n  }]);\n\n  return TutorManagementContainer;\n}(React.Component);\n\nexport default TutorManagementContainer;","map":null,"metadata":{},"sourceType":"module"}
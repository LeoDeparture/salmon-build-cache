{"ast":null,"code":"import \"antd/lib/spin/style\";\nimport _Spin from \"antd/lib/spin\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/icon/style\";\nimport _Icon from \"antd/lib/icon\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport TextArea from 'antd/lib/input/TextArea';\nimport React, { Component } from 'react';\nimport { ApolloConsumer } from 'react-apollo';\nimport Router from 'next/router';\nimport styled from 'styled-components';\nimport LimitedInput from '../../../../components//Input/LimitedInput';\nimport FileUpload from '../../../../components/FileUpload';\nimport NumberInput from '../../../../components/Input/NumberInput';\nimport ZhiWenSelect from '../../../../components/Select/ZhiWenSelect';\nimport { LabelDescription, LabelWrapper } from '../../../service/components/CSSComponents';\nimport { QueryGetQuestionBankById } from '../../detail/containers/QueryGetQuestionBankById';\nimport { MutationCreateQuestionBank, MutationUpdateQuestionBank } from './MutationCreateQuestionBank';\nimport { QueryIsQuestionFileValid } from './QueryCreateQuestionBank';\n\nvar CreateQuestion =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CreateQuestion, _Component);\n\n  function CreateQuestion(props) {\n    var _this;\n\n    _classCallCheck(this, CreateQuestion);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CreateQuestion).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"isEdit\", Router.query.id);\n\n    _defineProperty(_assertThisInitialized(_this), \"onClickCreateBtn\", function () {\n      _this.props.form.validateFields(function (err, values) {\n        if (!err) {\n          _this.setState({\n            loading: true\n          });\n\n          if (_this.isEdit) {\n            _this.client.mutate({\n              mutation: MutationUpdateQuestionBank,\n              variables: {\n                input: _objectSpread({}, values, {\n                  id: _this.isEdit\n                })\n              }\n            }).then(function (res) {\n              if (res.data.updateQuestionBank) {\n                _message.destroy();\n\n                _message.success('已成功编辑套题', 1.5, function () {\n                  Router.back();\n                });\n              }\n            }).catch(function (_) {\n              _this.setState({\n                loading: false\n              });\n            });\n\n            return;\n          }\n\n          _this.client.mutate({\n            mutation: MutationCreateQuestionBank,\n            variables: {\n              input: _objectSpread({}, values)\n            }\n          }).then(function (res) {\n            if (res.data.createQuestionBank) {\n              _message.destroy();\n\n              _message.success('已成功创建套题', 1.5, function () {\n                Router.back();\n              });\n            }\n          }).catch(function (_) {\n            _this.setState({\n              loading: false\n            });\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"goBack\", function () {\n      Router.back();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"uploadFile\", function (file) {\n      if (file.length) {\n        var _file = file[file.length - 1],\n            response = _file.response,\n            name = _file.name;\n\n        _this.setState({\n          visible: true\n        });\n\n        _this.client.query({\n          query: QueryIsQuestionFileValid,\n          variables: {\n            input: {\n              url: response,\n              filename: name\n            }\n          }\n        }).then(function (res) {\n          if (res.data && res.data.isQuestionFileValid.isValid) {\n            if (_this.uploadRef && file.length >= 2) {\n              _this.uploadRef.clearLastUpLoad();\n            }\n\n            if (_this.state.isFirst) {\n              var fileLinkId = res.data.isQuestionFileValid.fileLink.id;\n\n              _this.props.form.setFieldsValue({\n                fileLinkId: fileLinkId\n              });\n\n              _message.success('已成功上传文件');\n            }\n\n            _this.setState({\n              isFirst: true,\n              visible: false\n            });\n          }\n\n          if (res.data && !res.data.isQuestionFileValid.isValid) {\n            if (_this.uploadRef && file.length >= 2) {\n              _this.uploadRef.clearNextUpLoad();\n\n              _this.setState({\n                isFirst: false,\n                visible: false\n              });\n            }\n\n            if (file.length === 1) {\n              _this.uploadRef.clearAllUpLoad();\n\n              _this.setState({\n                visible: false\n              });\n            }\n\n            _Modal.warning({\n              icon: React.createElement(_Icon, {\n                type: \"exclamation-circle\",\n                theme: \"filled\"\n              }),\n              title: React.createElement(\"div\", {\n                style: {\n                  color: '#42526E'\n                }\n              }, \"\\u6682\\u65F6\\u65E0\\u6CD5\\u521B\\u5EFA\\u5957\\u9898\"),\n              content: React.createElement(\"div\", {\n                style: {\n                  color: '#42526E'\n                }\n              }, \"\\u9898\\u76EE\\u6587\\u4EF6\\u683C\\u5F0F\\u6216\\u5185\\u5BB9\\u9519\\u8BEF\\uFF0C\\u8BF7\\u6838\\u5BF9\\u540E\\u4E0A\\u4F20\\u3002\")\n            });\n          }\n        });\n      } else {\n        _this.props.form.setFieldsValue({\n          fileLinkId: undefined\n        });\n\n        _this.setState({\n          isFirst: true\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"bindUploadRef\", function (e) {\n      _this.uploadRef = e;\n    });\n\n    _this.state = {\n      loading: false,\n      fileData: null,\n      visible: false,\n      isFirst: true\n    };\n    return _this;\n  }\n\n  _createClass(CreateQuestion, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var setFieldsValue = this.props.form.setFieldsValue;\n\n      if (this.isEdit) {\n        this.client.query({\n          query: QueryGetQuestionBankById,\n          variables: {\n            id: Router.query.id\n          }\n        }).then(function (result) {\n          if (result.data.getQuestionBankById) {\n            var _result$data$getQuest = result.data.getQuestionBankById,\n                name = _result$data$getQuest.name,\n                industries = _result$data$getQuest.industries,\n                duration = _result$data$getQuest.duration,\n                passScore = _result$data$getQuest.passScore,\n                innerRemarks = _result$data$getQuest.innerRemarks,\n                introduction = _result$data$getQuest.introduction,\n                questionFile = _result$data$getQuest.questionFile;\n            setFieldsValue({\n              name: name,\n              industryIds: industries.map(function (v) {\n                return v.id;\n              }),\n              duration: duration,\n              passScore: passScore,\n              innerRemarks: innerRemarks,\n              introduction: introduction,\n              fileLinkId: questionFile.id\n            });\n\n            _this2.setState({\n              fileData: _objectSpread({}, questionFile.file, {\n                uid: '',\n                size: 0,\n                type: '',\n                response: questionFile.file.url,\n                name: questionFile.file.filename\n              })\n            });\n\n            _this2.uploadRef.setFileListState([_objectSpread({}, questionFile.file, {\n              uid: '',\n              size: 0,\n              type: '',\n              response: questionFile.file.url,\n              name: questionFile.file.filename\n            })]);\n          }\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.setState({\n        loading: false\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var getFieldDecorator = this.props.form.getFieldDecorator;\n      var _this$state = this.state,\n          visible = _this$state.visible,\n          loading = _this$state.loading;\n      return React.createElement(ApolloConsumer, null, function (client) {\n        _this3.client = client;\n        return React.createElement(React.Fragment, null, React.createElement(_Form, {\n          style: {\n            width: '50%'\n          }\n        }, React.createElement(_Form.Item, {\n          label: \"\\u5957\\u9898\\u540D\\u79F0\",\n          colon: false\n        }, getFieldDecorator('name', {\n          rules: [{\n            required: true,\n            message: '当前字段不可为空'\n          }]\n        })(React.createElement(LimitedInput, {\n          placeholder: \"\\u8BF7\\u8F93\\u5165\",\n          limit: 15\n        }))), React.createElement(_Form.Item, {\n          colon: false,\n          label: \"\\u5957\\u9898\\u4ECB\\u7ECD\"\n        }, getFieldDecorator('introduction')(React.createElement(TextArea, {\n          rows: 3,\n          placeholder: \"\\u8BF7\\u8F93\\u5165\"\n        }))), React.createElement(_Form.Item, {\n          label: \"\\u6240\\u5C5E\\u884C\\u4E1A\",\n          colon: false\n        }, getFieldDecorator('industryIds', {\n          rules: [{\n            required: true,\n            message: '当前字段不可为空'\n          }]\n        })(React.createElement(ZhiWenSelect, {\n          type: \"zhiwen-profession\",\n          mode: \"multiple\"\n        }))), React.createElement(_Form.Item, {\n          style: {\n            width: 200\n          },\n          label: React.createElement(LabelWrapper, null, React.createElement(\"label\", null, \"\\u9898\\u76EE\\u6587\\u4EF6\"), _this3.isEdit ? React.createElement(CanNotEditMentation, null, \"\\u6682\\u65F6\\u65E0\\u6CD5\\u7F16\\u8F91\") : React.createElement(DownLoadLabel, {\n            href: \"https://zw-contract.s3.cn-northwest-1.amazonaws.com.cn/%E9%A2%98%E5%BA%93%E6%A8%A1%E6%9D%BF.xlsx\",\n            download: \"\\u9898\\u5E93\\u6A21\\u7248\"\n          }, \"\\u4E0B\\u8F7D\\u6A21\\u7248\")),\n          colon: false\n        }, getFieldDecorator('fileLinkId', {\n          rules: [{\n            required: true,\n            message: '当前字段不可为空'\n          }]\n        })(React.createElement(FileUpload, {\n          canEdit: !Boolean(_this3.isEdit),\n          ref: _this3.bindUploadRef,\n          onChangeValue: _this3.uploadFile,\n          multipleUpload: false,\n          canDownload: true,\n          desText: \"\\u53EA\\u80FD\\u4E0A\\u4F20\\u4E00\\u4E2A\\u9898\\u76EE\\u6587\\u4EF6\\uFF0C\\u652F\\u6301 .xlsx, .xls\"\n        }))), React.createElement(_Form.Item, {\n          label: \"\\u8003\\u8BD5\\u65F6\\u957F\",\n          colon: false\n        }, getFieldDecorator('duration', {\n          rules: [{\n            required: true,\n            message: '当前字段不可为空'\n          }]\n        })(React.createElement(NumberInput, {\n          min: 1,\n          precision: 0,\n          style: {\n            width: '164px',\n            marginRight: '8px'\n          },\n          placeholder: \"\\u8BF7\\u8F93\\u5165\"\n        })), React.createElement(\"span\", null, \"\\u5206\\u949F\")), React.createElement(_Form.Item, {\n          label: \"\\u5408\\u683C\\u5206\\u6570\",\n          colon: false\n        }, getFieldDecorator('passScore', {\n          rules: [{\n            required: true,\n            message: '当前字段不可为空'\n          }]\n        })(React.createElement(NumberInput, {\n          min: 1,\n          max: 100,\n          precision: 0,\n          style: {\n            width: '164px',\n            marginRight: '8px'\n          },\n          placeholder: \"\\u8BF7\\u8F93\\u5165\"\n        })), React.createElement(\"span\", null, \"\\u5206\")), React.createElement(_Form.Item, {\n          colon: false,\n          label: React.createElement(LabelWrapper, null, React.createElement(\"label\", null, \"\\u5BF9\\u5185\\u5907\\u6CE8\"), React.createElement(LabelDescription, null, \"\\u4EC5\\u5BF9\\u5185\\u53EF\\u89C1\"))\n        }, getFieldDecorator('innerRemarks')(React.createElement(TextArea, {\n          rows: 3,\n          placeholder: \"\\u8BF7\\u8F93\\u5165\"\n        }))), React.createElement(FooterWrapper, null, React.createElement(_Button, {\n          style: {\n            marginRight: 12\n          },\n          onClick: _this3.goBack\n        }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n          type: \"primary\",\n          onClick: _this3.onClickCreateBtn,\n          loading: loading\n        }, _this3.isEdit ? '保存' : '创建套题'))), React.createElement(_Modal, {\n          width: 400,\n          bodyStyle: {\n            padding: 0\n          },\n          visible: visible,\n          closable: false,\n          destroyOnClose: true,\n          footer: null,\n          maskClosable: false,\n          centered: true\n        }, React.createElement(\"div\", {\n          style: _objectSpread({\n            width: '100%'\n          }, ModalStyle)\n        }, React.createElement(_Spin, {\n          size: \"large\",\n          style: {\n            marginBottom: 14\n          }\n        }), React.createElement(\"div\", null, \"\\u6B63\\u5728\\u89E3\\u6790\\u9898\\u76EE\\u6587\\u4EF6\"))));\n      });\n    }\n  }]);\n\n  return CreateQuestion;\n}(Component);\n\nexport default _Form.create()(CreateQuestion);\nvar FooterWrapper = styled.div.withConfig({\n  displayName: \"CreateQuestionContainer__FooterWrapper\",\n  componentId: \"sc-17xf8u-0\"\n})([\"margin:77px 0 59px;\"]);\nvar ModalStyle = {\n  height: 188,\n  display: 'flex',\n  flexDirection: 'column',\n  justifyContent: 'center',\n  alignItems: 'center'\n};\nvar DownLoadLabel = styled.a.withConfig({\n  displayName: \"CreateQuestionContainer__DownLoadLabel\",\n  componentId: \"sc-17xf8u-1\"\n})([\"display:inline-block;margin-left:8px;font-size:12px;color:#5674bf;\"]);\nvar CanNotEditMentation = styled.span.withConfig({\n  displayName: \"CreateQuestionContainer__CanNotEditMentation\",\n  componentId: \"sc-17xf8u-2\"\n})([\"display:inline-block;margin-left:8px;font-size:12px;color:#a2aab8;\"]);","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/date-picker/style\";\nimport _DatePicker from \"antd/lib/date-picker\";\nimport moment from 'moment';\nimport React from 'react';\nimport { time2UTC } from '../../../lib/date';\nimport { renderOption } from '../containers/TutorDetailsContainers';\nvar MonthPicker = _DatePicker.MonthPicker;\nvar FormItem = _Form.Item;\nvar dateType = 'YYYY-MM';\n\nvar RegistrationForm =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(RegistrationForm, _React$Component);\n\n  function RegistrationForm() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, RegistrationForm);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(RegistrationForm)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      loading: false,\n      listSchool: [],\n      value: ''\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (value) {\n      if (_this.timeout) {\n        clearTimeout(_this.timeout);\n        _this.timeout = null;\n      }\n\n      var getFetch =\n      /*#__PURE__*/\n      function () {\n        var _ref = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee() {\n          var result;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (!value) {\n                    _context.next = 7;\n                    break;\n                  }\n\n                  _context.next = 3;\n                  return _this.props.queryListSchools(value);\n\n                case 3:\n                  result = _context.sent;\n\n                  _this.setState({\n                    listSchool: result.data.listSchools\n                  });\n\n                  _context.next = 8;\n                  break;\n\n                case 7:\n                  _this.setState({\n                    listSchool: []\n                  });\n\n                case 8:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function getFetch() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n\n      _this.timeout = setTimeout(getFetch, 500);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"componentDidMount\", function () {\n      var _this$props$education = _this.props.educationExperiences,\n          degree = _this$props$education.degree,\n          graduateTime = _this$props$education.graduateTime,\n          major = _this$props$education.major,\n          school = _this$props$education.school,\n          schoolCategory = _this$props$education.schoolCategory,\n          startTime = _this$props$education.startTime;\n\n      if (_this.props.type === 'edit') {\n        _this.props.form.setFieldsValue({\n          degreeId: degree.id,\n          graduateTime: moment(graduateTime, dateType),\n          major: major,\n          schoolCategoryId: schoolCategory.id,\n          schoolId: school.name,\n          startTime: moment(startTime, dateType)\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSubmit\", function (e) {\n      _this.setState({\n        loading: true\n      });\n\n      e.preventDefault();\n\n      _this.props.form.validateFieldsAndScroll(function (err, fieldsValue) {\n        if (!err) {\n          var values = _objectSpread({}, fieldsValue, {\n            graduateTime: time2UTC(new Date(fieldsValue.graduateTime._d).setHours(8, 0, 0)),\n            startTime: time2UTC(new Date(fieldsValue.startTime._d).setHours(8, 0, 0))\n          });\n\n          if (_this.props.type === 'add') {\n            _this.props.mutationCreate(values).then(function (success) {\n              if (success) {\n                _this.props.changeState('addEducation', false);\n              }\n\n              _this.setState({\n                loading: false\n              });\n            });\n          } else {\n            var school = _this.props.educationExperiences.school;\n\n            if (values.schoolId === school.name) {\n              values.schoolId = school.id;\n            }\n\n            values.id = _this.props.educationExperiences.id;\n\n            _this.props.mutationUpdate(values).then(function (success) {\n              _this.setState({\n                loading: false\n              });\n\n              if (success) {\n                _this.props.changeState('edit', false);\n              }\n            });\n          }\n        } else {\n          _this.setState({\n            loading: false\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCancel\", function () {\n      _this.props.type === 'add' ? _this.props.changeState('addEducation', false) : _this.props.changeState('edit', false);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateGraduateTime\", function (_rule, _value, callback) {\n      var getFieldValue = _this.props.form.getFieldValue;\n      var endAt = getFieldValue('graduateTime');\n      var startAt = getFieldValue('startTime');\n\n      if (startAt && endAt && moment(endAt).isBefore(moment(startAt))) {\n        callback(\"\\u6BD5\\u4E1A\\u65F6\\u95F4\\u4E0D\\u80FD\\u65E9\\u4E8E\\u5165\\u5B66\\u65F6\\u95F4\");\n      }\n\n      callback();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateOtherField\", function (type, _rule, _value, callback) {\n      var validateFieldsAndScroll = _this.props.form.validateFieldsAndScroll;\n      validateFieldsAndScroll([type], {\n        force: true\n      }, function () {\n        return;\n      });\n      callback();\n    });\n\n    return _this;\n  }\n\n  _createClass(RegistrationForm, [{\n    key: \"render\",\n    value: function render() {\n      var index = this.props.index;\n      var getFieldDecorator = this.props.form.getFieldDecorator;\n      return React.createElement(_Form, {\n        onSubmit: this.handleSubmit,\n        style: {\n          width: '100%',\n          backgroundColor: '#fff'\n        }\n      }, React.createElement(\"p\", {\n        style: {\n          color: '#BFBFBF'\n        }\n      }, \"\\u6559\\u80B2\\u7ECF\\u5386\".concat(index || '')), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 10\n      }, React.createElement(FormItem, {\n        label: \"\\u6BD5\\u4E1A\\u5B66\\u6821\",\n        colon: false\n      }, getFieldDecorator('schoolId', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(_Select, {\n        showSearch: true,\n        placeholder: \"\\u8BF7\\u641C\\u7D22\",\n        filterOption: false,\n        defaultActiveFirstOption: false,\n        onSearch: this.onChange,\n        notFoundContent: null\n      }, this.state.listSchool.map(function (item) {\n        return React.createElement(_Select.Option, {\n          value: item.id,\n          key: item.id\n        }, item.name);\n      }))))), React.createElement(_Col, {\n        span: 10,\n        offset: 4\n      }, React.createElement(FormItem, {\n        label: \"\\u5B66\\u6821\\u7C7B\\u578B\",\n        colon: false\n      }, getFieldDecorator('schoolCategoryId', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(_Select, {\n        placeholder: \"\\u8BF7\\u9009\\u62E9\"\n      }, renderOption(this.props.listSchoolCategoryEnum)))))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 10\n      }, React.createElement(FormItem, {\n        label: \"\\u5165\\u5B66\\u65F6\\u95F4\",\n        colon: false\n      }, getFieldDecorator('startTime', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }, {\n          validator: this.validateOtherField.bind(this, 'graduateTime')\n        }]\n      })(React.createElement(MonthPicker, {\n        placeholder: \"\\u8BF7\\u9009\\u62E9\",\n        style: {\n          width: '100%'\n        }\n      })))), React.createElement(_Col, {\n        span: 10,\n        offset: 4\n      }, React.createElement(FormItem, {\n        label: \"\\u6BD5\\u4E1A\\u65F6\\u95F4\",\n        colon: false\n      }, getFieldDecorator('graduateTime', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }, {\n          validator: this.validateGraduateTime\n        }]\n      })(React.createElement(MonthPicker, {\n        placeholder: \"\\u8BF7\\u9009\\u62E9\",\n        style: {\n          width: '100%'\n        }\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 10\n      }, React.createElement(FormItem, {\n        label: \"\\u4E13\\u4E1A\",\n        colon: false\n      }, getFieldDecorator('major', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(_Input, {\n        placeholder: \"\\u8BF7\\u8F93\\u5165\",\n        maxLength: 30\n      })))), React.createElement(_Col, {\n        span: 10,\n        offset: 4\n      }, React.createElement(FormItem, {\n        label: \"\\u6240\\u83B7\\u5B66\\u4F4D\",\n        colon: false\n      }, getFieldDecorator('degreeId', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(_Select, {\n        placeholder: \"\\u8BF7\\u9009\\u62E9\"\n      }, renderOption(this.props.listDegreeEnum)))))), React.createElement(FormItem, {\n        labelCol: {\n          span: 12\n        }\n      }, React.createElement(_Button, {\n        onClick: this.handleCancel\n      }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n        style: {\n          marginLeft: 20\n        },\n        type: \"primary\",\n        htmlType: \"submit\",\n        loading: this.state.loading\n      }, \"\\u4FDD\\u5B58\")));\n    }\n  }]);\n\n  return RegistrationForm;\n}(React.Component);\n\nvar WrappedRegistrationForm = _Form.create()(RegistrationForm);\n\nexport default WrappedRegistrationForm;","map":null,"metadata":{},"sourceType":"module"}
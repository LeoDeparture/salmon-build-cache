{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport Router from 'next/router';\nimport React from 'react';\nimport { ApolloConsumer } from 'react-apollo';\nimport QueryGetGroupCourseById, { getGroupCourseById } from '../../groupCourseDetails/containers/QueryGetGroupCourseById';\nimport QueryGetPrivateCourseById, { getPrivateCourseById } from '../../privateCourse/privateCourseDetails/containers/QueryGetPrivateCourseById';\nimport Loading from '../../../components/Loading';\nimport CreateCourseComponents from '../components/CreateCourseComponents';\nimport DisplayCourseComponents from '../components/DisplayCourseComponents';\n\nvar CourseDetailsContainer =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(CourseDetailsContainer, _React$Component);\n\n  function CourseDetailsContainer() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CourseDetailsContainer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CourseDetailsContainer)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      id: '',\n      mutating: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"variables\", {\n      input: {\n        id: undefined\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"componentDidMount\", function () {\n      var routerData = Router.router.query;\n      _this.variables.input.id = routerData.id;\n\n      _this.setState({\n        id: routerData.id\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"mutations\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(mutationName, variables) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!_this.state.mutating) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                _this.setState({\n                  mutating: true\n                });\n\n                return _context.abrupt(\"return\", _this.client.mutate({\n                  mutation: mutationName,\n                  variables: variables\n                }).then(function (res) {\n                  _this.setState({\n                    mutating: false\n                  });\n\n                  return _Promise.resolve(res);\n                }).catch(function (e) {\n                  _this.setState({\n                    mutating: false\n                  });\n\n                  return _Promise.reject(e);\n                }));\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x, _x2) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCreate\",\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(value) {\n        var variables;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                variables = {\n                  input: _objectSpread({}, value)\n                };\n                return _context2.abrupt(\"return\", _this.mutations(_this.props.createMutation, variables));\n\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function (_x3) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleUpdate\",\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(value) {\n        var variables;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                variables = {\n                  input: _objectSpread({}, value, {\n                    id: _this.state.id\n                  })\n                };\n                return _context3.abrupt(\"return\", _this.mutations(_this.props.updateMutation, variables));\n\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x4) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleStatusChange\",\n    /*#__PURE__*/\n    function () {\n      var _ref4 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(id, statusName) {\n        var mutation, variables;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                mutation = statusName === '移除' ? _this.props.removeMutation : statusName === '下线' ? _this.props.disableMutation : _this.props.enableMutation;\n                variables = {\n                  input: {\n                    id: id\n                  }\n                };\n                return _context4.abrupt(\"return\", _this.mutations(mutation, variables));\n\n              case 3:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      return function (_x5, _x6) {\n        return _ref4.apply(this, arguments);\n      };\n    }());\n\n    return _this;\n  }\n\n  _createClass(CourseDetailsContainer, [{\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps, nextState) {\n      var _this$state = this.state,\n          id = _this$state.id,\n          mutating = _this$state.mutating;\n      var isCollapse = this.props.isCollapse;\n\n      if (nextState.id === id && mutating === nextState.mutating && isCollapse === nextProps.isCollapse) {\n        return false;\n      }\n\n      return true;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          courseType = _this$props.courseType,\n          getLazyLoadValue = _this$props.getLazyLoadValue;\n      var isCreating = this.props.createMutation;\n\n      if (isCreating) {\n        return React.createElement(ApolloConsumer, null, function (client) {\n          _this2.client = client;\n          return React.createElement(CreateCourseComponents, {\n            courseType: courseType,\n            createHandler: _this2.handleCreate\n          });\n        });\n      }\n\n      if (courseType === 'PRIVATE_COURSE') {\n        return React.createElement(QueryGetPrivateCourseById, {\n          query: getPrivateCourseById,\n          fetchPolicy: \"network-only\",\n          variables: this.variables\n        }, function (_ref5) {\n          var data = _ref5.data,\n              loading = _ref5.loading,\n              error = _ref5.error,\n              client = _ref5.client;\n          _this2.client = client;\n\n          if (loading) {\n            return React.createElement(Loading, null);\n          }\n\n          if (error) {\n            return null;\n          }\n\n          if (data && data.getPrivateCourseById) {\n            return React.createElement(DisplayCourseComponents, {\n              isCollapse: false,\n              courseData: data.getPrivateCourseById,\n              courseType: courseType,\n              statusChangeHandler: _this2.handleStatusChange,\n              updateHandler: _this2.handleUpdate\n            });\n          }\n\n          return null;\n        });\n      }\n\n      if (courseType === 'GROUP_COURSE') {\n        return React.createElement(QueryGetGroupCourseById, {\n          query: getGroupCourseById,\n          variables: this.variables\n        }, function (_ref6) {\n          var data = _ref6.data,\n              loading = _ref6.loading,\n              error = _ref6.error,\n              client = _ref6.client;\n\n          if (loading) {\n            return React.createElement(Loading, null);\n          }\n\n          if (error) {\n            return null;\n          }\n\n          _this2.client = client;\n\n          if (data.getGroupCourseById) {\n            return React.createElement(DisplayCourseComponents, {\n              isCollapse: _this2.props.isCollapse,\n              courseData: data.getGroupCourseById,\n              courseType: courseType,\n              getLazyLoadValue: getLazyLoadValue,\n              statusChangeHandler: _this2.handleStatusChange,\n              updateHandler: _this2.handleUpdate\n            });\n          }\n\n          return null;\n        });\n      }\n\n      return null;\n    }\n  }]);\n\n  return CourseDetailsContainer;\n}(React.Component);\n\nexport default CourseDetailsContainer;","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import \"antd/lib/config-provider/style\";\nimport _ConfigProvider from \"antd/lib/config-provider\";\nimport \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport { addMinutes, format } from 'date-fns';\nimport React from 'react';\nimport styled from 'styled-components';\nimport EmptyComponents from '../../../components/Empty';\nimport Loading from '../../../components/Loading';\nimport TableFooter from '../../../components/Table/TableFooter';\nimport ListGroupCourseSlotsWithPagination, { listGroupCourseSlotsWithPagination } from './ListGroupCourseSlotsWithPagination';\nimport { claimGroupCourseSlot } from './MutationClaimGroupCourseSlot';\nimport TitleSelect from './TitleSelect';\nvar getDataNumber = 20;\nvar TableTitle = styled.span.withConfig({\n  displayName: \"ScheduleManagement__TableTitle\",\n  componentId: \"sc-121jq0k-0\"\n})([\"font-size:14px;\"]);\nvar CategoryName = styled.span.withConfig({\n  displayName: \"ScheduleManagement__CategoryName\",\n  componentId: \"sc-121jq0k-1\"\n})([\"display:block;max-width:\", \"px;overflow:hidden;font-size:14px;text-overflow:ellipsis;white-space:nowrap;\"], function (props) {\n  return props.width;\n});\n\nvar ScheduleManagement =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ScheduleManagement, _React$Component);\n\n  function ScheduleManagement() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, ScheduleManagement);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(ScheduleManagement)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"variables\", {\n      input: {\n        first: getDataNumber,\n        where: {\n          claimant: null,\n          groupCourse: {\n            industry: {}\n          }\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      defaultListValue: [],\n      id: '',\n      listData: [],\n      loading: false,\n      pageInfo: {\n        endCursor: '',\n        hasNextPage: ''\n      },\n      visible: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showModal\", function (_, b) {\n      _this.setState({\n        id: b.id\n      });\n\n      _Modal.confirm({\n        title: '确认要接受此小班课排期任务吗？',\n        content: React.createElement(TableTitle, null, \"\\u63A5\\u53D7\\u540E\\u5176\\u4ED6\\u5DE5\\u4F5C\\u4F19\\u4F34\\u5C06\\u65E0\\u6CD5\\u518D\\u770B\\u5230\\u6B64\\u6761\\u4EFB\\u52A1\\uFF0C\\u4F60\\u5C06\\u662F\\u6B64\\u4EFB\\u52A1\\u7684\\u8D1F\\u8D23\\u4EBA\\u3002\"),\n        okText: '确认接受',\n        cancelText: '取消',\n        onOk: _this.handleOk\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"refetchList\", function (id) {\n      // tslint:disable-next-line:prefer-conditional-expression\n      if (id === 'all') {\n        _this.variables.input.where.groupCourse.industry = {};\n      } else {\n        _this.variables.input.where.groupCourse.industry = {\n          id: id\n        };\n      }\n\n      _this.refetch({\n        variables: _this.variables\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOk\", function () {\n      var filterFun = function filterFun(data, result2) {\n        var edgesData = data.listGroupCourseSlotsWithPagination.edges;\n        edgesData.forEach(function (item, index) {\n          if (item.node.id === result2.data.claimGroupCourseSlot.id) {\n            edgesData.splice(index, 1);\n          }\n        });\n        return data;\n      };\n\n      _message.destroy();\n\n      _message.loading('加载中...');\n\n      _this.client.mutate({\n        mutation: claimGroupCourseSlot,\n        update: function update(proxy, result2) {\n          var data = proxy.readQuery({\n            query: listGroupCourseSlotsWithPagination,\n            variables: _this.variables\n          });\n          var data2 = filterFun(data, result2);\n          proxy.writeQuery({\n            data: data2,\n            query: listGroupCourseSlotsWithPagination,\n            variables: _this.variables\n          });\n        },\n        variables: {\n          input: {\n            id: _this.state.id\n          }\n        }\n      }).then(function (result) {\n        if (result.data.claimGroupCourseSlot) {\n          _this.props.getValue('refetchListFun', 'refetchAccept');\n\n          _message.destroy();\n\n          _message.success('已成功接受排期');\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getCheckboxData\", function (v) {\n      _this.setState({\n        defaultListValue: v\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"queryMore\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var _this$state, loading, pageInfo;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$state = _this.state, loading = _this$state.loading, pageInfo = _this$state.pageInfo;\n\n              if (loading) {\n                _context.next = 7;\n                break;\n              }\n\n              _this.setState({\n                loading: true\n              });\n\n              if (!pageInfo.hasNextPage) {\n                _context.next = 7;\n                break;\n              }\n\n              _context.next = 6;\n              return _this.fetchMore({\n                updateQuery: function updateQuery(prev, _ref2) {\n                  var fetchMoreResult = _ref2.fetchMoreResult;\n\n                  if (!fetchMoreResult) {\n                    return prev;\n                  }\n\n                  var prevData = prev.listGroupCourseSlotsWithPagination.edges;\n                  var fetchResult = fetchMoreResult.listGroupCourseSlotsWithPagination.edges;\n                  fetchMoreResult.listGroupCourseSlotsWithPagination.edges = [].concat(_toConsumableArray(prevData), _toConsumableArray(fetchResult));\n                  return fetchMoreResult;\n                },\n                variables: {\n                  input: _objectSpread({}, _this.variables.input, {\n                    after: pageInfo.endCursor,\n                    first: getDataNumber\n                  })\n                }\n              }).then(function (result) {\n                if (result.data) {\n                  _this.setState({\n                    loading: false\n                  });\n                }\n              });\n\n            case 6:\n              return _context.abrupt(\"return\");\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"footer\", function () {\n      return _this.state.pageInfo.hasNextPage && React.createElement(TableFooter, {\n        isLoading: _this.state.loading,\n        onClickLink: _this.queryMore\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"storePageInfo\", function (data) {\n      var pageInfo = data.listGroupCourseSlotsWithPagination.pageInfo;\n\n      _this.setState({\n        pageInfo: {\n          endCursor: pageInfo.endCursor,\n          hasNextPage: pageInfo.hasNextPage\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"filterData\", function (data) {\n      var operatorAccounts = [];\n      var dataArr = data.listGroupCourseSlotsWithPagination.edges;\n\n      if (dataArr.length) {\n        dataArr.forEach(function (i) {\n          var appointDeadLine = format(addMinutes(i.node.time, -i.node.appointDeadline), 'YYYY/MM/DD HH:mm');\n          operatorAccounts.push(_objectSpread({}, i.node, {\n            industry: i.node.groupCourse.industry.name,\n            key: i.node.id,\n            name: i.node.groupCourse.name,\n            range: \"\".concat(i.node.min, \" ~ \").concat(i.node.max),\n            studentAccountsLength: i.node.studentAccounts.length,\n            time: format(i.node.time, 'YYYY/MM/DD HH:mm'),\n            appointDeadLine: appointDeadLine\n          }));\n        });\n      }\n\n      return operatorAccounts;\n    });\n\n    return _this;\n  }\n\n  _createClass(ScheduleManagement, [{\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (this.props.tabs !== nextProps.tabs) {\n        this.refetch();\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var listData = [];\n      var allEnum = JSON.parse(localStorage.getItem('zhiwen_all_enum'));\n      allEnum.listZhiWenProfessionEnum.forEach(function (i) {\n        listData.push({\n          label: i.name,\n          value: i.id\n        });\n      });\n      this.setState({\n        listData: listData\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var columns = [{\n        dataIndex: 'name',\n        key: 'name',\n        width: 300,\n        title: React.createElement(TableTitle, null, \"\\u5C0F\\u73ED\\u8BFE\\u540D\\u79F0\"),\n        render: function render(v) {\n          return React.createElement(CategoryName, {\n            width: '300'\n          }, v);\n        }\n      }, {\n        dataIndex: 'industry',\n        key: 'industry',\n        width: 100,\n        title: React.createElement(TableTitle, null, \"\\u6240\\u5C5E\\u884C\\u4E1A\"),\n        render: function render(v) {\n          return React.createElement(CategoryName, null, v);\n        }\n      }, {\n        dataIndex: 'time',\n        key: 'time',\n        render: function render(v) {\n          return React.createElement(CategoryName, null, v);\n        },\n        title: React.createElement(TableTitle, null, \"\\u4E0A\\u8BFE\\u65F6\\u95F4\")\n      }, {\n        dataIndex: 'appointDeadLine',\n        key: 'appointDeadLine',\n        render: function render(v) {\n          return React.createElement(CategoryName, null, v);\n        },\n        title: React.createElement(TableTitle, null, \"\\u62A5\\u540D\\u622A\\u6B62\\u65F6\\u95F4\")\n      }, {\n        dataIndex: 'studentAccountsLength',\n        key: 'studentAccountsLength',\n        width: 110,\n        render: function render(v) {\n          return React.createElement(CategoryName, {\n            width: '70'\n          }, v);\n        },\n        title: React.createElement(TableTitle, null, \"\\u5DF2\\u62A5\\u540D\\u4EBA\\u6570\")\n      }, {\n        dataIndex: 'range',\n        key: 'range',\n        render: function render(v) {\n          return React.createElement(CategoryName, null, v);\n        },\n        title: React.createElement(TableTitle, null, \"\\u5F00\\u8BFE\\u4EBA\\u8303\\u56F4\")\n      }, {\n        dataIndex: 'operating',\n        key: 'operating',\n        width: 70,\n        render: function render(a, b) {\n          return React.createElement(\"a\", {\n            onClick: _this2.showModal.bind(_this2, a, b),\n            href: \"javascript:;\",\n            style: {\n              textDecorationLine: 'none',\n              fontSize: 14\n            }\n          }, \"\\u63A5\\u53D7\");\n        },\n        title: React.createElement(TableTitle, null, \"\\u64CD\\u4F5C\")\n      }];\n\n      var Empty = function Empty() {\n        return React.createElement(EmptyComponents, null);\n      };\n\n      return React.createElement(TitleSelect, {\n        part: \"part1\",\n        refetchList: this.refetchList\n      }, React.createElement(ListGroupCourseSlotsWithPagination, {\n        variables: this.variables,\n        onCompleted: this.storePageInfo,\n        notifyOnNetworkStatusChange: true,\n        query: listGroupCourseSlotsWithPagination\n      }, function (_ref3) {\n        var loading = _ref3.loading,\n            error = _ref3.error,\n            data = _ref3.data,\n            fetchMore = _ref3.fetchMore,\n            client = _ref3.client,\n            refetch = _ref3.refetch;\n        _this2.fetchMore = fetchMore;\n        _this2.client = client;\n        _this2.refetch = refetch;\n\n        if (loading) {\n          return React.createElement(Loading, null);\n        }\n\n        if (error) {\n          return null;\n        }\n\n        var processedData = _this2.filterData(data);\n\n        return React.createElement(_ConfigProvider, {\n          renderEmpty: Empty\n        }, React.createElement(_Table, {\n          style: {\n            flex: 1\n          },\n          columns: columns,\n          dataSource: processedData,\n          footer: processedData.length ? _this2.footer : null,\n          pagination: false\n        }));\n      }));\n    }\n  }]);\n\n  return ScheduleManagement;\n}(React.Component);\n\nexport default ScheduleManagement;","map":null,"metadata":{},"sourceType":"module"}
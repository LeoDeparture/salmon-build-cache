{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/select/style\";\nimport _Select from \"antd/lib/select\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Object$assign from \"@babel/runtime-corejs2/core-js/object/assign\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"antd/lib/date-picker/style\";\nimport _DatePicker from \"antd/lib/date-picker\";\nimport debounce from 'lodash/debounce';\nimport React from 'react';\nvar MonthPicker = _DatePicker.MonthPicker;\nimport locale from 'antd/lib/date-picker/locale/zh_CN';\nimport moment from 'moment';\nimport styled from 'styled-components';\nimport { renderSelectOptions } from '../../../../lib/commonJs';\nimport { query } from '../../containers/ListSchoolsQuery';\nimport { FormStyle, InputPlaceHolder, noTxtRequireRule, requireRule, SelectPlaceHolder, textAreaAutoSize, textAreaRule } from '../UserResumeComponent'; // 展示成绩填写部分的提示\n\nvar GPAContainer = styled.div.withConfig({\n  displayName: \"EditEducationExperience__GPAContainer\",\n  componentId: \"sc-1bq3wao-0\"\n})([\"position:relative;top:-6px;& .ant-form-explain{position:relative;bottom:-20px;}\"]);\nvar GPABox = styled.div.withConfig({\n  displayName: \"EditEducationExperience__GPABox\",\n  componentId: \"sc-1bq3wao-1\"\n})([\"display:flex;align-items:center;\"]);\nvar GPALabel = styled.div.withConfig({\n  displayName: \"EditEducationExperience__GPALabel\",\n  componentId: \"sc-1bq3wao-2\"\n})([\"width:120px;\"]);\n\nvar ModuleForm =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ModuleForm, _React$Component);\n\n  function ModuleForm() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, ModuleForm);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(ModuleForm)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      fetching: false,\n      schools: []\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"updating\", false);\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSubmit\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(e) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                e.preventDefault();\n\n                if (!_this.updating) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                _this.updating = true;\n\n                _this.props.form.validateFieldsAndScroll(function (err, fieldsValue) {\n                  if (!err) {\n                    var curriculum = fieldsValue.curriculum,\n                        degreeId = fieldsValue.degreeId,\n                        resultGpa = fieldsValue.resultGpa,\n                        resultOther = fieldsValue.resultOther,\n                        resultRanking = fieldsValue.resultRanking,\n                        graduateTime = fieldsValue.graduateTime,\n                        major = fieldsValue.major,\n                        schoolCategoryId = fieldsValue.schoolCategoryId,\n                        school = fieldsValue.school,\n                        startTime = fieldsValue.startTime;\n                    var input = {\n                      curriculum: curriculum,\n                      degreeId: degreeId,\n                      graduateTime: graduateTime.toDate(),\n                      major: major,\n                      resultGpa: resultGpa,\n                      resultOther: resultOther,\n                      resultRanking: resultRanking,\n                      schoolCategoryId: schoolCategoryId,\n                      schoolId: school.key,\n                      startTime: startTime.toDate()\n                    }; // 如果是更新信息, 传信息Id, 如果是创建信息, 传 cvID\n\n                    if (_JSON$stringify(_this.props.data) === '{}') {\n                      _Object$assign(input, {\n                        id: _this.props.cvId\n                      });\n                    } else {\n                      _Object$assign(input, {\n                        id: _this.props.data.id\n                      });\n                    } // 执行 mutation\n\n\n                    _this.props.updateData(_this.props.mutation, input, _this.afterUpdate);\n                  } else {\n                    _this.updating = false;\n                  }\n                });\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"afterUpdate\", function () {\n      _this.props.closeEdit();\n\n      _this.updating = false;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"componentDidMount\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var _this$props$data, curriculum, degree, graduateTime, major, resultGpa, resultOther, resultRanking, school, schoolCategory, startTime, grade, data;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              // 使用 debounce 节流\n              _this.fetchSchool = debounce(_this.fetchSchool, 1000); // 数据回填\n\n              _this$props$data = _this.props.data, curriculum = _this$props$data.curriculum, degree = _this$props$data.degree, graduateTime = _this$props$data.graduateTime, major = _this$props$data.major, resultGpa = _this$props$data.resultGpa, resultOther = _this$props$data.resultOther, resultRanking = _this$props$data.resultRanking, school = _this$props$data.school, schoolCategory = _this$props$data.schoolCategory, startTime = _this$props$data.startTime; // 信息回填时, 若三项之一有数据, 给 grade 赋值避免提示为空\n\n              grade = '';\n\n              if (resultGpa || resultOther || resultRanking) {\n                grade = Math.random().toString();\n              }\n\n              data = {\n                curriculum: curriculum,\n                degreeId: degree && degree.id,\n                grade: grade,\n                graduateTime: graduateTime && moment(graduateTime),\n                major: major,\n                resultGpa: resultGpa,\n                resultOther: resultOther,\n                resultRanking: resultRanking,\n                school: school && {\n                  key: school.id || '',\n                  label: school.name || ''\n                },\n                schoolCategoryId: schoolCategory && schoolCategory.id,\n                startTime: startTime && moment(startTime)\n              };\n\n              if (_JSON$stringify(_this.props.data) !== '{}') {\n                // 执行回填\n                _this.props.form.setFieldsValue(data);\n              }\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSearch\", function (value) {\n      _this.fetchSchool(value);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"fetchSchool\",\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(value) {\n        var keyword, schools;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                keyword = value || '';\n\n                if (!keyword) {\n                  _context3.next = 9;\n                  break;\n                }\n\n                _this.setState({\n                  fetching: true\n                });\n\n                _context3.next = 5;\n                return _this.queryListSchools(keyword);\n\n              case 5:\n                schools = _context3.sent;\n\n                _this.setState({\n                  fetching: false,\n                  schools: schools.data.listSchools\n                });\n\n                _context3.next = 10;\n                break;\n\n              case 9:\n                _this.setState({\n                  schools: []\n                });\n\n              case 10:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"queryListSchools\", function (value) {\n      var variables = {\n        input: {\n          first: 30,\n          where: {\n            OR: [{\n              name_contains: value\n            }, {\n              pinyinFull_contains: value\n            }, {\n              pinyinPrefix_contains: value\n            }]\n          }\n        }\n      };\n      return _this.props.client.query({\n        query: query,\n        variables: variables\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateTime\", function (_rule, _value, callback) {\n      var getFieldValue = _this.props.form.getFieldValue;\n      var endAt = getFieldValue('graduateTime');\n      var startAt = getFieldValue('startTime');\n\n      if (startAt && endAt && moment(endAt).isBefore(moment(startAt))) {\n        callback(\"\\u6BD5\\u4E1A\\u4E0D\\u80FD\\u65E9\\u4E8E\\u5165\\u5B66\\u65E5\\u671F\");\n      }\n\n      callback();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateOtherField\", function (type, _rule, _value, callback) {\n      var validateFieldsAndScroll = _this.props.form.validateFieldsAndScroll;\n      validateFieldsAndScroll([type], {\n        force: true\n      }, function () {\n        return;\n      });\n      callback();\n    });\n\n    return _this;\n  }\n\n  _createClass(ModuleForm, [{\n    key: \"render\",\n    value: function render() {\n      var getFieldDecorator = this.props.form.getFieldDecorator;\n      return React.createElement(_Form, {\n        onSubmit: this.handleSubmit,\n        style: FormStyle,\n        colon: false\n      }, React.createElement(_Row, {\n        gutter: 24\n      }, React.createElement(_Col, {\n        span: 8\n      }, React.createElement(_Form.Item, {\n        label: \"\\u6BD5\\u4E1A\\u5B66\\u6821\"\n      }, getFieldDecorator('school', {\n        rules: noTxtRequireRule\n      })(React.createElement(_Select, {\n        showSearch: true,\n        labelInValue: true,\n        placeholder: InputPlaceHolder,\n        filterOption: false,\n        onSearch: this.handleSearch,\n        style: {\n          width: '100%'\n        },\n        defaultActiveFirstOption: false,\n        notFoundContent: null\n      }, renderSelectOptions(this.state.schools))))), React.createElement(_Col, {\n        span: 8\n      }, React.createElement(_Form.Item, {\n        label: \"\\u5B66\\u6821\\u7C7B\\u578B\"\n      }, getFieldDecorator('schoolCategoryId', {\n        rules: noTxtRequireRule\n      })(React.createElement(_Select, {\n        placeholder: SelectPlaceHolder\n      }, renderSelectOptions(JSON.parse(localStorage.getItem('zhiwen_all_enum')).listSchoolCategoryEnum))))), React.createElement(_Col, {\n        span: 8\n      }, React.createElement(_Form.Item, {\n        label: \"\\u4E13\\u4E1A\"\n      }, getFieldDecorator('major', {\n        rules: requireRule\n      })(React.createElement(_Input, {\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u4E13\\u4E1A\\u5168\\u79F0\"\n      }))))), React.createElement(_Row, {\n        gutter: 24\n      }, React.createElement(_Col, {\n        span: 8\n      }, React.createElement(_Form.Item, {\n        label: \"\\u5B66\\u5386/\\u5B66\\u4F4D\"\n      }, getFieldDecorator('degreeId', {\n        rules: noTxtRequireRule\n      })(React.createElement(_Select, {\n        placeholder: SelectPlaceHolder\n      }, renderSelectOptions(JSON.parse(localStorage.getItem('zhiwen_all_enum')).listDegreeEnum))))), React.createElement(_Col, {\n        span: 8\n      }, React.createElement(_Form.Item, {\n        label: \"\\u5165\\u5B66\\u65F6\\u95F4\"\n      }, getFieldDecorator('startTime', {\n        rules: [].concat(_toConsumableArray(noTxtRequireRule), [{\n          validator: this.validateOtherField.bind(this, 'graduateTime')\n        }])\n      })(React.createElement(MonthPicker, {\n        locale: locale,\n        placeholder: SelectPlaceHolder,\n        style: {\n          width: '100%'\n        }\n      })))), React.createElement(_Col, {\n        span: 8\n      }, React.createElement(_Form.Item, {\n        label: \"\\u6BD5\\u4E1A\\u65F6\\u95F4\"\n      }, getFieldDecorator('graduateTime', {\n        rules: [].concat(_toConsumableArray(noTxtRequireRule), [{\n          validator: this.validateTime\n        }])\n      })(React.createElement(MonthPicker, {\n        locale: locale,\n        placeholder: SelectPlaceHolder,\n        style: {\n          width: '100%'\n        }\n      }))))), React.createElement(_Row, {\n        gutter: 24\n      }, React.createElement(_Col, {\n        span: 24\n      }, React.createElement(_Form.Item, {\n        label: \"\\u76F8\\u5173\\u8BFE\\u7A0B\"\n      }, getFieldDecorator('curriculum', {\n        rules: textAreaRule\n      })(React.createElement(_Input.TextArea, {\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u5728\\u6821\\u671F\\u95F4\\u4E3B\\u4FEE\\u8BFE\\u7A0B\\u540D\\u79F0\",\n        autoSize: textAreaAutoSize\n      }))))), React.createElement(_Row, {\n        gutter: 24\n      }, React.createElement(_Col, {\n        span: 24\n      }, React.createElement(GPAContainer, null, React.createElement(_Form.Item, {\n        label: \"\\u6210\\u7EE9\\uFF08\\u81F3\\u5C11\\u586B\\u5199\\u4E00\\u9879)\"\n      }, getFieldDecorator('grade', {\n        rules: [{\n          message: '至少填写一项',\n          required: true\n        }]\n      })(React.createElement(_Row, {\n        gutter: 24\n      }, React.createElement(_Col, {\n        span: 8\n      }, React.createElement(_Form.Item, {\n        style: {\n          margin: 0\n        }\n      }, React.createElement(GPABox, null, React.createElement(GPALabel, null, \"\\u6210\\u7EE9 - GPA\"), getFieldDecorator('resultGpa')(React.createElement(_Input, {\n        placeholder: \"\\u5982\\uFF0C3.7/4.0\\u621685/100\"\n      }))))), React.createElement(_Col, {\n        span: 8\n      }, React.createElement(_Form.Item, {\n        style: {\n          margin: 0\n        }\n      }, React.createElement(GPABox, null, React.createElement(GPALabel, null, \"\\u6210\\u7EE9 - \\u6392\\u540D\"), getFieldDecorator('resultRanking')(React.createElement(_Input, {\n        placeholder: \"\\u5982\\uFF0C5/68\\u6216top10%\"\n      }))))), React.createElement(_Col, {\n        span: 8\n      }, React.createElement(_Form.Item, {\n        style: {\n          margin: 0\n        }\n      }, React.createElement(GPABox, null, React.createElement(GPALabel, null, \"\\u6210\\u7EE9 - \\u5176\\u4ED6\"), getFieldDecorator('resultOther')(React.createElement(_Input, {\n        placeholder: \"\\u5982\\uFF0CA+/Merit\"\n      }))))))))))), React.createElement(_Form.Item, {\n        labelCol: {\n          span: 12\n        },\n        style: {\n          marginTop: 20\n        }\n      }, React.createElement(_Button, {\n        onClick: this.props.cancel\n      }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n        disabled: this.updating,\n        style: {\n          marginLeft: 20\n        },\n        type: \"primary\",\n        htmlType: \"submit\"\n      }, \"\\u4FDD\\u5B58\")));\n    }\n  }]);\n\n  return ModuleForm;\n}(React.Component);\n\nvar EditEducationExperience = _Form.create()(ModuleForm);\n\nexport default EditEducationExperience;","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/checkbox/style\";\nimport _Checkbox from \"antd/lib/checkbox\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/dropdown/style\";\nimport _Dropdown from \"antd/lib/dropdown\";\nimport \"antd/lib/badge/style\";\nimport _Badge from \"antd/lib/badge\";\nimport \"antd/lib/icon/style\";\nimport _Icon from \"antd/lib/icon\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/menu/style\";\nimport _Menu from \"antd/lib/menu\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport { addMinutes, format } from 'date-fns';\nimport Router from 'next/router';\nimport React from 'react';\nimport styled from 'styled-components';\nimport FilePicker from '../../../components/FilePicker';\nimport LayoutContainer from '../../../components/Layout';\nimport Loading from '../../../components/Loading';\nimport TableFooter from '../../../components/Table/TableFooter';\nimport { FlexCenterColumn, FlexDisplay } from '../../../lib/commonCss';\nimport CourseDetails from '../../courseDetails';\nimport { disableGroupCourse, enableGroupCourse, removeGroupCourse } from '../../groupCourseManagement/containers/Mutations';\nimport { ScheduleType } from '../../groupCourseScheduleDetails/components/TitleComponent';\nimport { addGroupCourseSlotSourceFile } from '../../groupCourseScheduleDetails/containers/MutationChangeGroupCourseSlotTutor';\nimport ListGroupCourseSlotsWithPagination, { listGroupCourseSlotsWithPagination } from '../../groupScheduleManagement/containers/ListGroupCourseSlotsWithPagination';\nimport { updateGroupCourseMutation } from '../containers/MutationUpdateGroupCourse';\nvar getDataNumber = 20;\n\nvar GroupCourseDetailsContainers =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(GroupCourseDetailsContainers, _React$Component);\n\n  function GroupCourseDetailsContainers() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, GroupCourseDetailsContainers);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(GroupCourseDetailsContainers)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"fistLoad\", true);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      id: null,\n      GroupCourseSlotID: null,\n      listLength: 0,\n      loading: false,\n      lazyLoad: false,\n      pageInfo: {\n        loading: false,\n        hasNextPage: false,\n        endCursor: ''\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"variables\", {\n      input: {\n        first: getDataNumber,\n        where: {\n          status: {\n            key_not: 'CANCELED'\n          },\n          groupCourse: {\n            id: null\n          }\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getListItemLength\", function () {\n      var _this$state = _this.state,\n          lazyLoad = _this$state.lazyLoad,\n          id = _this$state.id;\n\n      if (lazyLoad && _this.fistLoad) {\n        _this.client.query({\n          query: listGroupCourseSlotsWithPagination,\n          variables: {\n            input: {\n              where: {\n                groupCourse: {\n                  id: id\n                }\n              }\n            }\n          }\n        }).then(function (result) {\n          if (result) {\n            _this.fistLoad = false;\n            var listLength = result.data.listGroupCourseSlotsWithPagination.edges.length;\n\n            _this.setState({\n              listLength: listLength\n            });\n          }\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onRefSendFilePop\", function (ref) {\n      _this.sendFilePop = ref;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getSelected\", function (files) {\n      var variables = {\n        input: {\n          id: _this.state.GroupCourseSlotID,\n          resourceId: files[0].id\n        }\n      };\n\n      var filterFun = function filterFun(data, result) {\n        var file = result.data.addGroupCourseSlotSourceFile.resourceFile;\n        data.listGroupCourseSlotsWithPagination.edges.map(function (v) {\n          var value = v.node;\n\n          if (value.id === file.id) {\n            value.resourceFile = file.resourceFile.file;\n          }\n        });\n        return data;\n      };\n\n      _this.mutations(addGroupCourseSlotSourceFile, variables, filterFun);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"mutations\", function (mutationName, variables, filterFun) {\n      return _this.client.mutate({\n        mutation: mutationName,\n        update: function update(proxy, result2) {\n          var data = proxy.readQuery({\n            query: listGroupCourseSlotsWithPagination,\n            variables: _this.variables\n          });\n          var data2 = filterFun(data, result2);\n          proxy.writeQuery({\n            data: data2,\n            query: listGroupCourseSlotsWithPagination,\n            variables: _this.variables\n          });\n        },\n        variables: variables\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onHandleClick\", function (id) {\n      _this.setState({\n        GroupCourseSlotID: id\n      });\n\n      _this.sendFilePop.showPop();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderMenuItem\", function (_, b) {\n      return React.createElement(_Menu, null, React.createElement(_Menu.Item, null, React.createElement(MenuBut, {\n        href: \"/group-course-schedule-details?id=\".concat(b.id)\n      }, \"\\u67E5\\u770B\\u8BE6\\u60C5\")), React.createElement(_Menu.Item, null, React.createElement(MenuBut, {\n        onClick: _this.onHandleClick.bind(_assertThisInitialized(_this), b.id)\n      }, \"\\u4E0A\\u4F20\\u56DE\\u653E\\u97F3/\\u89C6\\u9891\")), React.createElement(FilePicker, {\n        selectType: \"single\",\n        mode: \"select\",\n        onRef: _this.onRefSendFilePop,\n        getSelected: _this.getSelected\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"queryMore\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var _this$state2, loading, pageInfo;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$state2 = _this.state, loading = _this$state2.loading, pageInfo = _this$state2.pageInfo;\n\n              if (loading) {\n                _context.next = 6;\n                break;\n              }\n\n              _this.setState({\n                loading: true\n              });\n\n              if (!pageInfo.hasNextPage) {\n                _context.next = 6;\n                break;\n              }\n\n              _context.next = 6;\n              return _this.fetchMore({\n                updateQuery: function updateQuery(prev, _ref2) {\n                  var fetchMoreResult = _ref2.fetchMoreResult;\n\n                  if (!fetchMoreResult) {\n                    return prev;\n                  }\n\n                  var prevData = prev.listGroupCourseSlotsWithPagination.edges;\n                  var fetchResult = fetchMoreResult.listGroupCourseSlotsWithPagination.edges;\n                  fetchMoreResult.listGroupCourseSlotsWithPagination.edges = [].concat(_toConsumableArray(prevData), _toConsumableArray(fetchResult));\n                  return fetchMoreResult;\n                },\n                variables: {\n                  input: _objectSpread({}, _this.variables.input, {\n                    after: pageInfo.endCursor,\n                    first: getDataNumber\n                  })\n                }\n              }).then(function (result) {\n                if (result.data) {\n                  _this.setState({\n                    loading: false\n                  });\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"footer\", function () {\n      return _this.state.pageInfo.hasNextPage && React.createElement(TableFooter, {\n        isLoading: _this.state.loading,\n        onClickLink: _this.queryMore\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderFile\", function (v) {\n      var fileType = v ? {\n        type: 'check-circle',\n        color: '#52c41a'\n      } : {\n        type: 'stop',\n        color: null\n      };\n      return React.createElement(_Icon, {\n        type: fileType.type,\n        style: {\n          color: fileType.color\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderStatus\", function (v, l) {\n      var badgeText = l.cancelReason ? {\n        badge: 'default',\n        text: \"\\u5DF2\\u53D6\\u6D88\\uFF08\".concat(l.cancelReason, \"\\uFF09\")\n      } : ScheduleType[v.key];\n      return React.createElement(WrapBadge, null, React.createElement(_Badge, {\n        status: badgeText.badge\n      }), React.createElement(StatusContent, null, badgeText.text));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"storePageInfo\", function (data) {\n      var pageInfo = data.listGroupCourseSlotsWithPagination.pageInfo;\n\n      _this.setState({\n        pageInfo: {\n          endCursor: pageInfo.endCursor,\n          hasNextPage: pageInfo.hasNextPage\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getLazyLoadValue\", function (value) {\n      _this.setState({\n        lazyLoad: value\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"filterData\", function (data) {\n      var operatorAccounts = [];\n      var dataArr = data.listGroupCourseSlotsWithPagination.edges;\n\n      if (dataArr.length) {\n        dataArr.forEach(function (i) {\n          var appointDeadLine = format(addMinutes(i.node.time, -i.node.appointDeadline), 'YYYY/MM/DD HH:mm');\n          operatorAccounts.push(_objectSpread({}, i.node, {\n            industry: i.node.groupCourse.industry.name,\n            key: i.node.id,\n            name: i.node.groupCourse.name,\n            range: \"\".concat(i.node.min, \" ~ \").concat(i.node.max),\n            studentAccountsLength: i.node.studentAccounts.length,\n            time: format(i.node.time, 'YYYY/MM/DD HH:mm'),\n            appointDeadLine: appointDeadLine\n          }));\n        });\n      }\n\n      return operatorAccounts;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (e) {\n      var value = e.target.checked;\n\n      if (value) {\n        _this.variables.input.where.status.key_not = undefined;\n\n        _this.refetch();\n\n        return;\n      }\n\n      _this.variables.input.where.status.key_not = 'CANCELED';\n\n      _this.refetch();\n    });\n\n    return _this;\n  }\n\n  _createClass(GroupCourseDetailsContainers, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var id = Router.router.query.id;\n      this.variables.input.where.groupCourse.id = id;\n      this.setState({\n        id: id\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state3 = this.state,\n          listLength = _this$state3.listLength,\n          id = _this$state3.id,\n          lazyLoad = _this$state3.lazyLoad;\n      var columns = [{\n        dataIndex: 'time',\n        key: 'time',\n        title: React.createElement(TableTitle, null, \"\\u4E0A\\u8BFE\\u65F6\\u95F4\"),\n        render: function render(v) {\n          return React.createElement(CategoryName, {\n            width: '350'\n          }, v);\n        }\n      }, {\n        dataIndex: 'appointDeadLine',\n        key: 'appointDeadLine',\n        title: React.createElement(TableTitle, null, \"\\u62A5\\u540D\\u622A\\u6B62\\u65F6\\u95F4\"),\n        render: function render(v) {\n          return React.createElement(CategoryName, null, v);\n        }\n      }, {\n        dataIndex: 'studentAccountsLength',\n        key: 'studentAccountsLength',\n        width: 110,\n        title: React.createElement(TableTitle, null, \"\\u5DF2\\u62A5\\u540D\\u4EBA\\u6570\"),\n        render: function render(v) {\n          return React.createElement(CategoryName, {\n            align: \"right\"\n          }, v);\n        }\n      }, {\n        dataIndex: 'range',\n        key: 'range',\n        width: 120,\n        render: function render(v) {\n          return React.createElement(CategoryName, {\n            align: \"right\"\n          }, v);\n        },\n        title: React.createElement(TableTitle, null, \"\\u5F00\\u8BFE\\u4EBA\\u6570\\u8303\\u56F4\")\n      }, {\n        dataIndex: 'status',\n        key: 'status',\n        render: function render(v, l) {\n          return _this2.renderStatus(v, l);\n        },\n        title: React.createElement(TableTitle, null, \"\\u6392\\u671F\\u72B6\\u6001\")\n      }, {\n        dataIndex: 'resourceFile',\n        key: 'resourceFile',\n        render: function render(v) {\n          return _this2.renderFile(v);\n        },\n        title: React.createElement(TableTitle, null, \"\\u56DE\\u653E \\u97F3/\\u89C6\\u9891\")\n      }, {\n        dataIndex: 'operating',\n        key: 'operating',\n        width: 120,\n        render: function render(a, b) {\n          return React.createElement(_Dropdown, {\n            overlay: _this2.renderMenuItem(a, b)\n          }, React.createElement(MenuBut, {\n            href: \"javascript:;\"\n          }, \"\\u9009\\u62E9\\u64CD\\u4F5C\"));\n        },\n        title: React.createElement(TableTitle, null, \"\\u64CD\\u4F5C\")\n      }];\n      return React.createElement(LayoutContainer, {\n        menuName: \"\\u5C0F\\u73ED\\u8BFE\",\n        subMenuName: \"\\u5C0F\\u73ED\\u8BFE\\u7BA1\\u7406\"\n      }, React.createElement(FlexCenterColumn, null, React.createElement(CourseDetails, {\n        isCollapse: true,\n        courseType: 'GROUP_COURSE',\n        getLazyLoadValue: this.getLazyLoadValue,\n        disableMutation: disableGroupCourse,\n        enableMutation: enableGroupCourse,\n        removeMutation: removeGroupCourse,\n        updateMutation: updateGroupCourseMutation\n      }), lazyLoad && React.createElement(WrapTab, null, React.createElement(FlexDisplay, {\n        style: {\n          justifyContent: 'space-between'\n        }\n      }, React.createElement(\"h4\", null, \"\\u6B64\\u5C0F\\u73ED\\u8BFE\\u5185\\u6392\\u671F\\uFF08\".concat(listLength, \"\\uFF09\")), React.createElement(_Button, {\n        type: \"primary\",\n        href: \"/create-schedule?id=\".concat(id)\n      }, \"\\u521B\\u5EFA\\u6392\\u671F\")), React.createElement(FlexDisplay, null, React.createElement(_Checkbox, {\n        onChange: this.onChange\n      }, \"\\u663E\\u793A\\u5DF2\\u53D6\\u6D88\\u72B6\\u6001\\u6392\\u671F\")), React.createElement(ListGroupCourseSlotsWithPagination, {\n        variables: this.variables,\n        onCompleted: this.storePageInfo,\n        query: listGroupCourseSlotsWithPagination\n      }, function (_ref3) {\n        var loading = _ref3.loading,\n            error = _ref3.error,\n            data = _ref3.data,\n            fetchMore = _ref3.fetchMore,\n            client = _ref3.client,\n            refetch = _ref3.refetch;\n        _this2.client = client;\n        _this2.fetchMore = fetchMore;\n        _this2.refetch = refetch;\n\n        if (loading) {\n          return React.createElement(Loading, null);\n        }\n\n        if (error) {\n          return null;\n        }\n\n        _this2.getListItemLength();\n\n        return React.createElement(_Table, {\n          style: {\n            flex: 1,\n            marginTop: '16px'\n          },\n          columns: columns,\n          dataSource: _this2.filterData(data),\n          footer: _this2.footer,\n          pagination: false,\n          locale: {\n            emptyText: '暂无小班课排期任务'\n          }\n        });\n      }))));\n    }\n  }]);\n\n  return GroupCourseDetailsContainers;\n}(React.Component);\n\nexport default GroupCourseDetailsContainers;\nvar TableTitle = styled.span.withConfig({\n  displayName: \"GroupCourseDetailsContainers__TableTitle\",\n  componentId: \"sc-1x9tk8r-0\"\n})([\"font-size:14px;\"]);\nvar CategoryName = styled.span.withConfig({\n  displayName: \"GroupCourseDetailsContainers__CategoryName\",\n  componentId: \"sc-1x9tk8r-1\"\n})([\"display:block;max-width:\", \"px;padding-right:8px;overflow:hidden;font-size:14px;text-align:\", \";text-overflow:ellipsis;white-space:nowrap;\"], function (props) {\n  return props.width;\n}, function (props) {\n  return props.align || 'left';\n});\nvar WrapTab = styled(FlexDisplay).withConfig({\n  displayName: \"GroupCourseDetailsContainers__WrapTab\",\n  componentId: \"sc-1x9tk8r-2\"\n})([\"flex-direction:column;padding:24px;margin:24px;background:#fff;\"]);\nvar MenuBut = styled.a.withConfig({\n  displayName: \"GroupCourseDetailsContainers__MenuBut\",\n  componentId: \"sc-1x9tk8r-3\"\n})([\"text-decoration-line:none;font-size:14px;\"]);\nvar WrapBadge = styled(FlexDisplay).withConfig({\n  displayName: \"GroupCourseDetailsContainers__WrapBadge\",\n  componentId: \"sc-1x9tk8r-4\"\n})([\"align-items:center;\"]);\nvar StatusContent = styled.span.withConfig({\n  displayName: \"GroupCourseDetailsContainers__StatusContent\",\n  componentId: \"sc-1x9tk8r-5\"\n})([\"display:inline-block;width:280px;overflow:hidden;font-size:14px;text-overflow:ellipsis;white-space:nowrap;\"]);","map":null,"metadata":{},"sourceType":"module"}
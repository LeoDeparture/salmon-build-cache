{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from 'react';\nimport Loading from '../../../components/Loading';\nimport TableFooter from '../../../components/Table/TableFooter';\nimport Dashboard from '../components/Dashboard';\nimport TutorManagementComponent from '../components/TutorManagementComponent';\nimport SearchTutors, { searchTutors } from './QuerySearchTutors';\nvar variables = {\n  input: {\n    keyword: null,\n    skip: undefined,\n    after: undefined,\n    before: undefined,\n    first: 20,\n    last: undefined\n  }\n};\n\nvar TutorManagementContainer =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(TutorManagementContainer, _React$Component);\n\n  function TutorManagementContainer() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, TutorManagementContainer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(TutorManagementContainer)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      loading: false,\n      pageInfo: {\n        endCursor: '',\n        hasNextPage: true\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"componentWillUnmount\", function () {\n      variables.input = {\n        keyword: null,\n        skip: undefined,\n        after: undefined,\n        before: undefined,\n        first: 20,\n        last: undefined\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"queryMore\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var _this$state, loading, pageInfo, result;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this$state = _this.state, loading = _this$state.loading, pageInfo = _this$state.pageInfo;\n\n              if (loading) {\n                _context.next = 8;\n                break;\n              }\n\n              _this.setState({\n                loading: true\n              });\n\n              if (!pageInfo.hasNextPage) {\n                _context.next = 8;\n                break;\n              }\n\n              _context.next = 6;\n              return _this.fetchMore({\n                updateQuery: function updateQuery(prev, _ref2) {\n                  var fetchMoreResult = _ref2.fetchMoreResult;\n\n                  if (!fetchMoreResult) {\n                    return prev;\n                  }\n\n                  var prevData = prev.searchTutorsWithPagination.edges;\n                  var fetchResult = fetchMoreResult.searchTutorsWithPagination.edges;\n                  fetchMoreResult.searchTutorsWithPagination.edges = [].concat(_toConsumableArray(prevData), _toConsumableArray(fetchResult));\n                  return fetchMoreResult;\n                },\n                variables: {\n                  input: _objectSpread({}, variables.input, {\n                    after: pageInfo.endCursor\n                  })\n                }\n              });\n\n            case 6:\n              result = _context.sent;\n\n              if (result.loading) {\n                _this.setState({\n                  loading: true\n                });\n              } else {\n                _this.setState({\n                  loading: false\n                });\n              }\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"footer\", function () {\n      if (_this.state.pageInfo.hasNextPage) {\n        return React.createElement(TableFooter, {\n          isLoading: _this.state.loading,\n          onClickLink: _this.queryMore\n        });\n      }\n\n      return null;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"listTutorData\", function (data) {\n      var listTutorDataArr = [];\n      data.map(function (i) {\n        var id = i.id,\n            wechat = i.wechat,\n            email = i.email,\n            name = i.name,\n            phoneNumber = i.phoneNumber,\n            avatar = i.avatar,\n            tutorNo = i.tutorNo;\n        listTutorDataArr.push({\n          id: id,\n          name: name,\n          wechat: wechat,\n          email: email,\n          phoneNumber: phoneNumber,\n          avatar: avatar,\n          key: i.id,\n          tutorNo: tutorNo\n        });\n      });\n      return listTutorDataArr;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"storePageInfo\", function (data) {\n      var pageInfo = data.searchTutorsWithPagination.pageInfo;\n\n      _this.setState({\n        pageInfo: {\n          endCursor: pageInfo.endCursor,\n          hasNextPage: pageInfo.hasNextPage\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onSearch\", function (v) {\n      variables.input.keyword = v;\n\n      _this.refetch(_objectSpread({}, variables));\n    });\n\n    return _this;\n  }\n\n  _createClass(TutorManagementContainer, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(Dashboard, {\n        onSearch: this.onSearch\n      }, React.createElement(SearchTutors, {\n        query: searchTutors,\n        variables: variables,\n        onCompleted: this.storePageInfo,\n        fetchPolicy: \"network-only\",\n        notifyOnNetworkStatusChange: true\n      }, function (_ref3) {\n        var data = _ref3.data,\n            loading = _ref3.loading,\n            error = _ref3.error,\n            fetchMore = _ref3.fetchMore,\n            refetch = _ref3.refetch,\n            networkStatus = _ref3.networkStatus;\n        _this2.fetchMore = fetchMore;\n        _this2.refetch = refetch;\n\n        if (loading || networkStatus === 4 || networkStatus === 2) {\n          return React.createElement(Loading, {\n            type: \"flex\"\n          });\n        }\n\n        if (error) {\n          return null;\n        }\n\n        var nodeData = [];\n\n        if (data && data.searchTutorsWithPagination && data.searchTutorsWithPagination.edges) {\n          nodeData = data.searchTutorsWithPagination.edges.map(function (i) {\n            return i.node;\n          });\n        }\n\n        return React.createElement(TutorManagementComponent, {\n          listTutor: _this2.listTutorData(nodeData),\n          footer: _this2.footer\n        });\n      }));\n    }\n  }]);\n\n  return TutorManagementContainer;\n}(React.Component);\n\nexport default TutorManagementContainer;","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/avatar/style\";\nimport _Avatar from \"antd/lib/avatar\";\nimport \"antd/lib/dropdown/style\";\nimport _Dropdown from \"antd/lib/dropdown\";\nimport \"antd/lib/icon/style\";\nimport _Icon from \"antd/lib/icon\";\nimport \"antd/lib/divider/style\";\nimport _Divider from \"antd/lib/divider\";\nimport \"antd/lib/menu/style\";\nimport _Menu from \"antd/lib/menu\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport copy from 'copy-to-clipboard';\nimport Router from 'next/router';\nimport React from 'react';\nimport styled from 'styled-components';\nimport FilePicker from '../../../components/FilePicker';\nimport WithdrawFilesPop from '../../../components/WithdrawFilesPop';\nimport { DetailCommonP, FlexContentCenter, FlexDisplay } from '../../../lib/commonCss';\nimport CONFIG from '../../../lib/config';\nimport { downloadStudentPdf, sendGroupCourseFilesToStudents } from '../containers/MutationChangeGroupCourseSlotTutor';\nimport { getGroupCourseLearningUrl, getGroupCourseRecordedUrl } from '../containers/QueryGetGroupCourseSlotById';\nimport { ItemWarp, Title } from './TutorDetail';\n\nvar StudentDetail =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(StudentDetail, _React$Component);\n\n  function StudentDetail(props) {\n    var _this;\n\n    _classCallCheck(this, StudentDetail);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(StudentDetail).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"onHandleClick\", function (title) {\n      if (title === 'sendFile') {\n        _this.sendFilePop.showPop();\n      }\n\n      if (title === 'withdraw') {\n        _this.withdrawFilePop.showPop();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onRefSendFilePop\", function (ref) {\n      _this.sendFilePop = ref;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onRefWithdrawFilePop\", function (ref) {\n      _this.withdrawFilePop = ref;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"Description\", function (_ref) {\n      var term = _ref.term,\n          children = _ref.children;\n      return React.createElement(FlexDisplay, null, React.createElement(DetailCommonP, {\n        style: {\n          color: '#9D9D9D'\n        }\n      }, term), React.createElement(CategoryName, null, children));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"filterData\", function (data) {\n      var newArr = [];\n\n      if (Boolean(data.data.length)) {\n        data.data.forEach(function (e) {\n          newArr.push({\n            ID: e.studentNo,\n            id: e.id,\n            key: e.id,\n            avatar: e.account.person.avatar,\n            nickname: e.account.person.nickname === null ? e.account.person.name : e.account.person.nickname\n          });\n        });\n        return newArr;\n      }\n\n      return newArr;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"sendFiles\", function (variable) {\n      var variables = {\n        input: _objectSpread({\n          id: Router.router.query.id\n        }, variable)\n      };\n\n      var func = function func(data) {\n        return data;\n      };\n\n      return _this.props.mutations(sendGroupCourseFilesToStudents, variables, func);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"copyMessagePop\", function (copyResult) {\n      if (copyResult) {\n        _message.destroy();\n\n        _message.success('成功复制链接');\n\n        return;\n      }\n\n      _message.destroy();\n\n      _message.error('复制链接失败，请稍后重试');\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"actionMutation\",\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(b, c) {\n        var result, _result;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this.setState({\n                  loading: true\n                });\n\n                if (_this.state.loading) {\n                  _context.next = 18;\n                  break;\n                }\n\n                _message.destroy();\n\n                _message.loading('正在加载...');\n\n                if (!c) {\n                  _context.next = 12;\n                  break;\n                }\n\n                _context.next = 7;\n                return _this.props.copyUrl(getGroupCourseRecordedUrl, b.id);\n\n              case 7:\n                result = _context.sent;\n\n                if (result && result.data && result.data.getGroupCourseRecordedUrl) {\n                  copy(result.data.getGroupCourseRecordedUrl.url, {\n                    message: '请按 #{key} 复制链接'\n                  });\n\n                  _message.destroy();\n\n                  _message.success('成功复制链接');\n                }\n\n                if (result && result.graphQLErrors && result.graphQLErrors[0]) {\n                  _message.destroy();\n\n                  _message.error(CONFIG.txt.error);\n                }\n\n                _this.setState({\n                  loading: false\n                });\n\n                return _context.abrupt(\"return\");\n\n              case 12:\n                _context.next = 14;\n                return _this.props.copyUrl(getGroupCourseLearningUrl, b.id);\n\n              case 14:\n                _result = _context.sent;\n\n                if (_result && _result.data && _result.data.getGroupCourseLearningUrl) {\n                  copy(_result.data.getGroupCourseLearningUrl.url, {\n                    message: '请按 #{key} 复制链接'\n                  });\n\n                  _message.destroy();\n\n                  _message.success('成功复制链接');\n                }\n\n                if (_result && _result.graphQLErrors && _result.graphQLErrors[0]) {\n                  _message.destroy();\n\n                  _message.error(CONFIG.txt.error);\n                }\n\n                _this.setState({\n                  loading: false\n                });\n\n              case 18:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"onDownload\", function (id, studentId) {\n      _message.destroy();\n\n      _message.loading('加载中...');\n\n      var variables = {\n        input: {\n          id: id,\n          studentId: studentId\n        }\n      };\n\n      var fun = function fun(data, _result) {\n        return data;\n      };\n\n      _this.props.mutations(downloadStudentPdf, variables, fun).then(function (result) {\n        // 返回可能是 null\n        if (result.data.downloadStudentPdf) {\n          _message.destroy();\n\n          window.open(result.data.downloadStudentPdf.attachmentFile.url + '?dl=true');\n          return;\n        }\n\n        _message.destroy();\n\n        _message.error('下载失败');\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderOperator\", function (_, b) {\n      var _this$props$data = _this.props.data,\n          groupCourse = _this$props$data.groupCourse,\n          status = _this$props$data.status,\n          id = _this$props$data.id;\n      var _this$props = _this.props,\n          isOffEndTime = _this$props.isOffEndTime,\n          afterClassDate = _this$props.afterClassDate;\n      var autoForm = groupCourse.autoForm;\n      var studentUrl = isOffEndTime && status.key === 'COMPLETED';\n      var recordUrl = afterClassDate && status.key === 'COMPLETED';\n\n      var menu = function menu() {\n        return React.createElement(_Menu, null, React.createElement(_Menu.Item, null, React.createElement(MenuBut, {\n          href: \"/appointment-form/group/\".concat(id, \"/\").concat(b.id),\n          target: \"_blank\"\n        }, \"\\u67E5\\u770B\")), React.createElement(_Menu.Item, null, React.createElement(MenuBut, {\n          href: \"javascript:;\",\n          onClick: _this.onDownload.bind(_assertThisInitialized(_this), id, b.id)\n        }, \"\\u4E0B\\u8F7D\")));\n      };\n\n      return React.createElement(\"div\", null, recordUrl && React.createElement(MenuBut, {\n        onClick: _this.actionMutation.bind(_assertThisInitialized(_this), b, true),\n        href: \"javascript:;\"\n      }, \"\\u83B7\\u53D6\\u5E76\\u62F7\\u8D1D\\u56DE\\u653E\\u94FE\\u63A5\"), recordUrl && React.createElement(_Divider, {\n        type: \"vertical\"\n      }), studentUrl && React.createElement(MenuBut, {\n        onClick: _this.actionMutation.bind(_assertThisInitialized(_this), b, false),\n        href: \"javascript:;\"\n      }, \"\\u83B7\\u53D6\\u5E76\\u62F7\\u8D1D\\u4E0A\\u8BFE\\u94FE\\u63A5\"), studentUrl && React.createElement(_Divider, {\n        type: \"vertical\"\n      }), React.createElement(_Dropdown, {\n        overlay: menu()\n      }, React.createElement(MenuBut, {\n        href: \"javascript:;\"\n      }, autoForm === null ? '简历' : '简历和预约表单', React.createElement(_Icon, {\n        type: \"down\"\n      }))));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderCenter\", function (data) {\n      var length = data.data.length;\n      var columns = [{\n        dataIndex: 'ID',\n        key: 'ID',\n        width: 200,\n        title: React.createElement(TableTitle, null, \"ID\"),\n        render: function render(v) {\n          return React.createElement(CategoryList, null, v);\n        }\n      }, {\n        dataIndex: 'nickname',\n        key: 'nickname',\n        title: React.createElement(TableTitle, null, \"\\u6635\\u79F0\"),\n        render: function render(v, v1) {\n          return React.createElement(\"div\", null, React.createElement(_Avatar, {\n            size: 28,\n            icon: \"user\",\n            src: v1.avatar\n          }), React.createElement(CategoryList, {\n            style: {\n              marginLeft: 8\n            }\n          }, v));\n        }\n      }, {\n        dataIndex: 'operating',\n        key: 'operating',\n        width: 450,\n        render: _this.renderOperator,\n        title: React.createElement(TableTitle, null, \"\\u64CD\\u4F5C\")\n      }];\n\n      if (!length) {\n        return React.createElement(FlexContentCenter, null, React.createElement(Empty, null, \"\\u6682\\u65E0\\u5B66\\u5458\\u62A5\\u540D\"));\n      }\n\n      return React.createElement(_Table, {\n        style: {\n          flex: 1\n        },\n        columns: columns,\n        dataSource: _this.filterData(data),\n        pagination: false\n      });\n    });\n\n    _this.state = {\n      loading: false\n    };\n    return _this;\n  }\n\n  _createClass(StudentDetail, [{\n    key: \"render\",\n    value: function render() {\n      var student = this.props.data.studentAccounts;\n      return React.createElement(ItemWarp, null, React.createElement(Title, null, React.createElement(\"h4\", null, \"\\u5B66\\u5458\\u4FE1\\u606F\"), React.createElement(\"div\", null, React.createElement(_Button, {\n        disabled: !student.length,\n        onClick: this.onHandleClick.bind(this, 'withdraw')\n      }, \"\\u64A4\\u56DE\\u6587\\u4EF6\"), React.createElement(_Button, {\n        style: {\n          marginLeft: 12\n        },\n        disabled: !student.length,\n        onClick: this.onHandleClick.bind(this, 'sendFile')\n      }, \"\\u53D1\\u9001\\u6587\\u4EF6\"), React.createElement(FilePicker, {\n        selectType: \"multiple\",\n        mode: \"select-and-send\",\n        sendFile: this.sendFiles,\n        onRef: this.onRefSendFilePop,\n        studentData: this.props.data.studentAccounts\n      }), React.createElement(WithdrawFilesPop, {\n        onRef: this.onRefWithdrawFilePop,\n        slotId: this.props.data.id,\n        studentData: this.props.data.studentAccounts\n      }))), React.createElement(this.renderCenter, {\n        data: student\n      }));\n    }\n  }]);\n\n  return StudentDetail;\n}(React.Component);\n\nexport default StudentDetail;\nvar CategoryName = styled.span.withConfig({\n  displayName: \"StudentDetail__CategoryName\",\n  componentId: \"humvwk-0\"\n})([\"display:block;width:100%;overflow:hidden;font-size:14px;text-overflow:ellipsis;white-space:nowrap;\"]);\nvar TableTitle = styled.span.withConfig({\n  displayName: \"StudentDetail__TableTitle\",\n  componentId: \"humvwk-1\"\n})([\"font-size:14px;\"]);\nvar CategoryList = styled.span.withConfig({\n  displayName: \"StudentDetail__CategoryList\",\n  componentId: \"humvwk-2\"\n})([\"overflow:hidden;font-size:14px;text-overflow:ellipsis;word-break:break-all;\"]);\nvar MenuBut = styled.a.withConfig({\n  displayName: \"StudentDetail__MenuBut\",\n  componentId: \"humvwk-3\"\n})([\"text-decoration-line:none;font-size:14px;\"]);\nvar Empty = styled.span.withConfig({\n  displayName: \"StudentDetail__Empty\",\n  componentId: \"humvwk-4\"\n})([\"color:#bfbfbf;\"]);","map":null,"metadata":{},"sourceType":"module"}
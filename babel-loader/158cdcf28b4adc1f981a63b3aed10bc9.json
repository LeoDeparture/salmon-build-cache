{"ast":null,"code":"import \"antd/lib/back-top/style\";\nimport _BackTop from \"antd/lib/back-top\";\nimport \"antd/lib/alert/style\";\nimport _Alert from \"antd/lib/alert\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/tabs/style\";\nimport _Tabs from \"antd/lib/tabs\";\nimport { format } from 'date-fns';\nimport React from 'react';\nimport styled from 'styled-components';\nimport InlineAccountInfo from '../../../../components/InlineAccountInfo';\nimport { PageHeader, PageTabs } from '../../../../components/PageLayout';\nimport { breakLine, parseErrorCode } from '../../../../lib/commonJs';\nimport { InfoBody, LineWrapper } from '../../components/CSSComponents';\nimport Price from '../../components/Price';\nimport AgreementTab from './AgreementTab';\nimport BasicInfoTab from './BasicInfoTab';\nimport CareerAbilityServiceTab from './CareerAbilityServiceTab';\nimport JobServiceTab from './JobServiceTab';\nimport PayInfoTab from './PayInfoTab';\nimport ScheduleList from './ScheduleList';\nimport TextLabel from './TextLabel';\nvar TabPane = _Tabs.TabPane;\nvar confirm = _Modal.confirm;\nvar TextArea = _Input.TextArea;\n\nvar SvgContent = function SvgContent() {\n  return React.createElement(SvgWrapper, null, React.createElement(\"svg\", {\n    width: \"1\",\n    height: \"25\",\n    viewBox: \"0 0 1 25\",\n    fill: \"none\"\n  }, React.createElement(\"line\", {\n    x1: \"0.5\",\n    y1: \"2.18557e-08\",\n    x2: \"0.499999\",\n    y2: \"25\",\n    stroke: \"#E1E1E8\"\n  })));\n};\n\nvar ServiceTicketDetail =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ServiceTicketDetail, _React$Component);\n\n  function ServiceTicketDetail(props) {\n    var _this;\n\n    _classCallCheck(this, ServiceTicketDetail);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ServiceTicketDetail).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"onTabsChange\", function (v) {\n      _this.setState({\n        tabs: v\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showModal\", function () {\n      _this.setState({\n        visible: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOk\", function () {\n      var inputValue = _this.state.inputValue;\n      var _this$props = _this.props,\n          agreeServiceTicketByCode = _this$props.agreeServiceTicketByCode,\n          id = _this$props.id;\n\n      _this.setState({\n        visible: false\n      });\n\n      confirm({\n        title: '确认通过审核并发送服务单吗？',\n        content: '确认后，此服务单将会以短信、邮件和App的方式发送给学员。',\n        onOk: function onOk() {\n          _this.setState({\n            inputValue: null\n          });\n\n          agreeServiceTicketByCode(id, \"\".concat(inputValue)).then(function (result) {\n            if (result && result.data.agreeServiceTicketByCode.reviewStatus.key === 'PASSED') {\n              _message.success('已成功发送服务单');\n            }\n          }, function (err) {\n            _message.error('审核码错误或无效');\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"confirmPassReview\", function () {\n      var agreeServiceTicket = _this.props.agreeServiceTicket;\n      confirm({\n        title: '确认通过审核并发送服务单吗？',\n        content: '确认后，此服务单将会以短信、邮件和App的方式发送给学员。',\n        onOk: function onOk() {\n          agreeServiceTicket().then(function (result) {\n            if (result && result.data.agreeServiceTicket.reviewStatus.key === 'PASSED') {\n              _message.success('已成功发送服务单');\n            }\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"rejectPassReview\", function () {\n      var _this$props2 = _this.props,\n          disagreeServiceTicket = _this$props2.disagreeServiceTicket,\n          id = _this$props2.id;\n      var rejectValue = '';\n\n      function rejectReason(e) {\n        rejectValue = e.target.value.trim();\n        model.update({\n          okButtonProps: {\n            disabled: !rejectValue\n          }\n        });\n      }\n\n      var model = confirm({\n        title: '确认拒绝此服务单吗？',\n        content: React.createElement(React.Fragment, null, React.createElement(\"p\", null, React.createElement(Hint, null, \"*\"), \"\\u62D2\\u7EDD\\u7406\\u7531\"), React.createElement(TextArea, {\n          placeholder: \"\\u8BF7\\u8F93\\u5165\",\n          onChange: rejectReason\n        })),\n        okText: '拒绝',\n        okButtonProps: {\n          disabled: true\n        },\n        onOk: function onOk() {\n          disagreeServiceTicket(id, rejectValue).then(function (result) {\n            if (result && result.data.disagreeServiceTicket.reviewStatus.key === 'FAILED') {\n              _message.success('已拒绝服务单');\n            }\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCancel\", function () {\n      _this.setState({\n        visible: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"changeCheckNum\", function (e) {\n      var value = e.target.value;\n      var checkNumber = value.length < 5 ? value : value.slice(0, 4);\n\n      _this.setState({\n        inputValue: checkNumber\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"reapply\", function () {\n      var generateReviewCode = _this.props.generateReviewCode; // 生成审核码\n\n      _this.setState({\n        reapplyStatus: false\n      });\n\n      generateReviewCode().then(function () {\n        _this.setState({\n          inputValue: null\n        });\n\n        var _loop = function _loop(i) {\n          setTimeout(function () {\n            _this.setState({\n              reapplyTime: 60 - i\n            });\n\n            if (i === 60) {\n              _this.setState({\n                reapplyStatus: true\n              });\n            }\n          }, 1000 * i);\n        };\n\n        for (var i = 1; i <= 60; i++) {\n          _loop(i);\n        }\n      }).catch(function (error) {\n        if (parseErrorCode(error) === 'NoPhoneNumber') {\n          _message.error('此审核人还没有录入手机号，无法使用审核码功能');\n        }\n\n        setTimeout(function () {\n          _this.setState({\n            reapplyStatus: true\n          });\n        }, 3000);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderReviewCodeContent\", function (reviewStatus, reviewCode) {\n      if (reviewStatus !== 'WAITING') {\n        return null;\n      }\n\n      return React.createElement(React.Fragment, null, reviewCode && React.createElement(ReviewCodeWrapper, null, React.createElement(ReviewCodeTitle, null, \"\\u5BA1\\u6838\\u7801\\uFF1A\"), reviewCode), React.createElement(_Button, {\n        type: \"primary\",\n        onClick: _this.confirmPassReview\n      }, \"\\u901A\\u8FC7\\u5BA1\\u6838\"), React.createElement(ButtonWrapper, {\n        onClick: _this.rejectPassReview\n      }, \"\\u62D2\\u7EDD\"));\n    });\n\n    _this.state = {\n      tabs: 'part1',\n      visible: false,\n      inputValue: null,\n      reapplyTime: 0,\n      rejectReasonText: '',\n      serviceTicket: localStorage.getItem('serviceTicket'),\n      reapplyStatus: true\n    };\n    return _this;\n  }\n\n  _createClass(ServiceTicketDetail, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props3 = this.props,\n          serviceTicketDetail = _this$props3.serviceTicketDetail,\n          refetch = _this$props3.refetch,\n          generateServiceTicketContract = _this$props3.generateServiceTicketContract,\n          updateAgreementInServiceTicket = _this$props3.updateAgreementInServiceTicket;\n      var serviceTicketNo = serviceTicketDetail.serviceTicketNo,\n          reviewStatus = serviceTicketDetail.reviewStatus,\n          payStatus = serviceTicketDetail.payStatus,\n          isSigned = serviceTicketDetail.isSigned,\n          isValid = serviceTicketDetail.isValid,\n          creator = serviceTicketDetail.creator,\n          createdAt = serviceTicketDetail.createdAt,\n          reviewer = serviceTicketDetail.reviewer,\n          needCheck = serviceTicketDetail.needCheck,\n          servicePlan = serviceTicketDetail.servicePlan,\n          servicePlanSnapshot = serviceTicketDetail.servicePlanSnapshot,\n          payInfo = serviceTicketDetail.payInfo,\n          reviewCode = serviceTicketDetail.reviewCode,\n          careerBusinessCareerPlanningServiceConfig = serviceTicketDetail.careerBusinessCareerPlanningServiceConfig,\n          jobBusinessJobRecommendationServiceConfig = serviceTicketDetail.jobBusinessJobRecommendationServiceConfig,\n          disagreeReason = serviceTicketDetail.disagreeReason,\n          id = serviceTicketDetail.id;\n      var _this$state = this.state,\n          serviceTicket = _this$state.serviceTicket,\n          tabs = _this$state.tabs,\n          visible = _this$state.visible,\n          inputValue = _this$state.inputValue,\n          reapplyTime = _this$state.reapplyTime,\n          reapplyStatus = _this$state.reapplyStatus;\n      var createTime = format(createdAt, 'YYYY/MM/DD');\n      var serviceCatalogName = servicePlan.serviceCatalog && servicePlan.serviceCatalog.name;\n      return React.createElement(React.Fragment, null, reviewStatus.key === 'WAITING' && React.createElement(AlertWrapper, null, React.createElement(_Alert, {\n        message: \"\\u5982\\u679C\\u5BA1\\u6838\\u4EBA\\u4E0D\\u65B9\\u4FBF\\u767B\\u5F55 MIS \\u7CFB\\u7EDF\\uFF0C\\u4F60\\u53EF\\u4EE5\\u901A\\u8FC7\\u7533\\u8BF7\\u5BA1\\u6838\\u7801\\u8FDB\\u884C\\u7EBF\\u4E0B\\u5BA1\\u6838\\u3002\",\n        type: \"info\",\n        showIcon: true,\n        closable: true\n      })), reviewStatus.key === 'FAILED' && React.createElement(AlertWrapper, null, React.createElement(_Alert, {\n        message: React.createElement(ErrorAlert, null, React.createElement(ErrorItem, null, \"\\u62D2\\u7EDD\\u7406\\u7531\\uFF1A\"), React.createElement(\"span\", null, breakLine(disagreeReason))),\n        type: \"error\",\n        closable: true\n      })), serviceTicket === 'myCreated' ? React.createElement(PageHeader, {\n        titleText: \"\\u670D\\u52A1\\u5355ID\\uFF1A\".concat(serviceTicketNo),\n        buttonText: reviewStatus.key === 'WAITING' ? '通过审核码进行审核' : '',\n        onClickButton: this.showModal\n      }) : React.createElement(PageHeader, {\n        titleText: \"\\u670D\\u52A1\\u5355ID\\uFF1A\".concat(serviceTicketNo),\n        buttonGroup: this.renderReviewCodeContent.bind(this, reviewStatus.key, reviewCode)\n      }), React.createElement(HeaderDetail, null, React.createElement(InfoBodyWrapper, null, React.createElement(InfoBody, null, React.createElement(LineWrapper, null, React.createElement(TextLabel, {\n        title: \"\\u54A8\\u8BE2\\u65B9\\u6848\\uFF1A\",\n        content: servicePlanSnapshot ? servicePlanSnapshot.name : '- -'\n      }), React.createElement(TextLabel, {\n        title: \"\\u65B9\\u6848\\u6240\\u5C5E\\u76EE\\u5F55\\uFF1A\",\n        content: serviceCatalogName\n      })), React.createElement(LineWrapper, null, React.createElement(TextLabel, {\n        title: \"\\u7B7E\\u7EA6\\u884C\\u4E1A\\uFF1A\",\n        content: servicePlan.industry.name\n      }), React.createElement(TextLabel, {\n        title: \"\\u5BA1\\u6838\\u4EBA\\uFF1A\",\n        content: needCheck && reviewer ? React.createElement(InlineAccountInfo, {\n          account: reviewer.account\n        }) : '- -'\n      })), React.createElement(LineWrapper, null, React.createElement(TextLabel, {\n        title: \"\\u521B\\u5EFA\\u4EBA\\uFF1A\",\n        content: creator ? React.createElement(InlineAccountInfo, {\n          account: creator.account\n        }) : '- -'\n      }), React.createElement(TextLabel, {\n        title: \"\\u521B\\u5EFA\\u65E5\\u671F\\uFF1A\",\n        content: createTime\n      })))), React.createElement(\"div\", null, React.createElement(ScheduleListWrapper, null, React.createElement(ScheduleList, {\n        type: reviewStatus.key,\n        scheduleText: reviewStatus.name,\n        scheduleStatus: \"\\u5BA1\\u6838\\u72B6\\u6001\"\n      }), React.createElement(SvgContent, null), React.createElement(ScheduleList, {\n        type: isSigned ? 'success' : 'pending',\n        scheduleText: isSigned ? '已签署' : '待签署',\n        scheduleStatus: \"\\u534F\\u8BAE\\u72B6\\u6001\"\n      }), React.createElement(SvgContent, null), React.createElement(ScheduleList, {\n        type: payStatus.key,\n        scheduleText: payStatus.name,\n        scheduleStatus: \"\\u4ED8\\u6B3E\\u72B6\\u6001\"\n      }), React.createElement(SvgContent, null), React.createElement(ScheduleList, {\n        type: isValid ? 'success' : 'invalid',\n        scheduleText: isValid ? '已生效' : '未生效',\n        scheduleStatus: \"\\u670D\\u52A1\\u5355\\u72B6\\u6001\"\n      })), React.createElement(Price, {\n        money: true,\n        value: payInfo.actualPrice,\n        text: \"\\u5E94\\u4ED8\\u603B\\u4EF7\"\n      }))), React.createElement(PageTabs, {\n        onChange: this.onTabsChange,\n        defaultActiveKey: tabs\n      }, React.createElement(TabPane, {\n        tab: \"\\u57FA\\u672C\\u4FE1\\u606F\",\n        key: \"part1\"\n      }, React.createElement(BasicInfoTab, {\n        basicInfo: serviceTicketDetail\n      })), careerBusinessCareerPlanningServiceConfig && React.createElement(TabPane, {\n        tab: \"\\u804C\\u4E1A\\u80FD\\u529B\\u670D\\u52A1\",\n        key: \"part2\"\n      }, React.createElement(CareerAbilityServiceTab, {\n        careerList: serviceTicketDetail\n      })), jobBusinessJobRecommendationServiceConfig && React.createElement(TabPane, {\n        tab: \"\\u6C42\\u804C\\u670D\\u52A1\",\n        key: \"part3\"\n      }, React.createElement(JobServiceTab, {\n        JobServiceList: serviceTicketDetail\n      })), React.createElement(TabPane, {\n        tab: \"\\u534F\\u8BAE\",\n        key: \"part4\"\n      }, React.createElement(AgreementTab, {\n        agreementList: serviceTicketDetail,\n        refetch: refetch,\n        generateServiceTicketContract: generateServiceTicketContract,\n        updateAgreementInServiceTicket: updateAgreementInServiceTicket,\n        id: id\n      })), React.createElement(TabPane, {\n        tab: \"\\u4ED8\\u6B3E\\u4FE1\\u606F\",\n        key: \"part5\"\n      }, React.createElement(PayInfoTab, {\n        payInfoData: serviceTicketDetail\n      }))), React.createElement(_Modal, {\n        title: \"\\u901A\\u8FC7\\u5BA1\\u6838\\u7801\\u8FDB\\u884C\\u5BA1\\u6838\",\n        visible: visible,\n        onOk: this.handleOk,\n        onCancel: this.handleCancel,\n        footer: [React.createElement(_Button, {\n          key: \"back\",\n          onClick: this.handleCancel\n        }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n          key: \"submit\",\n          disabled: !inputValue,\n          type: \"primary\",\n          onClick: this.handleOk\n        }, \"\\u901A\\u8FC7\\u5BA1\\u6838\")]\n      }, React.createElement(\"div\", null, React.createElement(\"div\", null, React.createElement(Hint, null, \"*\"), React.createElement(\"span\", null, \"\\u5BA1\\u6838\\u7801\")), React.createElement(_Input, {\n        value: inputValue,\n        onChange: this.changeCheckNum,\n        placeholder: \"\\u8BF7\\u8F93\\u5165\",\n        type: \"number\",\n        autoFocus: true\n      }), React.createElement(ReapplyWrapper, null, React.createElement(\"span\", null, \"\\u5BA1\\u6838\\u4EBA\\u6CA1\\u6536\\u5230\\uFF1F\"), reapplyTime === 0 ? reapplyStatus ? React.createElement(Reapply, {\n        onClick: this.reapply\n      }, \"\\u91CD\\u65B0\\u7533\\u8BF7\") : React.createElement(\"span\", null, \"\\u91CD\\u65B0\\u7533\\u8BF7\") : React.createElement(\"span\", null, reapplyTime, \"\\u79D2\\u540E\\u91CD\\u65B0\\u7533\\u8BF7\")))), React.createElement(_BackTop, null));\n    }\n  }]);\n\n  return ServiceTicketDetail;\n}(React.Component);\n\nexport { ServiceTicketDetail as default };\nvar InfoBodyWrapper = styled.div.withConfig({\n  displayName: \"ServiceTicketDetail__InfoBodyWrapper\",\n  componentId: \"nm38qb-0\"\n})([\"display:inline-block;width:560px;\"]);\nvar HeaderDetail = styled.div.withConfig({\n  displayName: \"ServiceTicketDetail__HeaderDetail\",\n  componentId: \"nm38qb-1\"\n})([\"display:flex;align-items:center;justify-content:space-between;padding:0 32px;background-color:#fff;\"]);\nvar AlertWrapper = styled.div.withConfig({\n  displayName: \"ServiceTicketDetail__AlertWrapper\",\n  componentId: \"nm38qb-2\"\n})([\"padding:16px 32px 0;background:#fff;\"]);\nvar ScheduleListWrapper = styled.div.withConfig({\n  displayName: \"ServiceTicketDetail__ScheduleListWrapper\",\n  componentId: \"nm38qb-3\"\n})([\"display:flex;background:#fff;\"]);\nvar SvgWrapper = styled.div.withConfig({\n  displayName: \"ServiceTicketDetail__SvgWrapper\",\n  componentId: \"nm38qb-4\"\n})([\"padding:13px 0;\"]);\nvar Hint = styled.span.withConfig({\n  displayName: \"ServiceTicketDetail__Hint\",\n  componentId: \"nm38qb-5\"\n})([\"padding-right:3px;color:#ff5230;\"]);\nvar ReapplyWrapper = styled.div.withConfig({\n  displayName: \"ServiceTicketDetail__ReapplyWrapper\",\n  componentId: \"nm38qb-6\"\n})([\"display:flex;justify-content:flex-end;padding:10px 0;font-size:12px;color:#a2aab8;\"]);\nvar Reapply = styled.span.withConfig({\n  displayName: \"ServiceTicketDetail__Reapply\",\n  componentId: \"nm38qb-7\"\n})([\"padding-left:6px;color:#5674bf;cursor:pointer;\"]);\nvar ReviewCodeWrapper = styled.span.withConfig({\n  displayName: \"ServiceTicketDetail__ReviewCodeWrapper\",\n  componentId: \"nm38qb-8\"\n})([\"padding-right:16px;color:#172b4d;\"]);\nvar ReviewCodeTitle = styled.span.withConfig({\n  displayName: \"ServiceTicketDetail__ReviewCodeTitle\",\n  componentId: \"nm38qb-9\"\n})([\"color:#a2aab8;\"]);\nvar ButtonWrapper = styled(_Button).withConfig({\n  displayName: \"ServiceTicketDetail__ButtonWrapper\",\n  componentId: \"nm38qb-10\"\n})([\"margin-left:10px;color:#ff5230;\"]);\nvar ErrorAlert = styled.div.withConfig({\n  displayName: \"ServiceTicketDetail__ErrorAlert\",\n  componentId: \"nm38qb-11\"\n})([\"display:flex;font-size:14px;line-height:22px;p{margin-bottom:0;}\"]);\nvar ErrorItem = styled.span.withConfig({\n  displayName: \"ServiceTicketDetail__ErrorItem\",\n  componentId: \"nm38qb-12\"\n})([\"white-space:nowrap;\"]);","map":null,"metadata":{},"sourceType":"module"}
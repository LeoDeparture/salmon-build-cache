{"ast":null,"code":"import \"antd/lib/checkbox/style\";\nimport _Checkbox from \"antd/lib/checkbox\";\nimport \"antd/lib/spin/style\";\nimport _Spin from \"antd/lib/spin\";\nimport _Object$keys2 from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport \"antd/lib/icon/style\";\nimport _Icon from \"antd/lib/icon\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport groupBy from 'lodash/groupBy';\nimport Head from 'next/head';\nimport React from 'react';\nimport styled from 'styled-components';\nimport { format } from 'date-fns';\nimport ModalTitle from '../../../../components/ModalTitle';\nimport { parseErrorCode } from '../../../../lib/commonJs';\n\nvar GeneratePathwayModal =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(GeneratePathwayModal, _React$Component);\n\n  function GeneratePathwayModal(props) {\n    var _this;\n\n    _classCallCheck(this, GeneratePathwayModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(GeneratePathwayModal).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"showPop\", function () {\n      _this.setState({\n        visible: true,\n        generateChecked: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"hidePop\", function () {\n      _this.setState({\n        visible: false,\n        generateChecked: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onCheckGenerate\", function (e) {\n      _this.setState({\n        generateChecked: e.target.checked\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showGenerateSuccessAlert\", function () {\n      _Modal.success({\n        icon: React.createElement(_Icon, {\n          type: \"check-circle\",\n          theme: \"filled\"\n        }),\n        title: '已成功生成计划',\n        content: React.createElement(\"p\", null, \"\\u5B66\\u4E60\\u8BA1\\u5212\\u5DF2\\u751F\\u6210\\u3002 \\u5B66\\u5458\\u53EF\\u5728\\u804C\\u95EE app \\u7AEF\\u7684\\u5B66\\u4E60\\u8BA1\\u5212\\u6A21\\u5757\\u67E5\\u770B\\u672C\\u6B21\\u4FEE\\u6539\\u3002\"),\n        okText: '我知道了',\n        onOk: _this.props.refetch\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOk\", function () {\n      var _this$props = _this.props,\n          creditExceeded = _this$props.creditExceeded,\n          subscriptionExceed = _this$props.subscriptionExceed; // 如果订阅课程未超额而另外两项超额\n\n      if (creditExceeded || subscriptionExceed) {\n        var _this$props2 = _this.props,\n            creditAmount = _this$props2.creditAmount,\n            plannedAmount = _this$props2.plannedAmount;\n\n        _this.hidePop();\n\n        _Modal.confirm({\n          icon: React.createElement(_Icon, {\n            type: \"exclamation-circle\",\n            theme: \"filled\"\n          }),\n          title: '超额规划提醒',\n          content: React.createElement(React.Fragment, null, React.createElement(\"p\", null, \"\\u8BE5\\u5B66\\u5458\\u6CA1\\u6709\\u8DB3\\u591F\\u7684\\u989D\\u5EA6\\u6570\\u91CF\\u6765\\u5B8C\\u6210\\u8BE5\\u5B66\\u4E60\\u8BA1\\u5212\\u3002\\u8BF7\\u95EE\\u662F\\u5426\\u7EE7\\u7EED\\u3002\"), React.createElement(\"p\", null, \"\\u8BA2\\u9605\\u8BFE\\u7A0B\\uFF1A\\u5DF2\\u8D2D\".concat(creditAmount[2], \"\\uFF0C\\u5DF2\\u89C4\\u5212\").concat(plannedAmount[2])), React.createElement(\"p\", null, \"1\\u5BF91\\u8F85\\u5BFC\\uFF1A\\u5DF2\\u8D2D\".concat(creditAmount[0], \"\\uFF0C\\u5DF2\\u89C4\\u5212\").concat(plannedAmount[0])), React.createElement(\"p\", null, \"\\u5C0F\\u73ED\\u8BFE\\u8F85\\u5BFC\\uFF1A\\u5DF2\\u8D2D\".concat(creditAmount[1], \"\\uFF0C\\u5DF2\\u89C4\\u5212\").concat(plannedAmount[1]))),\n          okText: '继续生成',\n          cancelText: '取消',\n          autoFocusButton: null,\n          onOk: _this.generateAction\n        });\n\n        return;\n      }\n\n      _this.generateAction();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showSubCourseFail\", function (fails) {\n      // 把 sessionItem 以 session 分组\n      var groupedFails = groupBy(fails, 'session.id');\n      var content = [];\n      var index = 0;\n\n      var _loop = function _loop() {\n        var key = _Object$keys[_i];\n\n        if (key) {\n          index++;\n          var startAt;\n          var endAt; // 获取 session 的起止时间\n\n          fails.forEach(function (v) {\n            if (key === v.session.id) {\n              startAt = v.session.startAt;\n              endAt = v.session.endAt;\n            }\n          }); // 周期时间\n\n          var durationText = '--';\n\n          if (startAt && endAt) {\n            var timeFormat = 'YYYY.MM.DD';\n            durationText = \"#\".concat(index, \"\\uFF1A\").concat(format(startAt, timeFormat), \"-\").concat(format(endAt, timeFormat));\n          }\n\n          content.push(durationText); // 订阅课名\n\n          var names = groupedFails[key].map(function (v) {\n            return v.subscriptionCourse.name;\n          });\n          content = content.concat(names); // 增加一个空行\n\n          content.push(' ');\n        }\n      };\n\n      for (var _i = 0, _Object$keys = _Object$keys2(groupedFails); _i < _Object$keys.length; _i++) {\n        _loop();\n      }\n\n      var ContentWrapper = styled.div.withConfig({\n        displayName: \"GeneratePathwayModal__ContentWrapper\",\n        componentId: \"sc-1nh0yse-0\"\n      })([\"max-height:213px;overflow-y:scroll;\"]);\n\n      _Modal.warning({\n        icon: React.createElement(_Icon, {\n          type: \"exclamation-circle\",\n          theme: \"filled\"\n        }),\n        title: '无法生成此学习计划',\n        content: React.createElement(React.Fragment, null, React.createElement(\"p\", null, \"\\u4EE5\\u4E0B\\u8BFE\\u7A0B\\u672A\\u6210\\u529F\\u8BA2\\u9605\\uFF0C\\u8BF7\\u91CD\\u65B0\\u7F16\\u8F91\\u5B66\\u4E60\\u8BA1\\u5212\\u3002\"), React.createElement(ContentWrapper, null, content.map(function (v, i) {\n          return React.createElement(\"p\", {\n            style: {\n              margin: 0\n            },\n            key: i\n          }, v);\n        }))),\n        okText: '我知道了',\n        autoFocusButton: null\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"generateAction\", function () {\n      _this.setState({\n        loading: true\n      });\n\n      _this.props.generatePathway().then(function (result) {\n        var _result$data$generate = result.data.generatePathway,\n            published = _result$data$generate.published,\n            failed = _result$data$generate.failed;\n\n        _this.setState({\n          loading: false,\n          visible: false\n        });\n\n        if (published) {\n          _this.showGenerateSuccessAlert();\n        } else {\n          _this.showSubCourseFail(failed);\n        }\n      }).catch(function (error) {\n        var errorCode = parseErrorCode(error);\n\n        _this.hidePop();\n\n        _this.setState({\n          loading: false\n        }); // 未履约状态\n\n\n        if (errorCode === 'ReservationNotCompleted') {\n          _this.showAlert('该学习计划对应的预约任务必须为已履约才能生成学习计划。');\n        } // 包含阶段数为0\n\n\n        if (errorCode === 'NoSession') {\n          _this.showAlert('学习计划所包含的阶段数量为0个，无法生成。');\n        } // 没有全部配置学习时间\n\n\n        if (errorCode === 'SomeSessionsNotArranged') {\n          _this.showAlert('还有阶段没有配置学习时间，无法生成。');\n        } // 订阅课额度不够\n\n\n        if (errorCode === 'NotEnoughCredits') {\n          _this.showAlert('该学员没有足够的额度来订阅本次规划的\"订阅课程\",请修改学习计划。');\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"showAlert\", function (text) {\n      _Modal.warning({\n        icon: React.createElement(_Icon, {\n          type: \"exclamation-circle\",\n          theme: \"filled\"\n        }),\n        title: '无法生成此学习计划',\n        content: React.createElement(\"p\", null, text),\n        okText: '我知道了',\n        autoFocusButton: null\n      });\n    });\n\n    _this.state = {\n      visible: false,\n      generateChecked: false,\n      loading: false\n    };\n    return _this;\n  }\n\n  _createClass(GeneratePathwayModal, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.onRef(this);\n    } // 显示弹窗\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          visible = _this$state.visible,\n          generateChecked = _this$state.generateChecked,\n          loading = _this$state.loading;\n      var title = React.createElement(ModalTitle, {\n        iconColor: \"orange\",\n        iconType: \"question-circle\",\n        txt: \"\\u786E\\u8BA4\\u751F\\u6210\\u5E76\\u53D1\\u5E03\\u8BE5\\u8BA1\\u5212\\u5417\\uFF1F\"\n      });\n      return React.createElement(React.Fragment, null, React.createElement(Head, null, React.createElement(\"link\", {\n        rel: \"stylesheet\",\n        href: \"/static/css/custom.css\"\n      })), loading ? React.createElement(_Modal, {\n        title: null,\n        visible: true,\n        closable: false,\n        maskClosable: false,\n        footer: null\n      }, React.createElement(Wrapper, null, React.createElement(_Spin, null), React.createElement(\"p\", {\n        style: {\n          margin: '10px 0 0 0',\n          textAlign: 'center'\n        }\n      }, \"\\u6B63\\u5728\\u8BA2\\u9605\\u8BFE\\u7A0B\"))) : React.createElement(_Modal, {\n        title: title,\n        visible: visible,\n        closable: false,\n        maskClosable: false,\n        okButtonProps: {\n          disabled: !generateChecked\n        },\n        onOk: this.handleOk,\n        onCancel: this.hidePop,\n        okText: \"\\u5F00\\u59CB\\u751F\\u6210\",\n        cancelText: \"\\u53D6\\u6D88\"\n      }, React.createElement(\"p\", null, \"1\\u3001\\u7CFB\\u7EDF\\u5C06\\u81EA\\u52A8\\u8BA2\\u9605\\u4F60\\u672C\\u6B21\\u4E3A\\u5B66\\u5458\\u65B0\\u89C4\\u5212\\u7684\\u201C\\u8BA2\\u9605\\u8BFE\\u7A0B\\u201D\\u3002\"), React.createElement(\"p\", null, \"2\\u3001\\u6210\\u529F\\u751F\\u6210\\u540E\\u6211\\u4EEC\\u4F1A\\u5C06\\u5B66\\u4E60\\u8BA1\\u5212\\u53D1\\u5E03\\u5230\\u5B66\\u5458app\\uFF0C\\u5E76\\u901A\\u77E5\\u5B66\\u5458\\u8BA1\\u5212\\u5DF2\\u751F\\u6210\\u3002\"), React.createElement(\"p\", null, \"\\u26A0\\uFE0F \\u6CE8\\u610F\\uFF1A\\u201C\\u8BA2\\u9605\\u8BFE\\u7A0B\\u201D\\u4E00\\u65E6\\u6210\\u529F\\u8BA2\\u9605\\u5219\\u65E0\\u6CD5\\u88AB\\u64A4\\u9500\\uFF0C\\u53CA\\u65E0\\u6CD5\\u8FD4\\u5B66\\u5458\\u76F8\\u5E94\\u7684\\u989D\\u5EA6\\u3002\\u8BF7\\u8C28\\u614E\\u64CD\\u4F5C\\u3002\"), React.createElement(_Checkbox, {\n        checked: generateChecked,\n        onChange: this.onCheckGenerate\n      }, \"\\u6211\\u786E\\u8BA4\\u5DF2\\u6309\\u7167\\u5B66\\u5458\\u5B9E\\u9645\\u9700\\u6C42\\u5B8C\\u6210\\u89C4\\u5212\")));\n    }\n  }]);\n\n  return GeneratePathwayModal;\n}(React.Component);\n\nexport default GeneratePathwayModal;\nvar Wrapper = styled.div.withConfig({\n  displayName: \"GeneratePathwayModal__Wrapper\",\n  componentId: \"sc-1nh0yse-1\"\n})([\"display:flex;flex-direction:column;justify-content:center;height:140px;\"]);","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import \"antd/lib/checkbox/style\";\nimport _Checkbox from \"antd/lib/checkbox\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport omit from 'lodash/omit';\nimport React, { Component } from 'react';\nimport { ApolloConsumer } from 'react-apollo';\nimport styled from 'styled-components';\nimport ModalTitle from '../../../../components/ModalTitle';\nimport { PageContent } from '../../../../components/PageLayout';\nimport StepIndicator from '../../../../components/StepIndicator';\nimport { parseErrorCode } from '../../../../lib/commonJs';\nimport CONFIG from '../../../../lib/config';\nimport BasicInfo from '../components/BasicInfo';\nimport CreationComplete from '../components/CreationComplete';\nimport JobBusinessJobRecommendationService from '../components/JobBusinessJobRecommendationService';\nimport PayInfo from '../components/PayInfo';\nimport VocationalService from '../components/VocationalService';\nimport ConfigureInfoContainer from '../containers/ConfigureInfoContainer';\nimport { MutationCreateServiceTicket } from './MutationCreateServiceTicket';\nimport { queryServiceTicketNeedCheck } from './QueryServiceTicketNeedCheck';\n\nvar StepContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(StepContainer, _Component);\n\n  function StepContainer(props) {\n    var _this;\n\n    _classCallCheck(this, StepContainer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(StepContainer).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"goLastStep\", function () {\n      if (_this.state.step === 0) {\n        return;\n      }\n\n      _this.setState({\n        step: _this.state.step - 1\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"goNextStep\", function () {\n      if (_this.props.stepArray[_this.state.step] === '完成创建') {\n        return;\n      }\n\n      _this.setState({\n        step: _this.state.step + 1\n      }, function () {\n        if (_this.props.stepArray[_this.state.step] === '完成创建') {\n          _this.props.hideButton();\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"changeCreateData\", function (data, callback) {\n      _this.setState(_objectSpread({}, _this.state, data), callback);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"createTicket\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      var data;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              data = omit(_this.state, ['step', 'createServiceTicketId', 'codeModal', 'needCheck', 'reviewer', 'reviewCode', 'confirmLoading', 'title', 'content', 'confirmModalVisible']);\n\n              if (_this.client) {\n                _this.client.query({\n                  query: queryServiceTicketNeedCheck,\n                  variables: {\n                    input: _objectSpread({}, data)\n                  }\n                }).then(\n                /*#__PURE__*/\n                function () {\n                  var _ref2 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee(value) {\n                    return _regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            if (value.data.queryServiceTicketNeedCheck === false) {\n                              _this.setState({\n                                confirmModalVisible: true\n                              });\n                            } else {\n                              _this.setState({\n                                codeModal: true\n                              });\n                            }\n\n                          case 1:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee);\n                  }));\n\n                  return function (_x) {\n                    return _ref2.apply(this, arguments);\n                  };\n                }());\n              }\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"isNeedCode\", function (e) {\n      _this.setState({\n        needCode: e.target.checked\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"hideModal\", function () {\n      _this.setState({\n        codeModal: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"create\", function () {\n      _this.setState({\n        confirmLoading: true\n      });\n\n      var data = omit(_this.state, ['step', 'createServiceTicketId', 'codeModal', 'needCheck', 'reviewer', 'reviewCode', 'confirmLoading', 'title', 'content', 'confirmModalVisible']);\n      return _this.client.mutate({\n        mutation: MutationCreateServiceTicket,\n        variables: {\n          input: _objectSpread({}, data)\n        }\n      }).then(function (result) {\n        var _result$data$createSe = result.data.createServiceTicket,\n            id = _result$data$createSe.id,\n            reviewer = _result$data$createSe.reviewer,\n            needCheck = _result$data$createSe.needCheck,\n            reviewCode = _result$data$createSe.reviewCode;\n\n        if (!needCheck) {\n          _this.setState({\n            title: '已成功创建服务单并发送给学员',\n            content: '请让学员及时打开App确认此服务单'\n          });\n        } else if (!!reviewCode) {\n          _this.setState({\n            title: '已成功创建服务单并提交审核',\n            content: \"\\u540C\\u65F6\\u5BA1\\u6838\\u7801\\u5DF2\\u53D1\\u9001\\u81F3 \".concat(reviewer && reviewer.account && reviewer.account.person && reviewer.account.person.name, \"\\uFF0C\\u8BF7\\u4F60\\u8054\\u7CFB\\u5BA1\\u6838\\u4EBA\\u5E76\\u63CF\\u8FF0\\u672C\\u6B21\\u53D8\\u66F4\\u5185\\u5BB9\\uFF0C\\u5F85\\u5BA1\\u6838\\u4EBA\\u540C\\u610F\\u540E\\uFF0C\\u4F60\\u53EF\\u4EE5\\u5728\\u670D\\u52A1\\u5355\\u8BE6\\u60C5\\u9875\\u4E2D\\u586B\\u5165\\u5BA1\\u6838\\u7801\\uFF0C\\u81EA\\u4E3B\\u5B8C\\u6210\\u5BA1\\u6838\\u3002\")\n          });\n        } else {\n          _this.setState({\n            title: '已成功创建服务单并提交审核'\n          });\n        }\n\n        _this.setState({\n          codeModal: false,\n          needCheck: needCheck,\n          reviewer: reviewer && reviewer.account && reviewer.account.person && reviewer.account.person.name,\n          reviewCode: reviewCode,\n          createServiceTicketId: id\n        }, function () {\n          _this.goNextStep();\n        });\n      }).catch(function (error) {\n        if (parseErrorCode(error) === 'NoAuthorization') {\n          _message.error(CONFIG.txt.noAuth);\n        } else if (parseErrorCode(error) === 'NoPhoneNumber') {\n          _message.error('此审核人还没有录入手机号，无法使用审核码功能');\n        } else {\n          _message.error('创建失败');\n        }\n      }).finally(function () {\n        _this.setState({\n          confirmLoading: false,\n          confirmModalVisible: false\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"hideConfirmModal\", function () {\n      _this.setState({\n        confirmModalVisible: false\n      });\n    });\n\n    _this.state = {\n      step: 0,\n      servicePlanSnapshotId: '',\n      // 服务单快照 ID\n      servicePlanId: '',\n      // 服务单 ID\n      studentAccountId: '',\n      // 学员 ID\n      studentName: '',\n      // 学员名称\n      identificationTypeId: '',\n      // 证件类型 ID\n      identificationNo: '',\n      // 证件号\n      attachments: [],\n      // 附件\n      payInfo: {\n        basePrice: 0,\n        // 基础价格, 单位为分\n        payWay: 'FULL',\n        // FULL: 一次性全款, PREPAY: 预付款\n        prepayPrice: 0,\n        // 预付款金额\n        maxDelayDays: 0 // 几天内付清尾款\n\n      },\n      // 付款信息\n      needCode: false,\n      // 是否申请审核码\n      createServiceTicketId: '',\n      codeModal: false,\n      confirmModalVisible: false,\n      needCheck: false,\n      reviewer: undefined,\n      reviewCode: undefined,\n      confirmLoading: false,\n      title: '',\n      content: ''\n    };\n    return _this;\n  }\n\n  _createClass(StepContainer, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var stepArray = this.props.stepArray;\n      var _this$state = this.state,\n          step = _this$state.step,\n          confirmLoading = _this$state.confirmLoading,\n          confirmModalVisible = _this$state.confirmModalVisible;\n      var title = React.createElement(ModalTitle, {\n        iconColor: \"#faad14\",\n        iconType: \"exclamation-circle\",\n        txt: \"\\u5BA1\\u6838\\u63D0\\u793A\"\n      });\n      return React.createElement(ApolloConsumer, null, function (client) {\n        _this2.client = client;\n        return React.createElement(PageContent, null, React.createElement(Content, null, React.createElement(StepIndicator, {\n          step: step,\n          stepArray: stepArray\n        }), React.createElement(ConfigureInfoContainer, {\n          show: stepArray[step] === '配置学员信息',\n          goLastStep: _this2.goLastStep,\n          goNextStep: _this2.goNextStep,\n          changeCreateData: _this2.changeCreateData\n        }), React.createElement(BasicInfo, {\n          show: stepArray[step] === '基本信息',\n          goNextStep: _this2.goNextStep,\n          goLastStep: _this2.goLastStep,\n          data: JSON.parse(localStorage.getItem('servicePlanSnapshot')),\n          changeCreateData: _this2.changeCreateData\n        }), React.createElement(VocationalService, {\n          show: stepArray[step] === '职业能力服务',\n          goNextStep: _this2.goNextStep,\n          goLastStep: _this2.goLastStep,\n          data: JSON.parse(localStorage.getItem('servicePlanSnapshot')),\n          changeCreateData: _this2.changeCreateData\n        }), React.createElement(JobBusinessJobRecommendationService, {\n          show: stepArray[step] === '求职服务',\n          goNextStep: _this2.goNextStep,\n          goLastStep: _this2.goLastStep,\n          data: JSON.parse(localStorage.getItem('servicePlanSnapshot')),\n          changeCreateData: _this2.changeCreateData\n        }), React.createElement(PayInfo, {\n          show: stepArray[step] === '付款信息',\n          goNextStep: _this2.goNextStep,\n          goLastStep: _this2.goLastStep,\n          data: JSON.parse(localStorage.getItem('servicePlanSnapshot')),\n          changeCreateData: _this2.changeCreateData,\n          createTicket: _this2.createTicket\n        }), React.createElement(CreationComplete, {\n          show: stepArray[step] === '完成创建',\n          createServiceTicketId: _this2.state.createServiceTicketId,\n          title: _this2.state.title,\n          content: _this2.state.content\n        })), React.createElement(_Modal, {\n          title: title,\n          visible: _this2.state.codeModal,\n          closable: false,\n          maskClosable: false,\n          onOk: _this2.create,\n          confirmLoading: _this2.state.confirmLoading,\n          onCancel: _this2.hideModal,\n          destroyOnClose: true\n        }, React.createElement(TipText, null, \"\\u2022 \\u7531\\u4E8E\\u4F60\\u66F4\\u6539\\u4E86\\u54A8\\u8BE2\\u65B9\\u6848\\u7684\\u9ED8\\u8BA4\\u9879\\uFF0C\\u9700\\u8981\\u5BA1\\u6838\\u4EBA\\u767B\\u5F55MIS\\u7CFB\\u7EDF\\u5B8C\\u6210\\u6B64\\u670D\\u52A1\\u5355\\u7684\\u5BA1\\u6838\\u3002\"), React.createElement(TipText, null, \"\\u6216\"), React.createElement(TipText, null, \"\\u2022 \\u5982\\u679C\\u5BA1\\u6838\\u4EBA\\u4E0D\\u65B9\\u4FBF\\u767B\\u5F55 MIS \\u7CFB\\u7EDF\\uFF0C\\u4F60\\u53EF\\u4EE5\\u52FE\\u9009\\u201C\\u7533\\u8BF7\\u5BA1\\u6838\\u7801\\u201D\\uFF0C\\u7533\\u8BF7\\u5BA1\\u6838\\u540E\\uFF0C\\u6211\\u4EEC\\u4F1A\\u5C06\\u5BA1\\u6838\\u7801\\u53D1\\u9001\\u53D1\\u9001\\u5230\\u5BA1\\u6838\\u4EBA\\u624B\\u673A\\u4E0A\\u3002\\u8BF7\\u4F60\\u8054\\u7CFB\\u5BF9\\u65B9\\u5E76\\u63CF\\u8FF0\\u672C\\u6B21\\u53D8\\u66F4\\u5185\\u5BB9\\uFF0C\\u5F85\\u5BA1\\u6838\\u4EBA\\u540C\\u610F\\u540E\\uFF0C\\u4F60\\u53EF\\u4EE5\\u5728\\u670D\\u52A1\\u5355\\u8BE6\\u60C5\\u5217\\u4E2D\\u586B\\u5165\\u5BA1\\u6838\\u7801\\uFF0C\\u81EA\\u4E3B\\u5B8C\\u6210\\u5BA1\\u6838\\u3002\"), React.createElement(TipCheck, {\n          onChange: _this2.isNeedCode\n        }, \"\\u7533\\u8BF7\\u5BA1\\u6838\\u7801\")), React.createElement(_Modal, {\n          title: React.createElement(ModalTitle, {\n            iconColor: \"#FF991F\",\n            iconType: \"question-circle\",\n            txt: \"\\u786E\\u8BA4\\u521B\\u5EFA\\u5E76\\u53D1\\u9001\\u670D\\u52A1\\u5355\\u5417\\uFF1F\"\n          }),\n          visible: confirmModalVisible,\n          closable: false,\n          maskClosable: false,\n          onCancel: _this2.hideConfirmModal,\n          destroyOnClose: true,\n          onOk: _this2.create,\n          okText: \"\\u786E\\u8BA4\\u53D1\\u9001\",\n          cancelText: \"\\u53D6\\u6D88\",\n          okButtonProps: {\n            loading: confirmLoading\n          }\n        }, React.createElement(TipText, null, \"\\u786E\\u8BA4\\u540E\\uFF0C\\u6B64\\u670D\\u52A1\\u5355\\u5C06\\u4F1A\\u4EE5\\u77ED\\u4FE1\\u3001\\u90AE\\u4EF6\\u548CApp\\u7684\\u65B9\\u5F0F\\u53D1\\u9001\\u7ED9\\u5B66\\u5458\\u3002\")));\n      });\n    }\n  }]);\n\n  return StepContainer;\n}(Component);\n\nexport { StepContainer as default };\nvar Content = styled.div.withConfig({\n  displayName: \"StepContainer__Content\",\n  componentId: \"sc-1pbipyq-0\"\n})([\"display:flex;align-items:center;flex-direction:column;padding:20px 0;\"]);\nvar TipText = styled.div.withConfig({\n  displayName: \"StepContainer__TipText\",\n  componentId: \"sc-1pbipyq-1\"\n})([\"font-size:14px;line-height:22px;color:#172b4d;\"]);\nvar TipCheck = styled(_Checkbox).withConfig({\n  displayName: \"StepContainer__TipCheck\",\n  componentId: \"sc-1pbipyq-2\"\n})([\"font-size:14px;line-height:22px;color:#172b4d;\"]);","map":null,"metadata":{},"sourceType":"module"}
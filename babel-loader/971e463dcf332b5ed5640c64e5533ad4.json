{"ast":null,"code":"import \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/date-picker/style\";\nimport _DatePicker from \"antd/lib/date-picker\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport _Object$keys2 from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport moment from 'moment';\nimport React, { Component, Fragment } from 'react';\nimport styled from 'styled-components';\nimport TextArea from 'antd/lib/input/TextArea';\nimport { parseErrorCode, priceText } from '../../../../../lib/commonJs';\nimport { NoEmptyInputRule, NoEmptyOtherRule } from '../../../../../lib/commonRule';\nimport { LabelDescription, LabelWrapper } from '../../../../service/components/CSSComponents';\nimport { MutationApproveOrder } from '../../containers/MutationApproveOrder';\n\nvar ApproveModal =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ApproveModal, _Component);\n\n  function ApproveModal(props) {\n    var _this;\n\n    _classCallCheck(this, ApproveModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ApproveModal).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"showPop\", function () {\n      _this.setState({\n        visible: true,\n        // 每次打开弹窗保存 payments\n        payments: _this.props.payments\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"hidePop\", function () {\n      _this.setState({\n        visible: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOk\", function (e) {\n      e.preventDefault();\n\n      _this.props.form.validateFieldsAndScroll(\n      /*#__PURE__*/\n      function () {\n        var _ref = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee(err, fieldsValue) {\n          var updateInput, _i, _Object$keys, key, updateOfflinePaymentInput, _this$props, orderId, serviceTicketId;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  if (!err) {\n                    // 处理表单数据\n                    updateInput = [];\n\n                    for (_i = 0, _Object$keys = _Object$keys2(fieldsValue); _i < _Object$keys.length; _i++) {\n                      key = _Object$keys[_i];\n\n                      if (key !== 'innerRemarks') {\n                        (function () {\n                          var _key$split = key.split('+'),\n                              _key$split2 = _slicedToArray(_key$split, 2),\n                              id = _key$split2[0],\n                              keyName = _key$split2[1];\n\n                          var current = updateInput.findIndex(function (v) {\n                            return v.id === id;\n                          });\n\n                          if (current >= 0) {\n                            updateInput[current][keyName] = fieldsValue[key];\n                          } else {\n                            updateInput.push(_defineProperty({\n                              id: id\n                            }, keyName, fieldsValue[key]));\n                          }\n                        })();\n                      }\n                    }\n\n                    updateOfflinePaymentInput = updateInput.map(function (v) {\n                      return _objectSpread({}, v, {\n                        actualDate: v.actualDate.toISOString()\n                      });\n                    }); // 执行接口\n\n                    _this$props = _this.props, orderId = _this$props.orderId, serviceTicketId = _this$props.serviceTicketId;\n\n                    _this.setState({\n                      loading: true\n                    });\n\n                    _this.props.client.mutate({\n                      mutation: MutationApproveOrder,\n                      variables: {\n                        input: {\n                          id: orderId,\n                          serviceTicketId: serviceTicketId,\n                          updateOfflinePaymentInput: updateOfflinePaymentInput,\n                          innerRemarks: fieldsValue.innerRemarks\n                        }\n                      }\n                    }).then(function (result) {\n                      if (result) {\n                        _message.success('已通过核查');\n\n                        _this.hidePop();\n                      }\n                    }).catch(function (error) {\n                      if (parseErrorCode(error) === 'NonExistent') {\n                        _message.error('操作失败，订单不存在');\n                      }\n                    }).finally(function () {\n                      _this.setState({\n                        loading: false\n                      });\n                    });\n                  }\n\n                case 1:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x, _x2) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    });\n\n    _this.state = {\n      visible: false,\n      loading: false,\n      payments: []\n    };\n    return _this;\n  }\n\n  _createClass(ApproveModal, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.onRef(this);\n    } // 显示弹窗\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var amountTotal = this.props.amountTotal;\n      var _this$state = this.state,\n          visible = _this$state.visible,\n          loading = _this$state.loading,\n          payments = _this$state.payments;\n      var getFieldDecorator = this.props.form.getFieldDecorator;\n      var title = React.createElement(React.Fragment, null, React.createElement(TitleText, null, \"\\u901A\\u8FC7\\u6838\\u67E5\"), React.createElement(SubtitleText, null, \"\\u8BF7\\u786E\\u8BA4\\u4EE5\\u4E0B\\u652F\\u4ED8\\u4FE1\\u606F\\u3002\\u5982\\u7528\\u6237\\u672A\\u586B\\u5199\\u652F\\u4ED8\\u6D41\\u6C34\\u53F7\\u6216\\u53C2\\u8003\\u53F7\\uFF0C\\u4E5F\\u8BF7\\u4E00\\u5E76\\u8865\\u5168\\u540E\\uFF0C\\u518D\\u901A\\u8FC7\\u6838\\u67E5\\u3002 \\u5E94\\u4ED8\\u91D1\\u989D\\uFF08CNY)\\uFF1A\", React.createElement(\"span\", {\n        style: {\n          color: '#172B4D'\n        }\n      }, priceText(amountTotal))));\n      return React.createElement(_Modal, {\n        title: title,\n        visible: visible,\n        closable: false,\n        maskClosable: false,\n        okButtonProps: {\n          loading: loading\n        },\n        width: 720,\n        onOk: this.handleOk,\n        onCancel: this.hidePop,\n        okText: \"\\u901A\\u8FC7\\u6838\\u67E5\",\n        cancelText: \"\\u53D6\\u6D88\"\n      }, React.createElement(ModalContent, null, payments.map(function (payment, index) {\n        var id = payment.id,\n            actualAmount = payment.actualAmount,\n            transactionNo = payment.transactionNo,\n            paidAt = payment.paidAt;\n        return React.createElement(Fragment, {\n          key: index\n        }, React.createElement(BlockTitle, null, \"\\u652F\\u4ED8\\u8BB0\\u5F55\", index + 1), React.createElement(\"p\", null, \"\\u5B9E\\u9645\\u4EA4\\u6613\\u91D1\\u989D\\uFF08CNY\\uFF09\"), React.createElement(\"p\", null, priceText(actualAmount)), React.createElement(_Form.Item, {\n          style: formItemStyle,\n          label: \"\\u5B9E\\u9645\\u4EA4\\u6613\\u65E5\\u671F\",\n          required: true\n        }, getFieldDecorator(\"\".concat(id, \"+actualDate\"), {\n          rules: NoEmptyOtherRule,\n          initialValue: moment(paidAt, dateFormat)\n        })(React.createElement(_DatePicker, {\n          format: dateFormat,\n          style: inputStyle,\n          placeholder: \"\\u8BF7\\u9009\\u62E9\"\n        }))), React.createElement(_Form.Item, {\n          style: formItemStyle,\n          label: \"\\u5B9E\\u9645\\u652F\\u4ED8\\u6D41\\u6C34\\u53F7\\u6216\\u53C2\\u8003\\u53F7\",\n          required: true\n        }, getFieldDecorator(\"\".concat(id, \"+transactionNo\"), {\n          rules: NoEmptyInputRule,\n          initialValue: transactionNo\n        })(React.createElement(_Input, {\n          style: inputStyle,\n          placeholder: \"\\u8BF7\\u8F93\\u5165\"\n        }))));\n      }), React.createElement(_Form.Item, {\n        style: formItemStyle,\n        label: React.createElement(LabelWrapper, null, React.createElement(\"label\", null, \"\\u5BF9\\u5185\\u5907\\u6CE8\"), React.createElement(LabelDescription, null, \"\\u4EC5\\u5BF9\\u5185\\u53EF\\u89C1\"))\n      }, getFieldDecorator('innerRemarks')(React.createElement(TextArea, {\n        style: inputStyle,\n        placeholder: \"\\u8BF7\\u8F93\\u5165\"\n      })))));\n    }\n  }]);\n\n  return ApproveModal;\n}(Component);\n\nexport default _Form.create()(ApproveModal);\nexport var dateFormat = 'YYYY/MM/DD';\nexport var TitleText = styled.p.withConfig({\n  displayName: \"ApproveModal__TitleText\",\n  componentId: \"my8fem-0\"\n})([\"margin-bottom:16px;font-size:16px;line-height:24px;color:#172b4d;\"]);\nexport var SubtitleText = styled.p.withConfig({\n  displayName: \"ApproveModal__SubtitleText\",\n  componentId: \"my8fem-1\"\n})([\"margin:0;font-size:12px;font-weight:normal;line-height:18px;color:#a2aab8;\"]);\nexport var ModalContent = styled.div.withConfig({\n  displayName: \"ApproveModal__ModalContent\",\n  componentId: \"my8fem-2\"\n})([\"max-height:400px;padding:24px;overflow-y:auto;font-size:14px;color:#172b4d;.ant-form-item-label > label{color:#172b4d;}.ant-form-item{margin-bottom:20px;}\"]);\nvar BlockTitle = styled.p.withConfig({\n  displayName: \"ApproveModal__BlockTitle\",\n  componentId: \"my8fem-3\"\n})([\"margin-bottom:24px;font-size:16px;line-height:24px;\"]);\nexport var formItemStyle = {\n  fontSize: '14px',\n  color: '#172b4d'\n};\nexport var inputStyle = {\n  width: '400px'\n};","map":null,"metadata":{},"sourceType":"module"}
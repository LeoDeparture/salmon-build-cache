{"ast":null,"code":"import \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport React from 'react';\nimport styled from 'styled-components';\nimport Loading from '../Loading';\nimport SortableComponent from './components/SortableComponent';\n\nvar SortableModal =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(SortableModal, _React$Component);\n\n  function SortableModal(props) {\n    var _this;\n\n    _classCallCheck(this, SortableModal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(SortableModal).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"showPop\", function () {\n      _this.setState({\n        visible: true\n      });\n\n      return _this.fetchItems();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"hidePop\", function () {\n      _this.setState({\n        visible: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"fetchItems\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.setState({\n                loading: true\n              });\n\n              _context.next = 3;\n              return _this.props.getListItemsHelper().then(function (res) {\n                _this.setState({\n                  items: res,\n                  loading: false\n                });\n              });\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDateSort\", function () {\n      var items = _this.state.items;\n      items.sort(function (a, b) {\n        return new Date(a.bestStartAt).valueOf() - new Date(b.bestStartAt).valueOf();\n      });\n      var listNoTime = items.filter(function (v) {\n        return !v.bestStartAt;\n      });\n      var listWithTime = items.filter(function (v) {\n        return v.bestStartAt;\n      });\n      var result = [].concat(_toConsumableArray(listNoTime), _toConsumableArray(listWithTime));\n\n      _this.setState({\n        items: result,\n        sortItems: result\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleOk\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _this.setState({\n                mutating: true\n              });\n\n              _this.props.setListItemsHelper(_this.state.sortItems).then(function (res) {\n                _this.setState({\n                  mutating: false,\n                  items: null,\n                  sortItems: null\n                });\n\n                _this.hidePop();\n\n                return res;\n              }).catch(function () {\n                _this.setState({\n                  mutating: false\n                });\n              });\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCancel\", function () {\n      _this.setState({\n        items: null,\n        sortItems: null\n      }, function () {\n        _this.hidePop();\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSortItemsState\", function (items) {\n      var sortItems = [];\n      items.forEach(function (value, index) {\n        sortItems.push({\n          id: value.id,\n          sort: index + 1\n        });\n      });\n\n      _this.setState({\n        sortItems: sortItems,\n        items: items\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderContent\", function () {\n      var _this$state = _this.state,\n          loading = _this$state.loading,\n          items = _this$state.items;\n      var mode = _this.props.mode;\n      return React.createElement(ModalContent, null, loading ? React.createElement(Loading, null) : items ? React.createElement(NonSelectableDiv, null, React.createElement(SubTitle, null, React.createElement(\"div\", null, \"\\u62D6\\u62FD\", _this.props.title, \"\\u4EE5\\u6392\\u5E8F\"), mode !== 'drag-and-drop' ? React.createElement(_Button, {\n        size: \"small\",\n        onClick: _this.handleDateSort\n      }, \"\\u6309\\u7167\\u5F00\\u59CB\\u65E5\\u671F\\u81EA\\u52A8\\u6392\\u5E8F\") : null), React.createElement(SortableComponent, {\n        mode: mode,\n        setValue: items,\n        getValue: _this.handleSortItemsState\n      })) : React.createElement(PlainContent, null, \"\\u52A0\\u8F7D\\u5931\\u8D25\\uFF0C\\u8BF7\\u7A0D\\u5019\\u91CD\\u8BD5\"));\n    });\n\n    _this.state = {\n      visible: false,\n      loading: false,\n      mutating: false,\n      items: undefined,\n      sortItems: undefined\n    };\n    return _this;\n  }\n\n  _createClass(SortableModal, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var onRef = this.props.onRef;\n\n      if (onRef) {\n        onRef(this);\n      }\n    } // 显示弹窗\n\n  }, {\n    key: \"render\",\n    value: function render() {\n      var title = this.props.title;\n      var footer = React.createElement(NonSelectableDiv, null, React.createElement(Footer, null, React.createElement(Buttons, null, React.createElement(_Button, {\n        onClick: this.handleCancel\n      }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n        onClick: this.handleOk,\n        type: \"primary\",\n        disabled: this.state.loading || !this.state.sortItems,\n        loading: this.state.mutating\n      }, \"\\u786E\\u8BA4\\u6392\\u5E8F\"))));\n      return React.createElement(_Modal, {\n        centered: true,\n        closable: false,\n        confirmLoading: this.state.mutating,\n        footer: footer,\n        title: React.createElement(NonSelectableDiv, null, title, \"\\u6392\\u5E8F\"),\n        visible: this.state.visible,\n        destroyOnClose: true\n      }, this.renderContent());\n    }\n  }]);\n\n  return SortableModal;\n}(React.Component);\n\n_defineProperty(SortableModal, \"defaultProps\", {\n  mode: 'drag-and-drop'\n});\n\nexport default SortableModal;\nvar Footer = styled.div.withConfig({\n  displayName: \"SortableModal__Footer\",\n  componentId: \"sc-1sk971u-0\"\n})([\"display:flex;align-items:center;justify-content:flex-end;height:50px;padding-right:10px;\"]);\nvar Buttons = styled.div.withConfig({\n  displayName: \"SortableModal__Buttons\",\n  componentId: \"sc-1sk971u-1\"\n})([\"position:relative;display:flex;align-items:center;height:100%;\"]);\nvar ModalContent = styled.div.withConfig({\n  displayName: \"SortableModal__ModalContent\",\n  componentId: \"sc-1sk971u-2\"\n})([\"align-content:center;align-items:center;height:600px;\"]);\nvar SubTitle = styled.div.withConfig({\n  displayName: \"SortableModal__SubTitle\",\n  componentId: \"sc-1sk971u-3\"\n})([\"display:flex;justify-content:space-between;margin-bottom:24px;\"]);\nvar PlainContent = styled.div.withConfig({\n  displayName: \"SortableModal__PlainContent\",\n  componentId: \"sc-1sk971u-4\"\n})([\"height:100%;padding-top:60%;font-size:14px;text-align:center;\"]);\nvar NonSelectableDiv = styled.div.withConfig({\n  displayName: \"SortableModal__NonSelectableDiv\",\n  componentId: \"sc-1sk971u-5\"\n})([\"user-select:none;\"]);","map":null,"metadata":{},"sourceType":"module"}
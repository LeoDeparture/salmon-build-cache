{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/icon/style\";\nimport _Icon from \"antd/lib/icon\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport TextArea from 'antd/lib/input/TextArea';\nimport Router from 'next/router';\nimport React, { Component } from 'react';\nimport { ApolloConsumer } from 'react-apollo';\nimport styled from 'styled-components';\nimport LimitedInput from '../../../../../components/Input/LimitedInput';\nimport SkillCourseCategorySelect from '../../../../../components/Select/SkillCourseCategorySelect';\nimport { parseErrorCode } from '../../../../../lib/commonJs';\nimport { NoEmptyInputRule } from '../../../../../lib/commonRule';\nimport { MutationCreateSkillCourse, MutationUpdateSkillCourse } from './MutationCreateSkillCourse';\nimport { QueryGetSkillCourseById } from './QueryGetSkillCourseById';\n\nvar CreateSkillCourseContainer =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CreateSkillCourseContainer, _Component);\n\n  function CreateSkillCourseContainer(props) {\n    var _this;\n\n    _classCallCheck(this, CreateSkillCourseContainer);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CreateSkillCourseContainer).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"isEdit\", Router.query.id);\n\n    _defineProperty(_assertThisInitialized(_this), \"formatCategoryId\", function (category, ids) {\n      var id = category.id,\n          parent = category.parent;\n\n      var categoryId = _toConsumableArray(ids);\n\n      categoryId.unshift(id);\n\n      if (parent) {\n        return _this.formatCategoryId(parent, categoryId);\n      }\n\n      return categoryId;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"goBack\", function () {\n      Router.back();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"controlAlert\", function (isShow, text) {\n      var defaultText = '无法选择未设置可关联课程的分类';\n\n      _this.setState({\n        validateStatus: isShow ? 'error' : undefined,\n        help: isShow ? text ? text : defaultText : undefined\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (_, option) {\n      var checkItem = option[option.length - 1];\n\n      _this.controlAlert(!checkItem.childrenType);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"mentionModal\", function () {\n      var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : undefined;\n      var title = '无法创建此课程';\n      var text = '课程列表里有重名课程，请更改课程名称';\n\n      if (_this.isEdit) {\n        title = '无法编辑此课程';\n      }\n\n      if (type === 'notExist') {\n        title = '未找到该分类';\n        text = '未找到该分类，请核实后重新尝试。';\n      }\n\n      _Modal.warning({\n        icon: React.createElement(_Icon, {\n          type: \"exclamation-circle\",\n          theme: \"filled\"\n        }),\n        title: React.createElement(\"div\", {\n          style: {\n            color: '#42526E'\n          }\n        }, title),\n        content: React.createElement(\"div\", {\n          style: {\n            color: '#42526E'\n          }\n        }, text),\n        okText: '我知道了'\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onClickCreateBtn\", function () {\n      _this.props.form.validateFields(function (err, values) {\n        if (err && err.courseCategoryId) {\n          _this.controlAlert(false, err.courseCategoryId.errors[0].message);\n        }\n\n        if (!err) {\n          var name = values.name,\n              remark = values.remark,\n              courseCategoryId = values.courseCategoryId;\n          var categoryLength = courseCategoryId.length - 1;\n          var categoryIds = courseCategoryId[categoryLength];\n\n          _this.setState({\n            loading: true\n          });\n\n          var mutationName;\n          var variable;\n          var messageText;\n\n          if (_this.isEdit) {\n            variable = {\n              input: {\n                id: _this.isEdit,\n                remark: remark,\n                name: name,\n                courseCategoryId: categoryIds\n              }\n            };\n            mutationName = MutationUpdateSkillCourse;\n            messageText = '已保存成功';\n          }\n\n          if (!_this.isEdit) {\n            variable = {\n              input: {\n                remark: remark,\n                name: name,\n                courseCategoryId: categoryIds\n              }\n            };\n            mutationName = MutationCreateSkillCourse;\n            messageText = '已成功创建课程';\n          }\n\n          _this.client.mutate({\n            mutation: mutationName,\n            variables: variable\n          }).then(function (_) {\n            Router.back();\n\n            _message.success(messageText, 1.5);\n          }).catch(function (error) {\n            if (parseErrorCode(error) === 'CategoryError') {\n              _this.mentionModal('notExist');\n            }\n\n            if (parseErrorCode(error) === 'DuplicationError') {\n              _this.mentionModal();\n            }\n          }).finally(function () {\n            _this.setState({\n              loading: false\n            });\n          });\n        }\n      });\n    });\n\n    _this.state = {\n      loading: false,\n      childrenType: false,\n      validateStatus: '',\n      help: ''\n    };\n    return _this;\n  }\n\n  _createClass(CreateSkillCourseContainer, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      if (this.isEdit) {\n        this.client.query({\n          query: QueryGetSkillCourseById,\n          variables: {\n            input: {\n              id: this.isEdit\n            }\n          }\n        }).then(function (res) {\n          if (res.data.getSkillCourseById) {\n            var _res$data$getSkillCou = res.data.getSkillCourseById,\n                name = _res$data$getSkillCou.name,\n                remark = _res$data$getSkillCou.remark,\n                skillCourseCategory = _res$data$getSkillCou.skillCourseCategory;\n\n            _this2.props.form.setFieldsValue({\n              name: name,\n              remark: remark,\n              courseCategoryId: _this2.formatCategoryId(skillCourseCategory, [])\n            });\n          }\n        });\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var getFieldDecorator = this.props.form.getFieldDecorator;\n      var _this$state = this.state,\n          loading = _this$state.loading,\n          validateStatus = _this$state.validateStatus,\n          help = _this$state.help;\n      return React.createElement(ApolloConsumer, null, function (client) {\n        _this3.client = client;\n        return React.createElement(React.Fragment, null, React.createElement(_Form, {\n          style: {\n            width: '320px'\n          }\n        }, React.createElement(_Form.Item, {\n          label: \"\\u8BFE\\u7A0B\\u540D\\u79F0\",\n          colon: false\n        }, getFieldDecorator('name', {\n          rules: NoEmptyInputRule\n        })(React.createElement(LimitedInput, {\n          placeholder: \"\\u5BF9\\u5185\\u53EF\\u89C1\",\n          limit: 64\n        }))), React.createElement(_Form.Item, {\n          label: \"\\u6240\\u5C5E\\u5206\\u7C7B\",\n          colon: false,\n          validateStatus: validateStatus,\n          help: help\n        }, getFieldDecorator('courseCategoryId', {\n          rules: [{\n            required: true,\n            message: '当前字段不可为空'\n          }]\n        })(React.createElement(SkillCourseCategorySelect, {\n          placeholder: \"\\u8BF7\\u9009\\u62E9\",\n          onChange: _this3.onChange,\n          allowClear: false\n        }))), React.createElement(_Form.Item, {\n          colon: false,\n          label: \"\\u5BF9\\u5185\\u5907\\u6CE8\"\n        }, getFieldDecorator('remark')(React.createElement(TextArea, {\n          rows: 3,\n          placeholder: \"\\u4EC5\\u5BF9\\u5185\\u53EF\\u89C1\"\n        }))), React.createElement(FooterWrapper, null, React.createElement(_Button, {\n          style: {\n            marginRight: 12\n          },\n          onClick: _this3.goBack\n        }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n          type: \"primary\",\n          onClick: _this3.onClickCreateBtn,\n          loading: loading\n        }, _this3.isEdit ? '保存' : '创建课程'))));\n      });\n    }\n  }]);\n\n  return CreateSkillCourseContainer;\n}(Component);\n\nvar CreateSkillCourse = _Form.create()(CreateSkillCourseContainer);\n\nexport default CreateSkillCourse;\nvar FooterWrapper = styled.div.withConfig({\n  displayName: \"CreateSkillCourseContainer__FooterWrapper\",\n  componentId: \"sc-12z3j3c-0\"\n})([\"margin:77px 0 59px;\"]);","map":null,"metadata":{},"sourceType":"module"}
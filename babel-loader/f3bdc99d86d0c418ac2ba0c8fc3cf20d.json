{"ast":null,"code":"import \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/time-picker/style\";\nimport _TimePicker from \"antd/lib/time-picker\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport FormItem from 'antd/lib/form/FormItem';\nimport { addHours, compareAsc, format } from 'date-fns';\nimport Router from 'next/router';\nimport React from 'react';\nimport { ApolloConsumer } from 'react-apollo';\nimport styled from 'styled-components';\nimport { FlexDisplayBetween, FlexDisplayCenterV, TextContent } from '../../../lib/commonCss';\nimport { checkPositive, errMessage, parseErrorCode } from '../../../lib/commonJs';\nimport { yyyymmdd } from '../../../lib/date';\nimport CalenderDatePicker from '../../addAppointment/components/CalenderDatePicker';\nimport Dashboard from '../components/Dashboard';\nimport { createGroupCourseSlot } from './MutationCreateGroupCourseSlot';\n\nvar CreateSchedule =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(CreateSchedule, _React$Component);\n\n  function CreateSchedule() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, CreateSchedule);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(CreateSchedule)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"formatType\", 'YYYY-MM-DD HH:mm');\n\n    _defineProperty(_assertThisInitialized(_this), \"setFieldsValue\", _this.props.form.setFieldsValue);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      disableValue: [],\n      isFirst: true,\n      loading: false,\n      resultDate: [],\n      switch: true,\n      time: ''\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (value) {\n      _this.setState({\n        switch: value\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChangeTime\",\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(m) {\n        var timeStr;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (m) {\n                  timeStr = format(m._d, 'HH:mm:00.000');\n\n                  _this.setState({\n                    time: timeStr\n                  });\n                }\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"checkTime\", function () {\n      var showPanel = _this.state.time === '' && _this.state.isFirst;\n\n      _this.setState({\n        isFirst: true\n      });\n\n      if (showPanel) {\n        _Modal.warning({\n          content: '设置上课时间后，方可设置上课日期',\n          okText: '我知道了',\n          title: '请先设置上课时间'\n        });\n\n        _this.setState({\n          isFirst: false\n        });\n      }\n\n      return _this.state.time === '';\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getValue\", function (resultDate) {\n      _this.setFieldsValue({\n        classDate: resultDate\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"appointmentTimes\", function (dateData) {\n      var result = [];\n\n      if (dateData && dateData.length) {\n        var time = _this.state.time;\n        dateData.sort(function (a, b) {\n          return new Date(a).valueOf() - new Date(b).valueOf();\n        }).forEach(function (item) {\n          var utcDate = new Date(\"\".concat(yyyymmdd(item), \" \").concat(time)).toISOString();\n          result.push(utcDate);\n        });\n      }\n\n      return result;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateLow\", function (_rule, _value, callback) {\n      var getFieldValue = _this.props.form.getFieldValue;\n      var heighValue = getFieldValue('heigh');\n\n      if (_value && heighValue && !isNaN(_value) && !isNaN(heighValue) && Number(_value) > Number(heighValue)) {\n        callback('最低人数不得大于最高人数');\n        return;\n      }\n\n      callback();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"validateHeigh\", function (_rule, _value, callback) {\n      var validateFields = _this.props.form.validateFields;\n      validateFields(['low'], {\n        force: true\n      }, function () {\n        return;\n      });\n      callback();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"modalPop\", function (content) {\n      _Modal.warn({\n        title: '无法创建排期',\n        content: React.createElement(TextContent, null, content, \" \"),\n        okText: '我知道了'\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"dateValidate\", function (date) {\n      var comparedDate = addHours(new Date(), 4);\n      var selectDate = new Date(date);\n      var rules = compareAsc(comparedDate, selectDate);\n\n      if (rules > 0) {\n        _this.modalPop('上课时间距离当前时间必须大于4小时，请重新设置。');\n\n        return false;\n      }\n\n      return true;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSubmit\", function (e) {\n      e.preventDefault();\n\n      _this.props.form.validateFieldsAndScroll(\n      /*#__PURE__*/\n      function () {\n        var _ref2 = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee2(err, values) {\n          var utcTime, id, low, heigh, fullyRefundableTime, appointDeadline, variables;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  utcTime = _this.appointmentTimes(values.classDate);\n                  id = Router.router.query.id;\n\n                  if (_this.dateValidate(utcTime[0]) && !err) {\n                    low = values.low, heigh = values.heigh, fullyRefundableTime = values.fullyRefundableTime, appointDeadline = values.appointDeadline;\n\n                    _this.setState({\n                      loading: true\n                    });\n\n                    variables = {\n                      input: {\n                        id: id,\n                        dateList: utcTime,\n                        min: Number(low),\n                        max: Number(heigh),\n                        fullyRefundableTime: Number(fullyRefundableTime),\n                        appointDeadline: Number(appointDeadline)\n                      }\n                    };\n\n                    _this.client.mutate({\n                      mutation: createGroupCourseSlot,\n                      variables: variables\n                    }).then(function (result) {\n                      if (result) {\n                        _message.success('已成功创建排期', 1.5);\n\n                        _this.jumpBack();\n                      }\n                    }).catch(function (error) {\n                      _this.setState({\n                        loading: false\n                      });\n\n                      if (parseErrorCode(error) === 'SlotTimeInvalid') {\n                        _this.modalPop('上课时间距离当前时间必须大于4小时，请重新设置。');\n\n                        return;\n                      }\n\n                      if (parseErrorCode(error) === 'SlotTimeShouldBefore') {\n                        _this.modalPop('报名截止时间必须大于当前时间，请重新设置。');\n\n                        return;\n                      }\n\n                      errMessage(error);\n                    });\n                  }\n\n                case 3:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        return function (_x2, _x3) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"jumpBack\", function () {\n      Router.back();\n    });\n\n    return _this;\n  }\n\n  _createClass(CreateSchedule, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props$form = this.props.form,\n          getFieldDecorator = _this$props$form.getFieldDecorator,\n          getFieldValue = _this$props$form.getFieldValue;\n      return React.createElement(Dashboard, null, React.createElement(ApolloConsumer, null, function (client) {\n        _this2.client = client;\n        return React.createElement(_Form, {\n          onSubmit: _this2.handleSubmit,\n          style: {\n            width: '100%',\n            backgroundColor: '#fff'\n          }\n        }, React.createElement(_Row, null, React.createElement(FormItem, {\n          style: {\n            width: 500,\n            marginBottom: 44\n          },\n          colon: false\n        }, React.createElement(Label, {\n          className: \"ant-form-item-required\"\n        }, React.createElement(\"span\", {\n          style: {\n            marginRight: '12px'\n          }\n        }, \"\\u4E0A\\u8BFE\\u65E5\\u671F\"), React.createElement(TextContent, {\n          color: '#bfbfbf'\n        }, \"\\u652F\\u6301\\u6279\\u91CF\\u9009\\u62E9\")), getFieldDecorator('classDate', {\n          rules: [Rules.required]\n        })(React.createElement(CalenderDatePicker, {\n          disableRule: true,\n          loading: false,\n          getValue: _this2.getValue,\n          setValue: getFieldValue('classDate'),\n          timeUTC: _this2.state.time,\n          disableDate: _this2.state.disableValue\n        }))), React.createElement(FormItem, {\n          style: {\n            width: 500,\n            marginBottom: 44\n          },\n          colon: false,\n          label: \"\\u4E0A\\u8BFE\\u65F6\\u95F4\"\n        }, getFieldDecorator('time', {\n          rules: [Rules.required]\n        })(React.createElement(_TimePicker, {\n          style: {\n            width: '100%'\n          },\n          format: \"HH:mm\",\n          placeholder: \"\\u8BF7\\u9009\\u62E9\",\n          allowClear: false,\n          onChange: _this2.onChangeTime\n        }))), React.createElement(FlexDisplayBetween, {\n          style: {\n            width: 500,\n            marginBottom: 44\n          }\n        }, React.createElement(FormItem, {\n          colon: false,\n          style: {\n            marginBottom: 0\n          },\n          label: \"\\u5F00\\u8BFE\\u6700\\u4F4E\\u4EBA\\u6570\"\n        }, getFieldDecorator('low', {\n          rules: [Rules.required, {\n            validator: checkPositive\n          }, {\n            validator: _this2.validateLow\n          }]\n        })(React.createElement(FlexDisplayCenterV, null, React.createElement(_Input, {\n          style: {\n            width: 200,\n            marginRight: '12px'\n          },\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u6B63\\u6574\\u6570\"\n        }), React.createElement(TextContent, null, \"\\u4EBA\")))), React.createElement(FormItem, {\n          colon: false,\n          style: {\n            marginBottom: 0\n          },\n          label: \"\\u6700\\u9AD8\\u53EF\\u62A5\\u540D\\u4EBA\\u6570\"\n        }, getFieldDecorator('heigh', {\n          rules: [Rules.required, {\n            validator: checkPositive\n          }, {\n            validator: _this2.validateHeigh\n          }]\n        })(React.createElement(FlexDisplayCenterV, null, React.createElement(_Input, {\n          style: {\n            width: 200,\n            marginRight: '12px'\n          },\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u6B63\\u6574\\u6570\"\n        }), React.createElement(TextContent, null, \"\\u4EBA\"))))), React.createElement(FormItem, {\n          colon: false,\n          style: {\n            width: 500,\n            marginBottom: 44\n          },\n          label: \"\\u65E0\\u635F\\u9000\\u8BFE\\u65F6\\u95F4\"\n        }, getFieldDecorator('fullyRefundableTime', {\n          rules: [Rules.required, {\n            validator: checkPositive\n          }]\n        })(React.createElement(FlexDisplayCenterV, null, React.createElement(TextContent, null, \"\\u8DDD\\u79BB\\u6BCF\\u4E2A\\u6392\\u671F\\u7684\\u4E0A\\u8BFE\\u65F6\\u95F4\"), React.createElement(_Input, {\n          style: {\n            width: 120,\n            margin: '0 12px'\n          },\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u6B63\\u6574\\u6570\"\n        }), React.createElement(TextContent, null, \" \\u5C0F\\u65F6 \"), React.createElement(TextContent, {\n          style: {\n            marginLeft: 12\n          }\n        }, ' ', \"\\u4E4B\\u524D\", ' ')))), React.createElement(FormItem, {\n          colon: false,\n          style: {\n            width: 500,\n            marginBottom: 44\n          },\n          label: \"\\u62A5\\u540D\\u622A\\u6B62\\u65F6\\u95F4\"\n        }, getFieldDecorator('appointDeadline', {\n          rules: [Rules.required, {\n            validator: checkPositive\n          }]\n        })(React.createElement(FlexDisplayCenterV, null, React.createElement(TextContent, null, \"\\u8DDD\\u79BB\\u6BCF\\u4E2A\\u6392\\u671F\\u7684\\u4E0A\\u8BFE\\u65F6\\u95F4\"), React.createElement(_Input, {\n          style: {\n            width: 120,\n            margin: '0 12px'\n          },\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u6B63\\u6574\\u6570\"\n        }), React.createElement(TextContent, null, \" \\u5C0F\\u65F6 \"), React.createElement(TextContent, {\n          style: {\n            marginLeft: 12\n          }\n        }, ' ', \"\\u4E4B\\u524D\", ' '))))), React.createElement(FormItem, {\n          labelCol: {\n            span: 12\n          }\n        }, React.createElement(_Button, {\n          style: {\n            marginRight: 10,\n            fontSize: 15\n          },\n          onClick: _this2.jumpBack\n        }, \"\\u53D6 \\u6D88\"), React.createElement(_Button, {\n          type: \"primary\",\n          htmlType: \"submit\",\n          loading: _this2.state.loading\n        }, \"\\u521B\\u5EFA\\u6392\\u671F\")));\n      }));\n    }\n  }]);\n\n  return CreateSchedule;\n}(React.Component);\n\nexport default _Form.create()(CreateSchedule);\nvar Rules = {\n  required: {\n    message: '此字段无法为空',\n    required: true\n  }\n};\nvar Label = styled.label.withConfig({\n  displayName: \"CreateSchedule__Label\",\n  componentId: \"sc-1jszzo1-0\"\n})([\"display:block;height:40px;line-height:40px;color:rgba(0,0,0,0.85);\"]);","map":null,"metadata":{},"sourceType":"module"}
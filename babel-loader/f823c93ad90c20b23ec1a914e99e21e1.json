{"ast":null,"code":"import \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/form/style\";\nimport _Form from \"antd/lib/form\";\nimport Router from 'next/router';\nimport React from 'react';\nimport styled from 'styled-components';\nimport FilePicker from '../../../components/FilePicker';\nimport RichTextEditor from '../../../components/RichTextEditor';\nimport ZhiWenSelect from '../../../components/SelectComponents/ZhiWenSelect';\nimport { DetailCommonP, FlexDisplay, TextContent } from '../../../lib/commonCss';\nimport { checkPositive } from '../../../lib/commonJs';\nimport { Image, RenderImgDiv } from './CourseInfo';\nvar FormItem = _Form.Item;\nvar TextArea = _Input.TextArea;\nvar Label = styled.label.withConfig({\n  displayName: \"EditCourse__Label\",\n  componentId: \"sc-13yfm86-0\"\n})([\"display:block;height:40px;line-height:40px;color:rgba(0,0,0,0.85);\"]);\nvar MinuteWrap = styled.div.withConfig({\n  displayName: \"EditCourse__MinuteWrap\",\n  componentId: \"sc-13yfm86-1\"\n})([\"margin-top:45px;margin-left:12px;word-break:keep-all;\"]);\nexport var PrimaryA = styled.a.withConfig({\n  displayName: \"EditCourse__PrimaryA\",\n  componentId: \"sc-13yfm86-2\"\n})([\"z-index:1;margin-top:1px;margin-left:12px;font-size:14px;color:#5c86fb;\"]);\nexport var DangerA = styled.a.withConfig({\n  displayName: \"EditCourse__DangerA\",\n  componentId: \"sc-13yfm86-3\"\n})([\"z-index:1;font-size:14px;color:#ff5230;\"]);\nexport var ContentDiv = styled.div.withConfig({\n  displayName: \"EditCourse__ContentDiv\",\n  componentId: \"sc-13yfm86-4\"\n})([\"width:100%;padding:40px 32px;background-color:#fff;\"]);\n\nvar EditCourseForm =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(EditCourseForm, _React$Component);\n\n  function EditCourseForm() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, EditCourseForm);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(EditCourseForm)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"setFieldsValue\", _this.props.form.setFieldsValue);\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      banner: '',\n      disabled: true,\n      loading: false,\n      introductionEditorState: null,\n      tutorIntroductionEditorState: null,\n      suitedPeopleEditorState: null,\n      zhiwenProfessionId: ''\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSubmit\", function (e) {\n      e.preventDefault();\n\n      _this.props.form.validateFieldsAndScroll(function (err, values) {\n        var _this$state = _this.state,\n            disabled = _this$state.disabled,\n            zhiwenProfessionId = _this$state.zhiwenProfessionId,\n            introductionEditorState = _this$state.introductionEditorState,\n            tutorIntroductionEditorState = _this$state.tutorIntroductionEditorState,\n            suitedPeopleEditorState = _this$state.suitedPeopleEditorState;\n        delete values.categoryName;\n\n        if (disabled || !_this.props.courseData.autoForm && !values.autoForm.length) {\n          delete values.autoForm;\n        }\n\n        if (zhiwenProfessionId) {\n          values.zhiwenProfessionId = zhiwenProfessionId;\n        }\n\n        if (introductionEditorState) {\n          values.introduction = introductionEditorState.toHTML();\n        }\n\n        if (tutorIntroductionEditorState) {\n          values.tutorIntroduction = tutorIntroductionEditorState.toHTML();\n        }\n\n        if (suitedPeopleEditorState) {\n          values.suitedPeople = suitedPeopleEditorState.toHTML();\n        }\n\n        if (values.duration) {\n          values.duration = Number(values.duration);\n        }\n\n        if (!err) {\n          _this.setState({\n            loading: true\n          });\n\n          _this.props.mutationHandler(values).then(function (result) {\n            if (result && result.data) {\n              _message.success('已成功保存');\n\n              _this.jumpTo();\n            }\n          }).catch(function () {\n            _this.setState({\n              loading: false\n            });\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"jumpTo\", function () {\n      var router = Router.router.asPath;\n\n      if (router.indexOf('edit') > 0) {\n        Router.back();\n        return;\n      }\n\n      _this.props.changeState('editing', false);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleCancel\", function () {\n      _this.jumpTo();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleClear\", function () {\n      _this.setFieldsValue({\n        autoForm: ''\n      });\n\n      _this.setState({\n        disabled: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleFieldChange\", function (stateName, stateValue) {\n      _this.setState(_defineProperty({}, stateName, stateValue));\n\n      if (['banner', 'zhiwenProfessionId'].includes(stateName)) {\n        _this.setFieldsValue(_defineProperty({}, stateName, stateValue));\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleGetFile\", function (fileLinks) {\n      var url = fileLinks.length ? fileLinks[0].file.transformedFile.url : '';\n\n      _this.setState({\n        banner: url\n      });\n\n      _this.setFieldsValue({\n        banner: url\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSelectBanner\", function () {\n      _this.fileModal.showPop();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onRef\", function (child) {\n      _this.fileModal = child;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"componentDidMount\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var _this$props$courseDat, name, courseCategory, industry, banner, duration, suitedPeople, autoForm, remarks, getCourseCategoryNameString;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              getCourseCategoryNameString = function _ref2(category) {\n                var current = category;\n                var courseCategoriesArr = [];\n\n                while (current && current.name) {\n                  courseCategoriesArr.push(current.name);\n                  current = current.parent;\n                }\n\n                courseCategoriesArr.reverse();\n                var full = courseCategoriesArr.join(' / ');\n                return full.length > 38 ? '...' + full.slice(-38) : full;\n              };\n\n              _this$props$courseDat = _this.props.courseData, name = _this$props$courseDat.name, courseCategory = _this$props$courseDat.courseCategory, industry = _this$props$courseDat.industry, banner = _this$props$courseDat.banner, duration = _this$props$courseDat.duration, suitedPeople = _this$props$courseDat.suitedPeople, autoForm = _this$props$courseDat.autoForm, remarks = _this$props$courseDat.remarks;\n\n              _this.setFieldsValue({\n                autoForm: autoForm ? autoForm.rawInput : '',\n                banner: banner ? banner : '../../../static/default_pic.png',\n                categoryName: getCourseCategoryNameString(courseCategory),\n                duration: duration,\n                name: name,\n                suitedPeople: suitedPeople,\n                remarks: remarks,\n                zhiwenProfessionId: industry.id\n              });\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    return _this;\n  }\n\n  _createClass(EditCourseForm, [{\n    key: \"render\",\n    value: function render() {\n      var courseTypeName = this.props.courseTypeName;\n      var _this$props$form = this.props.form,\n          getFieldDecorator = _this$props$form.getFieldDecorator,\n          getFieldValue = _this$props$form.getFieldValue;\n      return React.createElement(ContentDiv, null, React.createElement(_Form, {\n        onSubmit: this.handleSubmit\n      }, React.createElement(_Row, null, React.createElement(_Col, {\n        span: 9\n      }, React.createElement(FormItem, {\n        label: courseTypeName + '名称',\n        colon: false\n      }, getFieldDecorator('name', {\n        rules: [{\n          required: true,\n          message: \"\\u6B64\\u5B57\\u6BB5\\u65E0\\u6CD5\\u4E3A\\u7A7A\"\n        }]\n      })(React.createElement(_Input, {\n        placeholder: \"\\u8BF7\\u8F93\\u5165\",\n        maxLength: 64\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 9\n      }, React.createElement(FormItem, {\n        label: \"\\u6240\\u5C5E\\u884C\\u4E1A\",\n        colon: false\n      }, getFieldDecorator('zhiwenProfessionId', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(ZhiWenSelect, {\n        type: \"zhiwen-profession\",\n        value: getFieldValue('zhiwenProfessionId'),\n        getValue: this.handleFieldChange.bind(this, 'zhiwenProfessionId')\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 9\n      }, React.createElement(FormItem, {\n        colon: false\n      }, React.createElement(Label, {\n        className: \"ant-form-item-required\"\n      }, React.createElement(\"span\", {\n        style: {\n          marginRight: '12px'\n        }\n      }, \"\\u6240\\u5C5E\\u5206\\u7C7B\"), React.createElement(TextContent, {\n        color: '#bfbfbf'\n      }, \"\\u6682\\u65F6\\u65E0\\u6CD5\\u66F4\\u6539\\u5206\\u7C7B\")), getFieldDecorator('categoryName')(React.createElement(_Input, {\n        value: getFieldValue('categoryName'),\n        disabled: true\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 3\n      }, React.createElement(FormItem, {\n        label: React.createElement(\"div\", {\n          style: {\n            display: 'inline-block'\n          }\n        }, React.createElement(\"label\", null, courseTypeName, \"\\u5C01\\u9762\\u56FE\"), React.createElement(DetailCommonP, {\n          style: {\n            margin: '0 12px'\n          }\n        }, \"\\u5EFA\\u8BAE\\u5C3A\\u5BF8\\uFF1A654*340px\")),\n        colon: false\n      }, React.createElement(RenderImgDiv, null, React.createElement(Image, {\n        src: getFieldValue('banner')\n      })), React.createElement(FilePicker, {\n        onRef: this.onRef,\n        fileType: \"image-only\",\n        selectType: \"single\",\n        getSelected: this.handleGetFile\n      }), getFieldDecorator('banner', {\n        rules: [{\n          required: true,\n          message: '此字段无法为空'\n        }]\n      })(React.createElement(_Button, {\n        style: {\n          width: '200px'\n        },\n        onClick: this.handleSelectBanner\n      }, \"\\u9009\\u62E9\\u56FE\\u7247\"))))), React.createElement(_Row, null, React.createElement(_Col, {\n        span: 9\n      }, React.createElement(_Form.Item, {\n        label: \"\\u9884\\u8BA1\\u6388\\u8BFE\\u65F6\\u957F\",\n        colon: false\n      }, getFieldDecorator('duration', {\n        rules: [{\n          message: '此字段无法为空',\n          required: true\n        }, {\n          validator: checkPositive\n        }],\n        validateFirst: true\n      })(React.createElement(_Input, {\n        style: {\n          width: '100%'\n        },\n        placeholder: '限10000分钟以内，正整数',\n        maxLength: 4\n      })))), React.createElement(_Col, {\n        span: 3\n      }, React.createElement(MinuteWrap, null, \"\\u5206\\u949F\"))), React.createElement(_Row, null, React.createElement(_Col, null, React.createElement(FormItem, {\n        labelCol: {\n          span: 24\n        },\n        label: React.createElement(\"div\", {\n          style: {\n            display: 'flex',\n            flex: 1,\n            justifyContent: 'space-between'\n          }\n        }, React.createElement(FlexDisplay, null, React.createElement(\"label\", null, \"\\u9884\\u7EA6\\u8868\\u5355\"), React.createElement(PrimaryA, {\n          href: '/auto-form-info',\n          target: \"_blank\"\n        }, \"\\u683C\\u5F0F\\u8BF4\\u660E\")), React.createElement(FlexDisplay, null, React.createElement(DetailCommonP, {\n          style: {\n            margin: 0\n          }\n        }, \"\\u9884\\u7EA6\\u8868\\u5355\\u521B\\u5EFA\\u540E\\uFF0C\\u65E0\\u6CD5\\u76F4\\u63A5\\u7F16\\u8F91\\u3002\\u4F60\\u53EF\\u4EE5\\u70B9\\u51FB\\u53F3\\u4FA7\\u6309\\u94AE\\u6E05\\u9664\\u8868\\u5355\\u5185\\u5BB9\\u540E\\uFF0C\\u91CD\\u65B0\\u8F93\\u5165\\u3002\"), React.createElement(DangerA, {\n          onClick: this.handleClear\n        }, \"\\u6E05\\u9664\"))),\n        colon: false\n      }, getFieldDecorator('autoForm')(React.createElement(TextArea, {\n        autoSize: {\n          minRows: 12\n        },\n        disabled: this.state.disabled\n      }))))), React.createElement(_Row, null, React.createElement(_Col, null, React.createElement(FormItem, {\n        label: \"\\u8BE6\\u60C5\\u4ECB\\u7ECD\",\n        colon: false\n      }, getFieldDecorator('introduction')(React.createElement(RichTextEditor, {\n        apikey: 'ADQyLt4yBR7GH9oPjPODCz',\n        setValue: this.props.courseData.introduction,\n        getValue: this.handleFieldChange.bind(this, 'introductionEditorState')\n      }))))), this.props.courseTypeName === '小班课' && React.createElement(_Row, null, React.createElement(_Col, {\n        style: {\n          width: '100%'\n        }\n      }, React.createElement(FormItem, {\n        label: \"\\u9002\\u5408\\u4EBA\\u7FA4\",\n        colon: false\n      }, getFieldDecorator('suitedPeople')(React.createElement(RichTextEditor, {\n        apikey: 'ADQyLt4yBR7GH9oPjPODCz',\n        setValue: this.props.courseData.suitedPeople,\n        getValue: this.handleFieldChange.bind(this, 'suitedPeopleEditorState')\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        style: {\n          width: '100%'\n        }\n      }, React.createElement(FormItem, {\n        label: \"\\u5BFC\\u5E08\\u56E2\\u961F\\u4ECB\\u7ECD\",\n        colon: false\n      }, getFieldDecorator('tutorIntroduction')(React.createElement(RichTextEditor, {\n        apikey: 'ADQyLt4yBR7GH9oPjPODCz',\n        setValue: this.props.courseData.tutorIntroduction,\n        getValue: this.handleFieldChange.bind(this, 'tutorIntroductionEditorState')\n      }))))), React.createElement(_Row, null, React.createElement(_Col, {\n        style: {\n          width: '100%'\n        }\n      }, React.createElement(FormItem, {\n        label: React.createElement(\"div\", {\n          style: {\n            display: 'inline-block'\n          }\n        }, React.createElement(\"label\", null, \"\\u5BF9\\u5185\\u5907\\u6CE8\"), React.createElement(DetailCommonP, {\n          style: {\n            marginLeft: '12px'\n          }\n        }, \"\\u4EC5\\u5BF9\\u5185\\u53EF\\u89C1\")),\n        colon: false\n      }, getFieldDecorator('remarks')(React.createElement(TextArea, {\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BF9\\u5185\\u5907\\u6CE8\",\n        autoSize: {\n          minRows: 2,\n          maxRows: 6\n        }\n      }))))), React.createElement(FormItem, {\n        labelCol: {\n          span: 12\n        }\n      }, React.createElement(_Button, {\n        onClick: this.handleCancel\n      }, \"\\u53D6\\u6D88\"), React.createElement(_Button, {\n        style: {\n          marginLeft: 20\n        },\n        loading: this.state.loading,\n        type: \"primary\",\n        htmlType: \"submit\"\n      }, \"\\u4FDD\\u5B58\"))));\n    }\n  }]);\n\n  return EditCourseForm;\n}(React.Component);\n\nexport default _Form.create()(EditCourseForm);","map":null,"metadata":{},"sourceType":"module"}